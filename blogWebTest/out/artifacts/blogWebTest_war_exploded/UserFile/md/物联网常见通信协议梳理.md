
# 1 &nbsp;概述
在上一篇文章《物联网常见通信协议与通讯协议梳理【上】-通讯协议》中，对物联网常用通信协议和通讯协议作了区分，并对通讯协议进行了分享；本文将对常用的通信协议进行剖析，重点面向市场上使用率较高的，且又不是诸如TCP/IP之类老生常谈的。
 <img src="//upload-images.jianshu.io/upload_images/6832932-ad89743be6208d10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-ad89743be6208d10.png?imageMogr2/auto-orient/strip" data-image-slug="ad89743be6208d10" data-width="1213" data-height="463"><br>
&nbsp;```





```
# 2 &nbsp;近距离通信协议
## &nbsp;RFID


RFID的空中接口通信协议规范基本决定了RFID的工作类型，RFID读写器和相应类型RFID标签之间的通讯规则，包括：频率、调制、位编码及命令集。ISO/IEC制定五种频段的空中接口协议。
**（1）ISO/IEC&nbsp;18000-1《信息技术－基于单品管理的射频识别－第1部分：参考结构和标准化的参数定义》。**它规范空中接口通信协议中共同遵守的读写器与标签的通信参数表、知识产权基本规则等内容。这样每一个频段对应的标准不需要对相同内容进行重复规定。
**（2）ISO/IEC&nbsp;18000-2《信息技术－基于单品管理的射频识别－第2部分：135KHz以下的空中接口通信用参数》。**它规定在标签和读写器之间通信的物理接口，读写器应具有与Type&nbsp;A(FDX)和Type&nbsp;B(HDX)标签通信的能力；规定协议和指令再加上多标签通信的防碰撞方法。
**（3）ISO/IEC&nbsp;18000-3《信息技术－基于单品管理的射频识别－第3部分：参数空中接口通信在13.56MHz》。**它规定读写器与标签之间的物理接口、协议和命令再加上防碰撞方法。关于防碰撞协议可以分为两种模式，而模式1又分为基本型与两种扩展型协议（无时隙无终止多应答器协议和时隙终止自适应轮询多应答器读取协议）。模式2采用时频复用FTDMA协议，共有8个信道，适用于标签数量较多的情形。
**（4）ISO/IEC&nbsp;18000-4《信息技术－基于单品管理的射频识别－第4部分：2.45 GHz空中接口通信用参数》。**它规定读写器与标签之间的物理接口、协议和命令再加上防碰撞方法。该标准包括两种模式，模式1是无源标签工作方式是读写器先讲；模式2是有源标签，工作方式是标签先讲。
**（5）ISO/IEC&nbsp;18000-6《信息技术－基于单品管理的射频识别－第6部分：860 MHz - 960 MHz空中接口通信参数》。**它规定读写器与标签之间的物理接口、协议和命令再加上防碰撞方法。它包含TypeA、TypeB和TypeC三种无源标签的接口协议，通信距离最远可以达到10m。其中TypeC是由EPCglobal起草的，并于2006年7月获得批准，它在识别速度、读写速度、数据容量、防碰撞、信息安全、频段适应能力、抗干扰等方面有较大提高。2006年递交V4.0草案，它针对带辅助电源和传感器电子标签的特点进行扩展，包括标签数据存储方式和交互命令。带电池的主动式标签可以提供较大范围的读取能力和更强的通信可靠性，不过其尺寸较大，价格也更贵一些。
**（6）ISO/IEC&nbsp;18000-7《信息技术－基于单品管理的射频识别－第7部分：433 MHz有源空中接口通信参数》。**它规定读写器与标签之间的物理接口、协议和命令再加上防碰撞方法。有源标签识读范围大，适用于大型固定资产的跟踪。属于有源电子标签。
此外，还有3个常用的RFID协议：
**（1）ISO/IEC 14443《识别卡—无触点集成电路卡—邻近卡》**
国际标准ISO 14443定义了两种信号接口：TypeA和TypeB。ISO 14443A和B互不兼容。
**一、ISO&nbsp;14443&nbsp;TypeA**
ISO&nbsp;14443&nbsp;TypeA
(也称ISO&nbsp;14443A)一般用于门禁卡、公交卡和小额储值消费卡等，具有较高的市场占有率。
举例：
**1****）MIFARE&nbsp;ULtralight(MFO&nbsp;ICU1X):**国内常称U10。此芯片没有加密功能，只能系统加密，内存是64个字节，典型应用：广深高速火车票。(另：MIFARE&nbsp;ULtralight&nbsp;C，也叫U20，此芯片可以加密，内存是192个字节)。这两个芯片的内码位数都是一样的，不过内码数据时不同的。(国内兼容芯片有FM11RF005内存64个字节、BL75R12内存64个字节等)
**2****）MIFARE&nbsp;Std&nbsp;1k(MF1&nbsp;IC&nbsp;S50)：**国内常称MF1&nbsp;S50。主要应用在一卡通方面。内存1KB，有16个扇区，每个扇区有4个块，每个块16个字节。初始密码是12个F。(国内兼容芯片有FM11R08、ISSI4439、TKS50、BL75R06等)
**3****）MIFARE&nbsp;Std&nbsp;4k(MF1&nbsp;IC&nbsp;S70)：**国内常称为MF1&nbsp;S70。主要应用在一卡通方面。内存4KB，共40个扇区，前面32个扇区跟S50一样，每个扇区有4个块，后面8个扇区是16个块，每个块都是16个字节。初始密码是12个F。(国内兼容芯片有ISSI4469、FM11RF32以及华大的S70)。
**4****）Mifare&nbsp;DESFire&nbsp;4k(MF3&nbsp;IC&nbsp;D41/D40)：**国内常称为MF3。典型应用：南京地铁。
**5****）SHC1102：**上海华虹生产。典型应用：上海一卡通。
**二、ISO&nbsp;14443&nbsp;TypeB**
ISO14443B由于加密系数比较高，更适合于CPU卡，一般用于身份证、护照、银联卡等，目前的第二代电子身份证采用的标准是ISO&nbsp;14443&nbsp;TypeB协议。
举例：
**1****）SR176：**瑞士意法半导体(ST)生产。
**2****）SRIX4K：**瑞士意法半导体(ST)生产。
**3****）THR1064:**北京同方生产。典型应用：奥运门票。
**4****）AT88RF020:**美国爱特梅尔(ATMIL)生产。典型应用：广州地铁卡。
**5****）第二代居民身份证：**上海华虹、北京同方THR9904、天津大塘和北京华大生产。
**（2）ISO/IEC&nbsp;15693《识别卡—无接触点集成电路卡—近距卡》**
ISO&nbsp;14443A/B的读写距离通常在10cm以内，应用较广。但ISO 15693的读写距离可以达到1m，应用较灵活，与ISO&nbsp;18000-3兼容(我国的国家标准很多与ISO&nbsp;18000大部分兼容)。
举例：
**1****）ICODE&nbsp;SLI(SL2ICS20):**国内常称ICODE&nbsp;2(内存是1Kbit)，此型号常用。国内兼容有BL75R05、FM1302N。(另：ICODE&nbsp;SLI-S内存是2048bit，ICODE&nbsp;SLI-L内存是512bit，这两款芯片在国内不常用。)
**2****）Tag-it&nbsp;HF-1&nbsp;Plus:**国内常称Tl2048,美国德州仪器公司(简称TI公司)生产。
**3****）EM4135：**瑞士EM生产。
**4****）BL75R04：**上海贝岭生产以及FM1302T(复旦生产)，兼容TI公司的Tag-it&nbsp;HF-1&nbsp;Plus。
**（3）ISO&nbsp;18092《信息技术系统间近距离无线通信及信息交换的接口和协议》**
NFC协议，对近距离无线通信技术进行了一些规范。NFC属于RFID范畴，但又与RFID有一些区别，因此本文将单独一小节对NFC进行阐述。

<img src="//upload-images.jianshu.io/upload_images/6832932-a20730978c2a5f8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-a20730978c2a5f8d.png?imageMogr2/auto-orient/strip" data-image-slug="a20730978c2a5f8d" data-width="1067" data-height="494"><br>
&nbsp;```





```
&nbsp;
## &nbsp;NFC


### &nbsp;NFC概述


近距离无线通信NFC是Near Field Communication缩写，即近距离无线通讯技术，是一种短距离的高频无线通信技术，允许电子设备之间进行非接触式点对点数据传输（在10厘米内）交换数据。
NFC提供了一种简单、触控式的解决方案，可以让消费者简单直观地交换信息、访问内容与服务。这个技术由免接触式射频识别（RFID）演变而来，并向下兼容RFID，最早由Philips、Nokia和Sony主推，主要可能用于手机等手持设备中。由于近场通讯具有天然的安全性，因此，NFC技术被认为在手机支付等领域具有很大的应用前景。NFC将非接触读卡器、非接触卡和点对点（Peer-to-Peer）功能整合进一块单芯片，为消费者的生活方式开创了不计其数的全新机遇。
这是一个开放接口平台，可以对无线网络进行快速、主动设置，也是虚拟连接器，服务于现有蜂窝状网络、蓝牙和无线802.11设备。和RFID不同，NFC采用了双向的识别和连接。在20cm距离内工作于13.56MHz频率范围。它能快速自动地建立无线网络，为蜂窝设备、蓝牙设备、Wi-Fi设备提供一个“虚拟连接”，使电子设备可以在短距离范围进行通讯。
### &nbsp;NFC技术原理


NFC的设备可以在主动或被动模式下交换数据。
**在被动模式下，**启动NFC通信的设备，也称为NFC发起设备(主设备)，在整个通信过程中提供射频场。它可以选择106kbps、212kbps或424kbps其中一种传输速度，将数据发送到另一台设备。另一台设备称为NFC目标设备(从设备)，不必产生射频场，而使用负载调制(load modulation)技术，即可以相同的速度将数据传回发起设备。 移动设备主要以被动模式操作，可以大幅降低功耗，并延长电池寿命。电池电量较低的设备可以要求以被动模式充当目标设备，而不是发起设备。

<img src="//upload-images.jianshu.io/upload_images/6832932-7c14ea99bb74b134.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-7c14ea99bb74b134.png?imageMogr2/auto-orient/strip" data-image-slug="7c14ea99bb74b134" data-width="554" data-height="238"><br>
&nbsp;```





```
&nbsp;
**在主动模式下，**每台设备要向另一台设备发送数据时，都必须产生自己的射频场。这是对等网络通信的标准模式，可以获得非常快速的连接设置。

<img src="//upload-images.jianshu.io/upload_images/6832932-76bc9c5737bec7a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-76bc9c5737bec7a2.png?imageMogr2/auto-orient/strip" data-image-slug="76bc9c5737bec7a2" data-width="554" data-height="283"><br>
&nbsp;```





```
&nbsp;
### &nbsp; NFC应用


NFC技术的应用可以分为四种基本的类别：
**（1）接触通过(TouchandGo)，**如门禁管制、车票和门票等，使用者只需携带储存着票证或门控密码的移动设备靠近读取装置即可。
**（2）接触确认(TouchandConfirm)，**如移动支付，用户通过输入密码或者仅是接受交易，确认该次交易行为。
**（3）接触连接(TouchandConnect)，**如把两个内建NFC的装置相连接，进行点对点数据传输，例如下载音乐、图片互传和同步交换通讯簿等。
**（4）接触浏览(TouchandExplore)，**NFC设备可以提供一种以上有用的功能，消费者将能够通过浏览一个NFC设备，了解提供的是何种功能和服务。
## &nbsp;Bluetooth


### &nbsp;起源


蓝牙的名字来源于10世纪丹麦国王Harald Blatand -英译为Harold Bluetooth(因为他十分喜欢吃蓝梅,所以牙齿每天都带着蓝色)。他将当时的瑞典、芬兰与丹麦统一起来。用他的名字来命名这种新的技术标准，含有将四分五裂的局面统一起来的意思。

<img src="//upload-images.jianshu.io/upload_images/6832932-9b8ff871aa5249ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-9b8ff871aa5249ce.png?imageMogr2/auto-orient/strip" data-image-slug="9b8ff871aa5249ce" data-width="321" data-height="222"><br>
&nbsp;```





```
1998年5月，爱立信、诺基亚、东芝、IBM和英特尔公司等五家著名厂商，在联合开展短程无线通信技术的标准化活动时提出了蓝牙技术，其宗旨是提供一种短距离、低成本的无线传输应用技术。
### &nbsp;蓝牙技术的规范及特点


蓝牙技术是一种无线数据与语音通信的开放性全球规范，工作在全球通用的2.4GHz ISM(即工业、科学、医学）频段，标准是IEEE802.15，工作在2.4GHz频带，带宽为1Mb/s。
它以低成本的近距离无线连接为基础，为固定与移动设备通信环境建立一个特别连接。以时分方式进行全双工通信，其基带协议是电路交换和分组交换的组合。一个跳频频率发送一个同步分组，每个分组占用一个时隙，使用扩频技术也可扩展到5个时隙。 同时，蓝牙技术支持1个异步数据通道或3个并发的同步话音通道，或1个同时传送异步数据和同步话音的通道。每一个话音通道支持64kb/s的同步话音；异步通道支持最大速率为721kb/s，反向应答速率为57. 6 kb/s的非对称连接，或者是432. 6 kb/s的对称连接。
依据发射输出电平功率不同，蓝牙传输有3种距离等级：
Class1为100m左右；
Class2约为10m；
Class3约为2-3m。
一般情况下，其正常的工作范围是10m半径之内。在此范围内，可进行多台设备间的互联。
### &nbsp;蓝牙版本


目前蓝牙发展到了蓝牙5.0：
下面对现阶段主要版本蓝牙技术的特性做一个详细的介绍：
**一、版本1.1**
传输率约在748~810kb/s，因是早期设计，容易受到同频率之间的类似通信产品干扰，影响通讯质量。这个初始版本支持Stereo音效的传输要求，但只能够以（单工）方式工作，加上带宽频率响应等指标不理想，并未算是最好的Stereo传输工具。
**二、版本1.2**
同样是只有748~810kb/s的传输率，但增加了(改善Software)抗干扰跳频功能。支持Stereo音效的传输要求，但只能够作（单工）方式工作，加上带宽频率响应还是不理想，也不能作为立体声（Stereo）传输工具。
**三、版本2.0**
2.0是1.2的改良提升版，传输率约在1.8M/s~2.1M/s，可以有（双工）的工作方式。即一边作语音通讯，同时亦可以传输档案/高质素图片，2.0版本当然也支持Stereo运作。随后蓝牙2.0版本的芯片，增加了Stereo译码芯片，则连A2DP（Advanced Audio Distribution Profile）也可以不需要了。
**四、版本2.1**
为了改善蓝牙技术存在的问题，蓝牙SIG组织（Special Interest Group）推出了Bluetooth 2.1+EDR版本的蓝牙技术。改善装置配对流程：以往在连接过程中，需要利用个人识别码来确保连接的安全性，而改进过后的连接方式则是会自动使用数字密码来进行配对与连接，举例来说，只要在手机选项中选择连接特定装置，在确定之后，手机会自动列出当前环境中可使用的设备，并且自动进行连结；而短距离的配对方面：也具备了在两个支持蓝牙的手机之间互相进行配对与通讯传输的NFC（Near Field Communication）机制；更佳的省电效果：蓝牙2.1版加入了SniffSubrating的功能，透过设定在2个装置之间互相确认讯号的发送间隔来达到节省功耗的目的。蓝牙2.1将装置之间相互确认的讯号发送时间间隔从旧版的0.1秒延长到0.5秒左右，如此可以让蓝牙芯片的工作负载大幅降低，也可让蓝牙可以有更多的时间可以彻底休眠。根据官方的报告，采用此技术之后，蓝牙装置在开启蓝牙联机之后的待机时间可以有效延长5倍以上，开始支持全双工通信模式。
**五、版本3.0+HS**
2009年4月21日，蓝牙技术联盟(BluetoothSIG)正式颁布了新一代标准规范"BluetoothCoreSpecificationVersion3.0HighSpeed"(蓝牙核心规范3.0版高速)，蓝牙3.0的核心是"Generic Alternate MAC/PHY"(AMP)，这是一种全新的交替射频技术，允许蓝牙协议栈针对任一任务动态地选择正确射频。最初被期望用于新规范的技术包括802.11以及UMB，但是新规范中取消了UMB的应用。作为新版规范，蓝牙3.0的传输速度自然会更高，而秘密就在802.11无线协议上。通过集成"802.11PAL"(协议适应层)，蓝牙3.0的数据传输率提高到了大约24Mbps(即可在需要的时候调用802.11WI-FI用于实现高速数据传输)，是蓝牙2.0的八倍，可以轻松用于录像机至高清电视、PC至PMP、UMPC至打印机之间的资料传输。功耗方面，通过蓝牙3.0高速传送大量数据自然会消耗更多能量，但由于引入了增强电源控制(EPC)机制，再辅以802.11，实际空闲功耗会明显降低，蓝牙设备的待机耗电问题有望得到初步解决。此外，新的规范还具备通用测试方法(GTM)和单向广播无连接数据(UCD)两项技术，并且包括了一组HCI指令以获取密钥长度。据称，配备了蓝牙2.1模块的PC理论上可以通过升级固件让蓝牙2.1设备也支持蓝牙3.0。联盟成员已经开始为设备制造商研发蓝牙3.0解决方案。
**六、蓝牙4.0**
（1）简介
蓝牙4.0为蓝牙3.0的升级标准蓝牙4.0最重要的特性是省电，极低的运行和待机功耗可以使一粒纽扣电池连续工作数年之久。此外，低成本和跨厂商互操作性，3毫秒低延迟、AES-128加密等诸多特色，可以用于计步器、心律监视器、智能仪表、传感器物联网等众多领域，大大扩展蓝牙技术的应用范围。
（2）主要特点
蓝牙4.0是蓝牙3.0+HS规范的补充，专门面向对成本和功耗都有较高要求的无线方案，可广泛用于卫生保健、体育健身、家庭娱乐、安全保障等诸多领域。它支持两种部署方式：双模式和单模式。双模式中，低功耗蓝牙功能集成在现有的经典蓝牙控制器中，或再在现有经典蓝牙技术(2.1+EDR/3.0+HS)芯片上增加低功耗堆栈，整体架构基本不变，因此成本增加有限。
Single&nbsp;mode只能与BT4.0互相传输无法向下兼容（与3.0/2.1/2.0无法相通）；Dual&nbsp;mode可以向下兼容可与BT4.0传输也可以跟3.0/2.1/2.0传输。单模式面向高度集成、紧凑的设备，使用一个轻量级连接层(Link Layer)提供超低功耗的待机模式操作、简单设备恢复和可靠的点对多点数据传输，还能让联网传感器在蓝牙传输中安排好低功耗蓝牙流量的次序，同时还有高级节能和安全加密连接。
（3）优点
蓝牙4.0将三种规格集一体，包括传统蓝牙技术、高速技术和低耗能技术，与3.0版本相比最大的不同就是低功耗。“4.0版本的功耗较老版本降低了90%，更省电，“随着蓝牙技术由手机、游戏、耳机、便携电脑和汽车等传统应用领域向物联网、医疗等新领域的扩展，对低功耗的要求会越来越高。4.0版本强化了蓝牙在数据传输上的低功耗性能。”
**七、蓝牙4.1**
（1）简介
如果说蓝牙4.0主打的是省电特性的话，那么此次升级蓝牙4.1的关键词应当是IOT（全联网），也就是把所有设备都联网的意思。为了实现这一点，对通讯功能的改进是蓝牙4.1最为重要的改进之一。
（2）主要特点
1）批量数据的传输速度
首当其冲的就是批量数据的传输速度，大家知道蓝牙的传输速率一直非常渣，与已经跨入千兆的Wi-Fi相比毫无可比性。所以蓝牙4.1在已经被广泛使用的蓝牙4.0 LE基础上进行了升级，使得批量数据可以以更高的速率传输。当然这并不意味着可以用蓝牙高速传输流媒体视频，这一改进的主要针对的还是刚刚兴起的可穿戴设备。例如已经比较常见的健康手环，其发送出的数据流并不大，通过蓝牙4.1能够更快速地将跑步、游泳、骑车过程中收集到的信息传输到手机等设备上，用户就能更好地实时监控运动的状况，这是很有用处的。在蓝牙4.0时代，所有采用了蓝牙4.0 LE的设备都被贴上了“Bluetooth Smart”和“Bluetooth&nbsp;SmartReady”的标志。其中Bluetooth Smart Ready设备指的是PC、平板、手机这样的连接中心设备，而Bluetooth Smart设备指的是蓝牙耳机、键鼠等扩展设备。之前这些设备之间的角色是早就安排好了的，并不能进行角色互换，只能进行1对1连接。而在蓝牙4.1技术中，就允许设备同时充当“Bluetooth Smart”和“Bluetooth Smart&nbsp;Ready”两个角色的功能，这就意味着能够让多款设备连接到一个蓝牙设备上。举个例子，一个智能手表既可以作为中心枢纽，接收从健康手环上收集的运动信息的同时，又能作为一个显示设备，显示来自智能手机上的邮件、短信。借助蓝牙4.1技术智能手表、智能眼镜等设备就能成为真正的中心枢纽。
2）通过IPV6连接到网络
除此之外，可穿戴设备上网不易的问题，也可以通过蓝牙4.1进行解决。新标准加入了专用通道允许设备通过IPv6联机使用。举例来说，如果有蓝牙设备无法上网，那么通过蓝牙4.1连接到可以上网的设备之后，该设备就可以直接利用IPv6连接到网络，实现与WiFi相同的功能。尽管受传输速率的限制，该设备的上网应用有限，不过同步资料、收发邮件之类的操作还是完全可以实现的。这个改进的好处在于传感器、嵌入式设备只需蓝牙便可实现连接手机、连接互联网，相对而言WiFi多用于连接互联网，在连接设备方面效果一般，无法做到蓝牙的功能。未来随着物联网逐渐走进我们的生活，无线传输在日常生活中的地位也会越来越高，蓝牙作为普及最广泛的传输方式，将在“物联网”中起到不可忽视的作用。不过，蓝牙完全适应IPv6则需要更长的时间，所以就要看芯片厂商如何帮助蓝牙设备增加IPv6的兼容性了。
3）简化设备连接
在各大手机厂商以及PC厂商的推动下，几乎所有的移动设备和笔记本电脑中都装有蓝牙的模块，用户对于蓝牙的使用也比较多。不过仍有大量用户觉得蓝牙使用起来很麻烦，归根结底还是蓝牙设备较为复杂的配对、连接造成的。试想一下，如果与手机连接的智能手表，每次断开连接后，都得在设置界面中手动选择一次才能重新连接，这就非常麻烦了。之前解决这一问题的方法是厂商在两个蓝牙设备中都加入NFC芯片，通过NFC近场通讯的方式来简化重新配对的步骤，这本是个不错的思路。只是搭载NFC芯片的产品不仅数量少，而且价格偏高，非常小众。
蓝牙4.1针对这点进行了改进，对于设备之间的连接和重新连接进行了很大幅度的修改，可以为厂商在设计时提供更多的设计权限，包括设定频段创建或保持蓝牙连接，这以改变使得蓝牙设备连接的灵活性有了非常明显的提升。两款带有蓝牙4.1的设备之前已经成功配对，重新连接时只要将这两款设备靠近，即可实现重新连接，完全不需要任何手动操作。举个例子，以后使用蓝牙4.1的耳机时，只要打开电源开关就行了，不需要在手机上进行操作，非常的简单。
4）与4G和平共处
在移动通信领域，近期最火的话题莫过于4G了，已经成为全球无线通信网络一个不可逆转的发展趋势。而蓝牙4.1也专门针对4G进行了优化，确保可以与4G信号和平共处，这个改进被蓝牙技术联盟称为“共存性”。可能大家会觉得疑惑，手机网络信号和蓝牙不是早就共存了么，为什么蓝牙4.1还要特别针对这点改进呢？这是因为在实际的应用中，如果这两者同时传输数据，那么蓝牙通信就可能受到手机网络信号的干扰，导致传输速率的下降。因此在全新的蓝牙4.1标准中，一旦遇到蓝牙4.1和4G网络同时在传输数据的情况，那么蓝牙4.1就会自动协调两者的传输信息，从而减少其它信号对蓝牙4.1的干扰，用户也就不用担心传输速率下降的问题了。
5）蓝牙4.1提供的增强功能
包括：
AES加密技术提供更安全的连接。该功能使无线耳机更加适用于政府、医疗及银行等安全至上的应用领域。
可通过专属Bluetooth Smart远程遥控器操控耳机、扬声器及条形音箱，并支持同步播放源于另一个完全不同设备的音频流。
**八、蓝牙4.2标准**
2014年12月4日，蓝牙4.2标准颁布，改善了数据传输速度和隐私保护程度，可直接通过IPv6和6LoWPAN接入互联网。在新的标准下蓝牙信号想要连接或者追踪用户设备必须经过用户许可，否则蓝牙信号将无法连接和追踪用户设备。
速度方面变得更加快速，两部蓝牙设备之间的数据传输速度提高了2.5倍，因为蓝牙智能（Bluetooth Smart）数据包的容量提高，其可容纳的数据量相当于此前的10倍左右。
**九、蓝牙5.0协议**
于美国时间2016年6月16日在伦敦正式发布,为现阶段最高级的蓝牙协议标准。蓝牙5.0有以下特点：
（1）更快的传输速度
蓝牙5.0的开发人员称，新版本的蓝牙传输速度上限为2Mbps，是之前4.2LE版本的两倍。当然，你在实际生活中是不太可能达到这个极限速度的，但是仍然可以体验到显著的速度提升。
（2）更远的有效距离
蓝牙5.0的另外一个重要改进是，它的有效距离是上一版本的4倍，因此在理论上，当你拿着手机站在距离蓝牙音箱300米的地方，它还是会继续放着你爱的歌。也就是说，理论上，蓝牙发射和接收设备之间的有效工作距离可达300米。当然，实际的有效距离还取决于你使用的电子设备。
（3）导航功能
蓝牙5.0将添加更多的导航功能，因此该技术可以作为室内导航信标或类似定位设备使用，结合Wi-Fi可以实现精度小于1米的室内定位。举个例子，如果你是路痴，你仍可以使用蓝牙技术，在诺大的商业中心找到路。
（4）物联网功能
物联网还在持续火爆，因此，蓝牙5.0针对物联网进行了很多底层优化，力求以更低的功耗和更高的性能为智能家居服务。
（5）升级硬件
此前的一些蓝牙版本更新只要求升级软件，但蓝牙5.0很可能要求升级到新的芯片。不过，旧的硬件仍可以兼容蓝牙5.0，你就无法享用其新的性能了。搭载蓝牙5.0芯片的旗舰级手机将于2017年问世，相信中低端手机也将陆陆续续内置蓝牙5芯片。苹果将为成为第一批使用该项技术的厂商之一。
（6）更多的传输功能
全新的蓝牙5.0能够增加更多的数据传输功能，硬件厂商可以通过蓝牙5.0创建更复杂的连接系统，比如Beacon或位置服务。因此通过蓝牙设备发送的广告数据可以发送少量信息到目标设备中，甚至无需配对。
（7）更低的功耗
众所周知，蓝牙是智能手机的必备功能，随着智能设备和移动支付等越来越多需要打开蓝牙，才能享受便利功能逐渐融入人们的生活之中，蓝牙的功耗成为了智能手机待机时间的一大杀手。为此蓝牙5.0将大大降低了蓝牙的功耗，使人们在使用蓝牙的过程中再也不必担心待机时间短的问题。
（8）真正支持无损传输
支持24bit/192KHz的无损音源传输，对现有的Wi-Fi高保真无损音频传输形成有效威胁。
2.3.4蓝牙匹配规则
两个蓝牙设备在进行通讯前，必须将其匹配在一起，以保证其中一个设备发出的数据信息只会被经过允许的另一个设备所接受。蓝牙技术将设备分为两种：主设备和从设备。
**（1）蓝牙主设备**
主设备一般具有输入端。在进行蓝牙匹配操作时，用户通过输入端可输入随机的匹配密码来将两个设备匹配。
蓝牙手机、安装有蓝牙模块的PC等都是主设备。（例如：蓝牙手机和蓝牙PC进行匹配时，用户可在蓝牙手机上任意输入一组数字，然后在蓝牙PC上输入相同的一组数字，来完成这两个设备之间的匹配。）
**（2）蓝牙从设备**
从设备一般不具备输入端。因此从设备在出厂时，在其蓝牙芯片中，固化有一个4位或6位数字的匹配密码。蓝牙耳机、UD数码笔等都是从设备。（例如：蓝牙PC与UD数码笔匹配时，用户将UD笔上的蓝牙匹配密码正确的输入到蓝牙PC上，完成UD笔与蓝牙PC之间的匹配。）
**注意事项：**
主设备与主设备之间、主设备与从设备之间，是可以互相匹配在一起的；而从设备与从设备是无法匹配的。
例如：蓝牙PC与蓝牙手机可以匹配在一起；蓝牙PC也可以与UD笔匹配在一起；而UD笔与UD笔之间是不能匹配的。
一个主设备，可匹配一个或多个其他设备。例如：一部蓝牙手机，一般只能匹配7个蓝牙设备。而一台蓝牙PC，可匹配十多个或数十个蓝牙设备。
在同一时间，蓝牙设备之间仅支持点对点通讯。
### &nbsp;蓝牙应用


蓝牙技术可以应用于日常生活的各个方面，例如，引入蓝牙技术，就可以去掉移动电话与膝上型电脑之间的令人讨厌的连接电缆而而通过无线使其建立通信。
打印机、PDA、桌上型电脑、传真机、键盘、游戏操纵杆以及所有其它的数字设备都可以成为蓝牙系统的一部分。
# 3 &nbsp;远距离蜂窝通信协议
远距离蜂窝通信协议主要是2/3/4/5G、NB-IoT等技术下的各电信运营商采用的制式、协议，在这里就不再多为电信运营商和大设备商们摇旗了。
# 4 &nbsp;远距离非蜂窝通信协议
## &nbsp;ZigBee


### &nbsp;ZigBee简介


ZigBee这个名字来源于蜂群的通信方式：蜜蜂之间通过跳Zigzag形状的舞蹈来交互消息，以便共享食物源的方向、位置和距离等信息。借此意义Zigbee作为新一代无线通讯技术的命名。

<img src="//upload-images.jianshu.io/upload_images/6832932-473c803275b74ffb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-473c803275b74ffb.png?imageMogr2/auto-orient/strip" data-image-slug="473c803275b74ffb" data-width="204" data-height="183"><br>
&nbsp;```





```
&nbsp;
ZigBee是一种高可靠的无线数传网络，类似于CDMA和GSM网络。ZigBee数传模块类似于移动网络基站。ZigBee是一个由可多到65000个无线数传模块组成的一个无线网络平台，在整个网络范围内，每一个网络模块之间可以相互通信，每个网络节点间的距离可以从标准的75m无限扩展。通讯距离从标准的75m到几百米、几公里，并且支持无限扩展（依靠节点数增加）。与移动通信的CDMA网或GSM网不同的是，ZigBee网络主要是为工业现场自动化控制数据传输而建立，因而，它必须具有简单，使用方便，工作可靠，价格低的特点；而移动通信网主要是为语音通信而建立，每个基站价值一般都在几十万甚至上百万元人民币，而每个ZigBee网络“基站”（节点）却不到1000元人民币。
### &nbsp;技术特点


ZigBee是一种无线连接,可工作在2.4GHz(全球流行)、868MHz(欧洲流行)和915 MHz(美国流行)3个频段上,分别具有最高250kbit/s、20kbit/s和40kbit/s的传输速率,它的传输距离在10-75m的范围内,但可以继续增加。
作为一种无线通信技术,ZigBee具有如下特点:
(1)低功耗
(2)成本低
(3)时延短
(4)网络容量大
(5)可靠
(6)安全
### &nbsp;ZigBee协议栈


ZigBee协议栈结构是基于标准OSI七层模型的，包括高层应用规范、应用汇聚层、网络层、媒体接入层和物理层，如下图所示。

<img src="//upload-images.jianshu.io/upload_images/6832932-a06e2aaaf5cda536.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" data-original-src="//upload-images.jianshu.io/upload_images/6832932-a06e2aaaf5cda536.png?imageMogr2/auto-orient/strip" data-image-slug="a06e2aaaf5cda536" data-width="188" data-height="292"><br>
&nbsp;```





```
&nbsp;
IEEE&nbsp;802.15.4定义了两个物理层标准，分别是2.4GHz物理层和868/915MHz物理层。两者均基于直接序列扩频（DSSS）技术。
868MHz只有一个信道，传输速率为20kb/s；902MHz～928MHZ频段有10个信道，信道间隔为2MHz，传输速率为40kb/s。以上这两个频段都采用BPSK调制。
2.4GHz～2.4835 GHz频段有16个信道，信道间隔为5MHz，能够提供250kb/s的传输速率，采用O-QPSK调制。
为了提高传输数据的可靠性，IEEE 802.15.4定义的媒体接入控制（MAC）层采用了CSMA-CA和时隙CSMA-CA信道接入方式和完全握手协议。
应用汇聚层主要负责把不同的应用映射到ZigBee网络上，主要包括安全与鉴权、多个业务数据流的会聚、设备发现和业务发现。
### &nbsp;应用领域


（1）家庭和建筑物的自动化控制：照明、空调、窗帘等家具设备的远程控制；
（2）消费性电子设备：电视、DVD、CD机等电器的远程遥控。
（3）PC外设：无线键盘、鼠标、游戏操纵杆等；
（4）工业控制：使数据的自动采集、分析和处理变得更加容易；
（5） 医疗设备控制：医疗传感器、病人的紧急呼叫按钮等；
（6）交互式玩具。
## &nbsp;LoRa


LoRa™(Long&nbsp;Range，远距离)是一种调制技术，与同类技术相比，提供更远的通信距离。由于LoRa调制是物理层（PHY），因此也可将其用于不同的协议和不同网络架构（如Mesh、Star、点对点）等等。可以将LoRa概括为以下几种协议：
（1）LoRaWAN协议
（2）CLAA网络协议
（3）LoRa私有网络协议
（4）LoRa数据透传
LoRa的协议不同，其产品和业务形态也有所不同。
### &nbsp;LoRaWAN协议


LoRaWAN协议是由LoRa联盟推动的一种低功耗广域网协议，针对低成本、电池供电的传感器进行了优化，包括不同类别的节点，优化了网络延迟和电池寿命。LoRa联盟标准化了LoRaWAN，以确保不同国家的LoRa网络是可以互操作的。
LoRaWAN构建的是一个运营商级的大网，覆盖地区乃至全国的网络。经过几年的发展，目前已建立起了较为完整的生态链：LoRa芯片→模组→传感器→基站或网关→网络服务→应用服务。
在芯片方面，<a href="http://www.loraapp.com/company/semtech-china/" target="_blank">Semtech</a>授权了多家公司做芯片，如ST、Micorochip、华普等，使得芯片产品更为丰富，一芯多源，产品不再受限于一家供应商。未来或许会有更多的厂家授权，生产出满足物联网市场多样化需求的产品来。
在LoRaWAN网络还没有部署好的时候，符合LoRaWAN协议的模组还不能像2G/3G/4G模组等一样自由销售。一般地LoRaWAN模组是与网关或基站的产品搭配一起销售。部分厂家也开源了终端部分，提供网关和网络服务部分的解决方案。
在LoRaWAN的产品中，多数厂家是以提供（云）端到（终）端的解决方案为主，包括模组、网关和网络服务器（Network Server），如NPLINK、八月科技、华立、唯传、门思、未来宽带等公司。由于对设备数据的要求不同，LoRaWAN网络服务（NS）有的是私有化部署，有的是部署在公有云或第三方网络服务器上。
LoRaWAN目前还基本上是面向toB的市场，还没有普及到toC市场。一些具有行业或市场资源的公司会较早地部署LoRaWAN网络，改变原有或创造新的应用系统，而低功耗广域网市场的创新活力也在于此。
### &nbsp;CLAA协议


“中国LoRa应用联盟(China Lora Application Alliance，简称CLAA)是在LoRa Alliance支持下，由中兴通讯发起，各行业物联网应用创新主体广泛参与、合作共建的技术联盟，旨在共同建立中国LoRa应用合作生态圈，推动LoRa产业链在中国的应用和发展，建设多业务共享、低成本、广覆盖、可运营的LoRa物联网。中兴通讯作为LoRa Alliance(简称LoRa联盟)董事会成员，与LoRa联盟成员一起共同推动LoRa技术在全球低功耗广域网络(LPWAN)建设和产业链的发展。”
中兴通讯在LoRaWAN的基础上优化了协议，构建了共建共享的LoRa应用平台。凭借中兴通讯行业的实力和影响力，在CLAA平台上已聚集了很多公司的产品。CLAA提供网关和云化核心网服务，可快速搭建起LoRa网络的物联网系统的应用来。
CLAA有四种主要的业务合作模式：
**（1）独立运营商：**提供全套解决方案；支持客户建网，并与CLAA共享物联网互联互通
**（2）大型合作伙伴：**直接参股，CLAA负责建网，多城市大范围覆盖，享受全网整体受益，CLAA承担运维费
**（3）中小型客户：**直接采购设备，CLAA协助建网，城市级或区域级覆盖，享受城市级、区域级收益，客户承担运维费
**（4）专业渠道商：**直接采购设备，自行微客户建网，协助客户运营，客户承担运维费用
### &nbsp;LoRa私有网络协议


在面向小范围节点数不多的应用中，使用LoRaWAN网关部署网络成本就显得高了。用一个或几个SX127x做一个小“网关”或“集中器”，无线连接上百个的SX127x，组建一个小的星型网络，通过自己的LoRa私有通信协议，就可以实现一个简单的LoRa私有网络，这也是一种比较灵活方式。当然，协议也可以是LoRaWAN协议。
### &nbsp;LoRa数据透传


目前市面上LoRa芯片基本上源于美国SEMTECH的SX127x系列，用LoRa做成透传模块，只进行简单的发送和接收，实现点对点数据的传输，应用相对简单。
# 5 &nbsp;有线通信协议
## &nbsp;USB协议


目前USB已经发展了3代协议：
USB协议规范1.1——支持USB低速和全速规范（12Mbps）
USB协议规范2.0——支持USB高速协议规范(480Mbps)
USB协议规范3.0——支持USB超高速协议规范（5Gbps）
USB&nbsp;3.0是最新的USB规范，该规范由英特尔等公司发起。USB 2.0已经得到了PC厂商普遍认可，接口更成为了硬件厂商的必备接口。USB2.0的最大传输带宽为480Mbps（60MB/s），而USB3.0的最大传输带宽高达5.0Gbps（即640MB/s）。不过注意这是理论传输值，如果几台设备共用一个USB通道，主控制芯片会对每台设备可支配的带宽进行分配、控制。如在USB1.1中，所有设备只能共享1.5MB/s的带宽。如果单一的设备占用USB接口所有带宽的话，就会给其他设备的使用带来困难。
# 5.2 &nbsp;RS232协议
RS232是一种异步传输标准接口协议。通常RS-232接口以9个引脚(DB-9)或是25个引脚(DB-25)的型态出现 。RS232最常用的连接方式是三根线：一条发送线、一条接收线及一条地线。
电平信号：逻辑1(MARK)=-3V～-15V，逻辑0(SPACE)=+3～+15V
传输距离：RS-232-C标准规定，驱动器允许有2500pF的电容负载，通信距离将受此电容限制，例如，采用150pF/m的通信电缆时，最大通信距离为15m；若每米电缆的电容量减小，通信距离可以增加。传输距离短的另一原因是RS-232属单端信号传送，存在共地噪声和不能抑制共模干扰（两条传输线上的信号同时变大或变小）等问题，因此一般用于20m以内的通信。
RS232不能实现多机通信。
传输速率：RS232的传输速率较慢，能够达到1Mbps的已经比较少。
## &nbsp;RS485协议


RS485是RS232升级版的串口协议，一般采用两线制传输：A、B两条传输线。
电平信号：-2V～-6V表示“0”，+2V～+6V表示“1”，电压为A-B的电压。
传输距离：一般1Km以内都没有问题。理论上，通信速率在100Kpbs及以下时，RS485的最长传输距离可达1200米，但在实际应用中传输的距离也因芯片及电缆的传输特性而所差异。在传输过程中可以采用增加中继的方法对信号进行放大，最多可以加八个中继，也就是说理论上RS485的最大传输距离可以达到9.6公里。如果真需要长距离传输，可以采用光纤为传播介质，收发两端各加一个光电转换器，多模光纤的传输距离是5~10公里，而采用单模光纤可达50公里的传播距离。
RS485可以实现多机通信。
原因：RS485为半双工通信方式，即分时实现收和发。总线空闲的状态下需要保证状态为逻辑1，也就是A-B的电压符合逻辑1的电平值。假设此时1为主机，2和3为从机，数据线的连接方式为1,2,3的A连接在一起，1,2,3的B也连接在一起，不存在RS232连接方式的问题。
异步传输（Asynchronous Transmission）： 异步传输将比特分成小组进行传送，小组可以是8位的1个字符或更长。发送方可以在任何时刻发送这些比特组，而接收方从不知道它们会在什么时候到达。一个常见的例子是计算机键盘与主机的通信。
波特率计算：如果设置波特率为115200,数据位为8bit，起始位为1bit，结束位为1bit，校验位为1bit；那1s钟不间断可传送的字符（1bit起始位+8bit数据位+1bit校验位+1bit结束位，共11bit）为115200/11=10472；10472/1024结果约为10.227所以速率约为10kB/ps。
# 5.4 &nbsp;M-Bus协议
M-BUS在本文中暂不介绍，因为笔者在后续文章中将分享远程抄表系统，而M-Bus是为远程抄表系统数据采集而诞生的，在远程抄表系统中，笔者将会对M-Bus协议进行分析。




```

<br><br><br>
<table style="border: 1px solid rgba(14, 144, 8, 1); background-color: rgba(225, 253, 195, 1); height: 366px; width: 979px" border="1" align="center">
<tbody>
<tr>
<td>
**提纲**
**1 物联网数据卡系统源码——前篇**
<a href="http://www.cnblogs.com/tuyile006/p/6610943.html" target="_blank">1.1 物联网技术架构图</a>
<a href="http://www.cnblogs.com/tuyile006/p/6610511.html" target="_blank">1.2 物联网的主要应用领域</a>
<a href="http://www.cnblogs.com/tuyile006/p/7721771.html" target="_blank">1.3 物联网传感器61个应用领域</a>
<a href="http://www.cnblogs.com/tuyile006/p/7239917.html" target="_blank">1.4 物联网常见通信协议梳理</a>
**2 物联网数据卡系统源码——通信模块**
<a href="http://www.cnblogs.com/tuyile006/p/6610895.html" target="_blank">2.1 通信模块整体概述</a>
2.2 协议封装和实现
<a href="http://www.cnblogs.com/tuyile006/p/5707271.html" target="_blank">2.3 长短信</a>
<a href="https://www.cnblogs.com/tuyile006/p/12631382.html" target="_blank">2.4 粘包的处理</a>
<a href="http://www.cnblogs.com/tuyile006/p/7004393.html" target="_blank">2.5 物联网通讯与普通短信通讯的区别和要注意的地方</a>
**3 物联网数据卡系统源码——Windows服务模块**
3.1 Windows服务模块概述
3.2 Windows服务模块实现
3.3 高并发回调处理
3.4 部署安装


</td>


</tr>


</tbody>


</table>
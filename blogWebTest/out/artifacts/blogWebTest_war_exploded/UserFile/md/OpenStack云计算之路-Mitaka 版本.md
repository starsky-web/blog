## äº‘è®¡ç®—ç®€ä»‹


äº‘è®¡ç®—ï¼ˆè‹±è¯­ï¼šcloud computing ï¼‰ï¼Œæ˜¯ä¸€ç§åŸºäºäº’è”ç½‘çš„è®¡ç®—æ–¹å¼ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå…±äº«çš„è½¯ç¡¬ä»¶èµ„æºå’Œä¿¡æ¯å¯ä»¥æŒ‰éœ€æ±‚æä¾›ç»™è®¡ç®—æœºå„ç§ç»ˆç«¯å’Œå…¶ä»–è®¾å¤‡ã€‚
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127174019272-614459598.png" alt="">
äº‘è®¡ç®—æ˜¯ç»§1980å¹´ä»£å¤§å‹è®¡ç®—æœºåˆ°å®¢æˆ·ç«¯-æœåŠ¡å™¨çš„å¤§è½¬å˜ä¹‹åçš„åˆä¸€ç§å·¨å˜ã€‚ç”¨æˆ·ä¸å†éœ€è¦äº†è§£â€œäº‘â€ä¸­åŸºç¡€è®¾æ–½çš„ç»†èŠ‚ï¼Œä¸å¿…å…·æœ‰ç›¸åº”çš„ä¸“ä¸šçŸ¥è¯†ï¼Œä¹Ÿæ— éœ€ç›´æ¥è¿›è¡Œæ§åˆ¶ã€‚äº‘è®¡ç®—æè¿°äº†ä¸€ç§åŸºäºäº’è”ç½‘çš„æ–°çš„ITæœåŠ¡å¢åŠ ã€ä½¿ç”¨å’Œäº¤ä»˜æ¨¡å¼ï¼Œé€šå¸¸æ¶‰åŠé€šè¿‡äº’è”ç½‘æ¥æä¾›åŠ¨æ€æ˜“æ‰©å±•è€Œä¸”ç»å¸¸æ˜¯è™šæ‹ŸåŒ–çš„èµ„æºã€‚
### äº‘è®¡ç®—çš„ç‰¹ç‚¹


äº’è”ç½‘ä¸Šçš„äº‘è®¡ç®—æœåŠ¡ç‰¹å¾å’Œè‡ªç„¶ç•Œçš„äº‘ã€æ°´å¾ªç¯å…·æœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼Œå› æ­¤ï¼Œäº‘æ˜¯ä¸€ä¸ªç›¸å½“è´´åˆ‡çš„æ¯”å–»ã€‚æ ¹æ®æŠ€æœ¯ç ”ç©¶é™¢çš„å®šä¹‰å¦‚ä¸‹ã€‚
**äº‘è®¡ç®—æœåŠ¡åº”è¯¥å…·å¤‡ä»¥ä¸‹å‡ æ¡ç‰¹å¾ï¼š**
ğŸ¥¦ éšéœ€åº”å˜è‡ªåŠ©æœåŠ¡ã€‚
ğŸ¥¦ éšæ—¶éšåœ°ç”¨ä»»ä½•ç½‘ç»œè®¾å¤‡è®¿é—®ã€‚
ğŸ¥¦ å¤šäººå…±äº«èµ„æºæ± ã€‚
ğŸ¥¦ å¿«é€Ÿé‡æ–°éƒ¨ç½²çµæ´»åº¦ã€‚
ğŸ¥¦ å¯è¢«ç›‘æ§ä¸é‡æµ‹çš„æœåŠ¡ã€‚
**ä¸€èˆ¬è®¤ä¸ºè¿˜æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š**
ğŸ€ åŸºäºè™šæ‹ŸåŒ–æŠ€æœ¯å¿«é€Ÿéƒ¨ç½²èµ„æºæˆ–è·å¾—æœåŠ¡ã€‚
ğŸ€ å‡å°‘ç”¨æˆ·ç»ˆç«¯çš„å¤„ç†è´Ÿæ‹…ã€‚
ğŸ€ é™ä½äº†ç”¨æˆ·å¯¹äºITä¸“ä¸šçŸ¥è¯†çš„ä¾èµ–ã€‚
### äº‘è®¡ç®—æœåŠ¡æ¨¡å¼


äº‘è®¡ç®—å®šä¹‰ä¸­æ˜ç¡®äº†ä¸‰ç§æœåŠ¡æ¨¡å¼ï¼š
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127174029490-1843732919.png" alt="">
å›¾ - æœåŠ¡æ¨¡å¼è¯¦æƒ…
**è½¯ä»¶å³æœåŠ¡ï¼ˆSaaS****ï¼‰ï¼š**
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **å³Software-as-a-serviceï¼›
æ¶ˆè´¹è€…ä½¿ç”¨åº”ç”¨ç¨‹åºï¼Œä½†å¹¶ä¸æŒæ§æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶æˆ–è¿ä½œçš„ç½‘ç»œåŸºç¡€æ¶æ„ã€‚æ˜¯ä¸€ç§æœåŠ¡è§‚å¿µçš„åŸºç¡€ï¼Œè½¯ä»¶æœåŠ¡ä¾›åº”å•†ï¼Œä»¥ç§Ÿèµçš„æ¦‚å¿µæä¾›å®¢æˆ·æœåŠ¡ï¼Œè€Œéè´­ä¹°ï¼Œæ¯”è¾ƒå¸¸è§çš„æ¨¡å¼æ˜¯æä¾›ä¸€ç»„è´¦å·å¯†ç ã€‚
ä¾‹å¦‚ï¼šMicrosoft CRMä¸Salesforce.comã€‚
**å¹³å°å³æœåŠ¡ï¼ˆPaaS****ï¼‰ï¼š**
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **å³Platform-as-a-serviceï¼›
æ¶ˆè´¹è€…ä½¿ç”¨ä¸»æœºæ“ä½œåº”ç”¨ç¨‹åºã€‚æ¶ˆè´¹è€…æŒæ§è¿ä½œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼ˆä¹Ÿæ‹¥æœ‰ä¸»æœºéƒ¨åˆ†æŒæ§æƒï¼‰ï¼Œä½†å¹¶ä¸æŒæ§æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶æˆ–è¿ä½œçš„ç½‘ç»œåŸºç¡€æ¶æ„ã€‚å¹³å°é€šå¸¸æ˜¯åº”ç”¨ç¨‹åºåŸºç¡€æ¶æ„ã€‚
ä¾‹å¦‚ï¼šGoogle App Engineã€‚
**åŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆIaaS****ï¼‰ï¼š**
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **å³Infrastructure-as-a-serviceï¼›
æ¶ˆè´¹è€…ä½¿ç”¨â€œåŸºç¡€è®¡ç®—èµ„æºâ€ï¼Œå¦‚å¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç©ºé—´ã€ç½‘ç»œç»„ä»¶æˆ–ä¸­é—´ä»¶ã€‚æ¶ˆè´¹è€…èƒ½æŒæ§æ“ä½œç³»ç»Ÿã€å­˜å‚¨ç©ºé—´ã€å·²éƒ¨ç½²çš„åº”ç”¨ç¨‹åºåŠç½‘ç»œç»„ä»¶ï¼ˆå¦‚é˜²ç«å¢™ã€è´Ÿè½½å¹³è¡¡å™¨ç­‰ï¼‰ï¼Œä½†å¹¶ä¸æŒæ§äº‘åŸºç¡€æ¶æ„ã€‚
ä¾‹å¦‚ï¼šAmazon AWSã€Rackspaceã€‚
å…³äºè¿™ä¸‰ç§æœåŠ¡æ¨¡å¼æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š<a href="https://www.zhihu.com/question/21641778">https://www.zhihu.com/question/21641778</a>
### äº‘è®¡ç®—çš„ç±»å‹


&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127174039553-242648718.png" alt="">
å›¾ - äº‘ç±»å‹ç¤ºä¾‹
**ğŸ”Š ****å…¬æœ‰äº‘ï¼ˆPublic Cloud****ï¼‰**
ç®€è€Œè¨€ä¹‹ï¼Œå…¬ç”¨äº‘æœåŠ¡å¯é€šè¿‡ç½‘ç»œåŠç¬¬ä¸‰æ–¹æœåŠ¡ä¾›åº”è€…ï¼Œå¼€æ”¾ç»™å®¢æˆ·ä½¿ç”¨ï¼Œâ€œå…¬æœ‰â€ä¸€è¯å¹¶ä¸ä¸€å®šä»£è¡¨â€œå…è´¹â€ï¼Œä½†ä¹Ÿå¯èƒ½ä»£è¡¨å…è´¹æˆ–ç›¸å½“å»‰ä»·ï¼Œå…¬ç”¨äº‘å¹¶ä¸è¡¨ç¤ºç”¨æˆ·æ•°æ®å¯ä¾›ä»»ä½•äººæŸ¥çœ‹ï¼Œå…¬ç”¨äº‘ä¾›åº”è€…é€šå¸¸ä¼šå¯¹ç”¨æˆ·å®æ–½ä½¿ç”¨è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œå…¬ç”¨äº‘ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œæ—¢æœ‰å¼¹æ€§ï¼Œåˆå…·å¤‡æˆæœ¬æ•ˆç›Šã€‚
**ğŸ”Š ****ç§æœ‰äº‘ï¼ˆPrivate Cloud****ï¼‰**
ç§æœ‰äº‘å…·å¤‡è®¸å¤šå…¬ç”¨äº‘ç¯å¢ƒçš„ä¼˜ç‚¹ï¼Œä¾‹å¦‚å¼¹æ€§ã€é€‚åˆæä¾›æœåŠ¡ï¼Œä¸¤è€…å·®åˆ«åœ¨äºç§æœ‰äº‘æœåŠ¡ä¸­ï¼Œæ•°æ®ä¸ç¨‹åºçš†åœ¨ç»„ç»‡å†…ç®¡ç†ï¼Œä¸”ä¸å…¬ç”¨äº‘æœåŠ¡ä¸åŒï¼Œä¸ä¼šå—åˆ°ç½‘ç»œå¸¦å®½ã€å®‰å…¨ç–‘è™‘ã€æ³•è§„é™åˆ¶å½±å“ï¼›æ­¤å¤–ï¼Œç§æœ‰äº‘æœåŠ¡è®©ä¾›åº”è€…åŠç”¨æˆ·æ›´èƒ½æŒæ§äº‘åŸºç¡€æ¶æ„ã€æ”¹å–„å®‰å…¨ä¸å¼¹æ€§ï¼Œå› ä¸ºç”¨æˆ·ä¸ç½‘ç»œéƒ½å—åˆ°ç‰¹æ®Šé™åˆ¶ã€‚
**ğŸ”Š ****æ··åˆäº‘ï¼ˆHybrid Cloud****ï¼‰**
æ··åˆäº‘ç»“åˆå…¬ç”¨äº‘åŠç§æœ‰äº‘ï¼Œè¿™ä¸ªæ¨¡å¼ä¸­ï¼Œç”¨æˆ·é€šå¸¸å°†éä¼ä¸šå…³é”®ä¿¡æ¯å¤–åŒ…ï¼Œå¹¶åœ¨å…¬ç”¨äº‘ä¸Šå¤„ç†ï¼Œä½†åŒæ—¶æŒæ§ä¼ä¸šå…³é”®æœåŠ¡åŠæ•°æ®ã€‚
### ä¸ºä»€ä¹ˆè¦é€‰æ‹©äº‘è®¡ç®—


1ã€æœ‰æ•ˆè§£å†³ç¡¬ä»¶å•ç‚¹æ•…éšœé—®é¢˜
2ã€æŒ‰éœ€å¢/å‡ç¡¬ä»¶èµ„æº
3ã€BGPçº¿è·¯è§£å†³å—åŒ—äº’é€šé—®é¢˜
4ã€æŒ‰éœ€å¢/å‡å¸¦å®½
5ã€æ›´æœ‰å¸å¼•åŠ›çš„è´¹ç”¨æ”¯ä»˜æ–¹å¼
è¯¦æƒ…æŸ¥çœ‹ã€Šäº‘è®¡ç®—ä¹‹è·¯ï¼šä¸ºä»€ä¹ˆè¦é€‰æ‹©äº‘è®¡ç®—ã€‹
<a href="https://www.cnblogs.com/cmt/archive/2013/02/27/why-into-cloud.html">https://www.cnblogs.com/cmt/archive/2013/02/27/why-into-cloud.html</a>
## OpenStackç®€ä»‹


&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127174053522-857175765.png" alt="">
OpenStackæ˜¯ä¸€ä¸ªç¾å›½å®‡èˆªå±€å’ŒRackspaceåˆä½œç ”å‘çš„äº‘è®¡ç®—è½¯ä»¶ï¼Œä»¥Apacheæˆæƒæ¡æ¬¾2.0æˆæƒï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªè‡ªç”±è½¯ä»¶å’Œå¼€æ”¾æºä»£ç é¡¹ç›®ã€‚
OpenStackæ˜¯åŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆIaaSï¼‰è½¯ä»¶ï¼Œè®©ä»»ä½•äººéƒ½å¯ä»¥è‡ªè¡Œåˆ›å»ºå’Œæä¾›äº‘è®¡ç®—æœåŠ¡ã€‚
æ­¤å¤–ï¼ŒOpenStackä¹Ÿç”¨ä½œåˆ›å»ºé˜²ç«å¢™å†…çš„â€œç§æœ‰äº‘â€ï¼ˆPrivate Cloudï¼‰ï¼Œæä¾›æœºæ„æˆ–ä¼ä¸šå†…å„éƒ¨é—¨å…±äº«èµ„æºã€‚
### å¸‚åœºè¶‹å‘


Rackspaceä»¥OpenStackä¸ºåŸºç¡€çš„ç§æœ‰äº‘ä¸šåŠ¡æ¯å¹´è¥æ”¶7äº¿ç¾å…ƒï¼Œå¢é•¿ç‡è¶…è¿‡äº†20%ã€‚
OpenStackè™½ç„¶æœ‰äº›æ–¹é¢è¿˜ä¸å¤ªæˆç†Ÿï¼Œç„¶è€Œå®ƒæœ‰å…¨çƒå¤§é‡çš„ç»„ç»‡æ”¯æŒï¼Œå¤§é‡çš„å¼€å‘äººå‘˜å‚ä¸ï¼Œå‘å±•è¿…é€Ÿã€‚å›½é™…ä¸Šå·²ç»æœ‰å¾ˆå¤šä½¿ç”¨OpenStackæ­å»ºçš„å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ï¼Œä¾‹å¦‚ï¼šRackspaceCloudã€æƒ æ™®äº‘ã€MercadoLibreçš„ITåŸºç¡€è®¾æ–½äº‘ã€AT&amp;Tçš„CloudArchitecã€æˆ´å°”çš„OpenStackè§£å†³æ–¹æ¡ˆç­‰ç­‰ã€‚è€Œåœ¨å›½å†…OpenStackçš„çƒ­åº¦ä¹Ÿåœ¨é€æ¸å‡æ¸©ï¼Œåèƒœå¤©æˆã€é«˜å¾·åœ°å›¾ã€äº¬ä¸œã€é˜¿é‡Œå·´å·´ã€ç™¾åº¦ã€ä¸­å…´ã€åä¸ºç­‰éƒ½å¯¹OpenStackäº§ç”Ÿäº†æµ“åšçš„å…´è¶£å¹¶å‚ä¸å…¶ä¸­ã€‚
è‡ª2010å¹´åˆ›ç«‹ä»¥æ¥ï¼Œå·²å‘å¸ƒ10ä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­Icehouseç‰ˆæœ¬æœ‰120ä¸ªç»„ç»‡ã€1202åä»£ç è´¡çŒ®è€…å‚ä¸ï¼Œè€Œæœ€æ–°çš„æ˜¯Junoç‰ˆæœ¬ã€‚OpenStackå¾ˆå¯èƒ½åœ¨æœªæ¥çš„åŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆIaaSï¼‰èµ„æºç®¡ç†æ–¹é¢å æ®é¢†å¯¼ä½ç½®ï¼Œæˆä¸ºå…¬æœ‰äº‘ã€ç§æœ‰äº‘åŠæ··åˆäº‘ç®¡ç†çš„â€œäº‘æ“ä½œç³»ç»Ÿâ€æ ‡å‡†
### å¤§å‹ç”¨æˆ·


ç¾å›½å›½å®¶èˆªç©ºèˆªå¤©å±€
åŠ æ‹¿å¤§åŠå®˜æ–¹æœºæ„CANARIEç½‘ç»œçš„DAIRï¼ˆDigital Accelerator for Innovation and Researchï¼‰é¡¹ç›®ï¼Œå‘å¤§å­¦ä¸ä¸­å°å‹ä¼ä¸šæä¾›ç ”ç©¶å’Œå¼€å‘äº‘ç«¯è¿ç®—ç¯å¢ƒã€‚
æƒ æ™®äº‘ï¼ˆä½¿ç”¨Ubuntu Linuxï¼‰
MercadoLibreçš„ITåŸºç¡€è®¾æ–½äº‘ï¼Œç°æ—¶ä»¥OpenStackç®¡ç†è¶…è¿‡6000 å°è™šæ‹Ÿæœºå™¨ã€‚
AT&amp;Tçš„â€œCloud Architectâ€ï¼Œå°†åœ¨ç¾å›½çš„è¾¾æ‹‰æ–¯ã€åœ£åœ°äºšå“¥å’Œæ–°æ³½è¥¿å·æä¾›å¯¹å¤–äº‘ç«¯æœåŠ¡ã€‚
### OpenStacké¡¹ç›®ä»‹ç»


&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127174109444-562856729.png" alt="">
å›¾ - å„é¡¹ç›®å…³ç³»å›¾
å„ç»„ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š
<table style="width: 100%; border-collapse: collapse; border-style: none" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 23%; border-top: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" width="23%">
**æœåŠ¡ç±»å‹**
</td>
<td style="width: 17.62%; border-top: 1pt solid rgba(155, 187, 89, 1); border-left: none; border-bottom: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" width="17%">
**é¡¹ç›®åç§°**
</td>
<td style="width: 59.38%; border-top: 1pt solid rgba(155, 187, 89, 1); border-right: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" width="59%">
**æè¿°**
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="23%">
**Dashboard**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="17%">
Horizon
æä¾›webç•Œé¢
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="59%">
æä¾›äº†ä¸€ä¸ªåŸºäºwebçš„è‡ªæœåŠ¡é—¨æˆ·ï¼Œä¸OpenStackåº•å±‚æœåŠ¡äº¤äº’ï¼Œè¯¸å¦‚å¯åŠ¨ä¸€ä¸ªå®ä¾‹ï¼Œåˆ†é…IPåœ°å€ä»¥åŠé…ç½®è®¿é—®æ§åˆ¶ã€‚
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="23%">
**Compute**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="17%">
Nova
è®¡ç®—èŠ‚ç‚¹
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="59%">
åœ¨OpenStackç¯å¢ƒä¸­è®¡ç®—å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚æŒ‰éœ€å“åº”åŒ…æ‹¬ç”Ÿæˆã€è°ƒåº¦ã€å›æ”¶è™šæ‹Ÿæœºç­‰æ“ä½œã€‚
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="23%">
**Networking**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="17%">
Neutron
ç½‘ç»œæœåŠ¡
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="59%">
ç¡®ä¿ä¸ºå…¶å®ƒOpenStackæœåŠ¡æä¾›ç½‘ç»œè¿æ¥å³æœåŠ¡ï¼Œæ¯”å¦‚OpenStackè®¡ç®—ã€‚ä¸ºç”¨æˆ·æä¾›APIå®šä¹‰ç½‘ç»œå’Œä½¿ç”¨ã€‚åŸºäºæ’ä»¶çš„æ¶æ„å…¶æ”¯æŒä¼—å¤šçš„ç½‘ç»œæä¾›å•†å’ŒæŠ€æœ¯ã€‚
</td>
</tr>
<tr>
<td style="width: 100%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(84, 141, 212, 1); padding: 0 5.4pt" colspan="3" width="100%">
**å­˜å‚¨**
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="23%">
**Object Storage**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="17%">
Swift
å¯¹è±¡å­˜å‚¨
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="59%">
é€šè¿‡ä¸€ä¸ª RESTful,åŸºäºHTTPçš„åº”ç”¨ç¨‹åºæ¥å£å­˜å‚¨å’Œä»»æ„æ£€ç´¢çš„éç»“æ„åŒ–æ•°æ®å¯¹è±¡ã€‚å®ƒæ‹¥æœ‰é«˜å®¹é”™æœºåˆ¶ï¼ŒåŸºäºæ•°æ®å¤åˆ¶å’Œå¯æ‰©å±•æ¶æ„ã€‚å®ƒçš„å®ç°å¹¶åƒæ˜¯ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨éœ€è¦æŒ‚è½½ç›®å½•ã€‚åœ¨æ­¤ç§æ–¹å¼ä¸‹ï¼Œå®ƒå†™å…¥å¯¹è±¡å’Œæ–‡ä»¶åˆ°å¤šä¸ªç¡¬ç›˜ä¸­ï¼Œä»¥ç¡®ä¿æ•°æ®æ˜¯åœ¨é›†ç¾¤å†…è·¨æœåŠ¡å™¨çš„å¤šä»½å¤åˆ¶ã€‚
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="23%">
**Block Storage**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="17%">
Cinder
å—å­˜å‚¨
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="59%">
ä¸ºè¿è¡Œå®ä¾‹è€Œæä¾›çš„æŒä¹…æ€§å—å­˜å‚¨ã€‚å®ƒçš„å¯æ’æ‹”é©±åŠ¨æ¶æ„çš„åŠŸèƒ½æœ‰åŠ©äºåˆ›å»ºå’Œç®¡ç†å—å­˜å‚¨è®¾å¤‡ã€‚
</td>
</tr>
<tr>
<td style="width: 100%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(217, 149, 148, 1); padding: 0 5.4pt" colspan="3" width="100%">
**å…±äº«æœåŠ¡**
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="23%">
**Identity service**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="17%">
Keystone
è®¤è¯èŠ‚ç‚¹
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="59%">
ä¸ºå…¶ä»–OpenStackæœåŠ¡æä¾›è®¤è¯å’ŒæˆæƒæœåŠ¡ï¼Œä¸ºæ‰€æœ‰çš„OpenStackæœåŠ¡æä¾›ä¸€ä¸ªç«¯ç‚¹ç›®å½•ã€‚
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="23%">
**Image service**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="17%">
Glance
é•œåƒæœåŠ¡
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="59%">
å­˜å‚¨å’Œæ£€ç´¢è™šæ‹Ÿæœºç£ç›˜é•œåƒï¼ŒOpenStackè®¡ç®—ä¼šåœ¨å®ä¾‹éƒ¨ç½²æ—¶ä½¿ç”¨æ­¤æœåŠ¡ã€‚
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="23%">
**Telemetry**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="17%">
Ceilometer
è®¡è´¹
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="59%">
ä¸ºOpenStackäº‘çš„è®¡è´¹ã€åŸºå‡†ã€æ‰©å±•æ€§ä»¥åŠç»Ÿè®¡ç­‰ç›®çš„æä¾›ç›‘æµ‹å’Œè®¡é‡ã€‚
</td>
</tr>
<tr>
<td style="width: 100%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(146, 208, 80, 1); padding: 0 5.4pt" colspan="3" width="100%">
**é«˜å±‚æ¬¡æœåŠ¡**
</td>
</tr>
<tr>
<td style="width: 23%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="23%">
**Orchestration**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="17%">
Heat
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="59%">
OrchestrationæœåŠ¡æ”¯æŒå¤šæ ·åŒ–çš„ç»¼åˆçš„äº‘åº”ç”¨ï¼Œé€šè¿‡è°ƒç”¨OpenStack-native REST APIå’ŒCloudFormation-compatible Query APIï¼Œæ”¯æŒ:term:`HOT <Heat Orchestration Template (HOT)>`æ ¼å¼æ¨¡æ¿æˆ–è€…AWS CloudFormationæ ¼å¼æ¨¡æ¿
</td>
</tr>
</tbody>
</table>
### ç³»ç»Ÿç¯å¢ƒè¯´æ˜


æœ¬æ–‡æ¡£ä½¿ç”¨ä¸»æœºç¯å¢ƒå‡å®‰è£…å®˜æ–¹æ¨èè¿›è¡Œè®¾ç½®ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment.html</a>
**controller****èŠ‚ç‚¹è¯´æ˜**
```python
[root@controller ~]# cat /etc/redhat-release 
CentOS Linux release 7.2.1511 (Core) 
[root@controller ~]# uname -r
3.10.0-327.el7.x86_64
[root@controller ~]# sestatus 
SELinux status:                 disabled
[root@controller ~]# systemctl status firewalld.service 
â— firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)
   Active: inactive (dead)
[root@controller ~]# hostname -I
10.0.0.11 172.16.1.11 
[root@controller ~]# tail -3  /etc/hosts
10.0.0.11   controller
10.0.0.31   compute1
10.0.0.32   compute2
```
compute1ä¸compute2èŠ‚ç‚¹çš„é…ç½®ä¸controllerç›¸åŒã€‚
ç³»ç»Ÿå®‰è£…å‚è€ƒæ–‡æ¡£ï¼š<a href="http://www.cnblogs.com/clsn/p/8338099.html#_label1">http://www.cnblogs.com/clsn/p/8338099.html#_label1</a>
ç³»ç»Ÿä¼˜åŒ–è¯´æ˜ï¼š<a href="http://www.cnblogs.com/clsn/p/8338099.html#_label4">http://www.cnblogs.com/clsn/p/8338099.html#_label4</a>
æ³¨æ„ç‚¹ï¼šç½‘å¡çš„åç§°ä¿®æ”¹
## OpenStackåŸºç¡€é…ç½®æœåŠ¡


æ³¨ï¼šæœ¬æ–‡ä¸­æ‰€ä½¿ç”¨çš„ç”¨æˆ·åŠå¯†ç éƒ½å‚è€ƒè¯¥æ–‡æ¡£ï¼Œå¹¶ä¸”é«˜åº¦ä¸€è‡´ã€‚
<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-security.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-security.html</a>
OpenStack ç›¸å…³æœåŠ¡å®‰è£…æµç¨‹ï¼ˆkeystoneæœåŠ¡é™¤å¤–ï¼‰ï¼š
1ï¼‰åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ›åº“ï¼Œæˆæƒï¼›
2ï¼‰åœ¨keystoneä¸­åˆ›å»ºç”¨æˆ·å¹¶æˆæƒï¼›
3ï¼‰åœ¨keystoneä¸­åˆ›å»ºæœåŠ¡å®ä½“ï¼Œå’Œæ³¨å†ŒAPIæ¥å£ï¼›
4ï¼‰å®‰è£…è½¯ä»¶åŒ…ï¼›
5ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“ä¿¡æ¯ï¼‰ï¼›
6ï¼‰åŒæ­¥æ•°æ®åº“ï¼›
7ï¼‰å¯åŠ¨æœåŠ¡ã€‚
### OpenStackæœåŠ¡éƒ¨ç½²é¡ºåº



<blockquote>

[1]&nbsp; åŸºç¡€ç¯å¢ƒå‡†å¤‡ <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment.html</a>
[2]&nbsp; éƒ¨ç½² Keystorne è®¤è¯æœåŠ¡,token <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone.html</a>
[3]&nbsp; éƒ¨ç½² Glance é•œåƒæœåŠ¡ <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html</a>
[4]&nbsp; éƒ¨ç½² Nova è®¡ç®—æœåŠ¡(kvm) <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova.html</a>
[5]&nbsp; éƒ¨ç½² Neutron ç½‘ç»œæœåŠ¡ <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron.html</a>
[6]&nbsp; éƒ¨ç½² Horizon æä¾›webç•Œé¢ <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html</a>
[7]&nbsp; éƒ¨ç½² Cinder å—å­˜å‚¨(ç¡¬ç›˜) <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html</a>
```
</blockquote>
```
### é…ç½®æœ¬åœ°yumæº


é¦–å…ˆå°†é•œåƒæŒ‚è½½åˆ° /mnt
```python
mount /dev/cdrom /mnt
echo 'mount /dev/cdrom /mnt' > /etc/rc.d/rc.local
chmod +x  /etc/rc.d/rc.local 
```
åˆ›å»ºrepoæ–‡ä»¶
```python
cat >/etc/yum.repos.d/local.repo<<-'EOF'
[local]
name=local
baseurl=file:///mnt
gpgcheck=0

[openstack]
name=openstack-mitaka
baseurl=file:///opt/repo
gpgcheck=0
EOF
```
ç”Ÿæˆyumç¼“å­˜
```python
[root@controller repo]# yum makecache
```
### å®‰è£…NTPæ—¶é—´æœåŠ¡


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-ntp.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-ntp.html</a>
æ§åˆ¶èŠ‚ç‚¹ï¼ˆæä¾›æ—¶é—´æœåŠ¡ï¼Œä¾›å…¶ä»–æœºå™¨åŒæ­¥ï¼‰
å®‰è£…è½¯ä»¶
```python
yum install chrony -y
```
é…ç½®æ§åˆ¶èŠ‚ç‚¹ï¼Œä¿®æ”¹ç¬¬22è¡Œ
```python
[root@controller ~]# vim /etc/chrony.conf 
Â·Â·Â·
# Allow NTP client access from local network.
allow 10/8
```
å¯åŠ¨ï¼Œè®¾ç½®è‡ªå¯åŠ¨
```python
systemctl enable chronyd.service
systemctl start chronyd.service
```
è®¡ç®—èŠ‚ç‚¹ï¼ˆé…ç½®chronyå®¢æˆ·ç«¯ï¼‰
å®‰è£…è½¯ä»¶
```python
yum install chrony -y
```
é…ç½®æ–‡ä»¶ç¬¬ä¸‰è¡Œï¼Œåˆ é™¤æ— ç”¨çš„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚
ä½¿ç”¨sedå‘½ä»¤ä¿®æ”¹
```python
sed -ri.bak '/server/s/^/#/g;2a server 10.0.0.11 iburst' /etc/chrony.conf
```
&nbsp;&nbsp; é…ç½®æ–‡ä»¶è¯´æ˜ï¼š
```python
[root@compute1 ~]# vim /etc/chrony.conf 
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
server 10.0.0.11 iburst
```
å¯åŠ¨ï¼Œè®¾ç½®è‡ªå¯åŠ¨
```python
systemctl enable chronyd.service
systemctl start chronyd.service
```
### OpenStackçš„åŒ…æ“ä½œï¼ˆæ·»åŠ æ–°çš„è®¡ç®—èŠ‚ç‚¹æ—¶éœ€è¦å®‰è£…ï¼‰


&nbsp;&nbsp; å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-packages.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-packages.html</a>
å®‰è£… OpenStack å®¢æˆ·ç«¯ï¼š
```python
yum -y install python-openstackclient 
```
RHEL å’Œ CentOS é»˜è®¤å¯ç”¨äº† SELinux
```python
# å®‰è£… openstack-selinux è½¯ä»¶åŒ…ä»¥ä¾¿è‡ªåŠ¨ç®¡ç† OpenStack æœåŠ¡çš„å®‰å…¨ç­–ç•¥
    yum -y install openstack-selinux
```
### SQLæ•°æ®åº“å®‰è£…ï¼ˆåœ¨æ§åˆ¶èŠ‚ç‚¹æ“ä½œï¼‰


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-sql-database.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-sql-database.html</a>
å®‰è£…mariadbè½¯ä»¶åŒ…ï¼š
```python
[root@controller ~]# yum -y install mariadb mariadb-server python2-PyMySQL
```
åˆ›å»ºé…ç½®æ–‡ä»¶
```python
cat > /etc/my.cnf.d/openstack.cnf <<-'EOF'
[mysqld]
bind-address = 10.0.0.11
default-storage-engine = innodb
innodb_file_per_table
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8
EOF
```
å¯åŠ¨mariadb
```python
systemctl enable mariadb.service
systemctl start mariadb.service
```
æ‰§è¡Œmariadbå®‰å…¨åˆå§‹åŒ–
ä¸ºäº†ä¿è¯æ•°æ®åº“æœåŠ¡çš„å®‰å…¨æ€§ï¼Œè¿è¡Œ``mysql_secure_installation``è„šæœ¬ã€‚ç‰¹åˆ«éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸ºæ•°æ®åº“çš„rootç”¨æˆ·è®¾ç½®ä¸€ä¸ªé€‚å½“çš„å¯†ç ã€‚
```python
[root@controller ~]# mysql_secure_installation
Â·Â·Â·
Enter current password for root (enter for none): 
OK, successfully used password, moving on...
Set root password? [Y/n] n
 ... skipping.
Remove anonymous users? [Y/n] Y
 ... Success!
Disallow root login remotely? [Y/n] Y
 ... Success!
Remove test database and access to it? [Y/n] Y
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!
Reload privilege tables now? [Y/n] Y
 ... Success!

Thanks for using MariaDB!&nbsp;
```
### NoSQL æ•°æ®åº“


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-nosql-database.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-nosql-database.html</a>
Telemetry æœåŠ¡ä½¿ç”¨ NoSQL æ•°æ®åº“æ¥å­˜å‚¨ä¿¡æ¯ï¼Œå…¸å‹åœ°ï¼Œè¿™ä¸ªæ•°æ®åº“è¿è¡Œåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šã€‚
å‘å¯¼ä¸­ä½¿ç”¨MongoDBã€‚
åœ¨ceilometerä¸­è®¡è´¹ä½¿ç”¨ã€‚ç”±äºæœ¬æ¬¡æ­å»ºçš„ä¸ºç§æœ‰äº‘å¹³å°ï¼Œç§æœ‰äº‘ä¸éœ€è¦è®¡è´¹æœåŠ¡ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œå®‰è£…äº†ã€‚
### æ¶ˆæ¯é˜Ÿåˆ—éƒ¨ç½²


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-messaging.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-messaging.html</a>
å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶
```python
[root@controller ~]# yum -y install rabbitmq-server
```
å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å¹¶å°†å…¶é…ç½®ä¸ºéšç³»ç»Ÿå¯åŠ¨ï¼š
```python
systemctl enable rabbitmq-server.service
systemctl start rabbitmq-server.service
```
æ·»åŠ  openstack ç”¨æˆ·ï¼š
```python
[root@controller ~]# rabbitmqctl add_user openstack RABBIT_PASS
Creating user "openstack" ...
ç”¨åˆé€‚çš„å¯†ç æ›¿æ¢ RABBIT_DBPASSã€‚
```
ç»™``openstack``ç”¨æˆ·é…ç½®å†™å’Œè¯»æƒé™ï¼š
```python
[root@controller ~]# rabbitmqctl set_permissions openstack ".*" ".*" ".*"
Setting permissions for user "openstack" in vhost "/" ...
```
### MemcachedæœåŠ¡éƒ¨ç½²


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-memcached.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-memcached.html</a>
å®‰è£…memcachedè½¯ä»¶åŒ…
```python
[root@controller ~]# yum -y install memcached python-memcached
```
é…ç½®memcachedé…ç½®æ–‡ä»¶
```python
[root@controller ~]# cat  /etc/sysconfig/memcached
PORT="11211"
USER="memcached"
MAXCONN="1024"
CACHESIZE="64"
OPTIONS="-l 10.0.0.11"  <--ä¿®æ”¹ä½ç½®ï¼Œé…ç½®ä¸ºmemcachedä¸»æœºåœ°å€æˆ–ç½‘æ®µä¿¡æ¯
```
å¯åŠ¨MemcachedæœåŠ¡ï¼Œå¹¶ä¸”é…ç½®å®ƒéšæœºå¯åŠ¨ã€‚
```python
systemctl enable memcached.service
systemctl start memcached.service
```
### éªŒè¯ä»¥ä¸Šéƒ¨ç½²çš„æœåŠ¡æ˜¯å¦æ­£å¸¸


æŸ¥çœ‹ç«¯å£ä¿¡æ¯
```python
[root@controller ~]# netstat -lntup
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:25672           0.0.0.0:*               LISTEN      17164/beam          
tcp        0      0 10.0.0.11:3306          0.0.0.0:*               LISTEN      16985/mysqld        
tcp        0      0 10.0.0.11:11211         0.0.0.0:*               LISTEN      17962/memcached     
tcp        0      0 0.0.0.0:4369            0.0.0.0:*               LISTEN      1/systemd           
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1402/sshd           
tcp6       0      0 :::5672                 :::*                    LISTEN      17164/beam          
tcp6       0      0 :::22                   :::*                    LISTEN      1402/sshd           
udp        0      0 0.0.0.0:123             0.0.0.0:*                           1681/chronyd        
udp        0      0 127.0.0.1:323           0.0.0.0:*                           1681/chronyd        
udp        0      0 10.0.0.11:11211         0.0.0.0:*                           17962/memcached     
udp6       0      0 ::1:323                 :::*                                1681/chronyd    
```
ç«¯å£ä¿¡æ¯è¯´æ˜
<blockquote>
chronydæœåŠ¡&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 123ï¼ˆæä¾›ç»™å…¶ä»–æœºå™¨ï¼‰ã€323ï¼ˆä¸ä¸Šæ¸¸åŒæ­¥ç«¯å£ï¼‰
Mariadb æ•°æ®åº“&nbsp; &nbsp; &nbsp; &nbsp; 3306æ•°æ®æ¥å£
rabbitmq&nbsp; æ¶ˆæ¯é˜Ÿåˆ—&nbsp; &nbsp; 4369ã€25672ï¼ˆé«˜å¯ç”¨æ¶æ„ä½¿ç”¨ï¼‰ã€5672ï¼ˆç¨‹åºå†™ç«¯å£ï¼‰
memcached tokenä¿å­˜&nbsp; 11211
</blockquote>
ã€€ã€€è‡³æ­¤OpenStack åŸºç¡€é…ç½®å®Œæˆã€‚
## Keystoneè®¤è¯æœåŠ¡é…ç½®


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-install.html</a>
è®¤è¯ç®¡ç†ï¼šæˆæƒç®¡ç†å’ŒæœåŠ¡ç›®å½•æœåŠ¡ç®¡ç†æä¾›å•ç‚¹æ•´åˆã€‚
ç›®å½•æœåŠ¡ï¼šç›¸å½“äºå‘¼å«ä¸­å¿ƒï¼ˆå‰å°ï¼‰
&nbsp;&nbsp; åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šå®‰è£…å’Œé…ç½®OpenStackèº«ä»½è®¤è¯æœåŠ¡ï¼Œä»£ç åç§°keystoneã€‚å‡ºç°æ€§èƒ½åŸå› ï¼Œè¿™ä¸ªé…ç½®éƒ¨ç½²Fernetä»¤ç‰Œå’ŒApache HTTPæœåŠ¡å¤„ç†è¯·æ±‚ã€‚
### åˆ›å»ºæ•°æ®åº“


ç”¨æ•°æ®åº“è¿æ¥å®¢æˆ·ç«¯ä»¥ root ç”¨æˆ·è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼š
```python
[root@controller ~]# mysql -u root -p
```
åˆ›å»º keystone æ•°æ®åº“ï¼š
```python
MariaDB [(none)]> CREATE DATABASE keystone;
```
å¯¹``keystone``æ•°æ®åº“æˆäºˆæ°å½“çš„æƒé™ï¼š
```python
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';
```
æ·»åŠ å®Œæˆåé€€å‡ºæ•°æ®åº“å®¢æˆ·ç«¯ã€‚
```python
MariaDB [(none)]> exit
```
### å®‰è£…keystone


```python
yum -y install openstack-keystone httpd mod_wsgi
```
å®‰è£…çš„è½¯ä»¶åŒ…ä¸º keystoneæœåŠ¡åŒ…ï¼ŒhttpæœåŠ¡ï¼Œç”¨äºè¿æ¥pythonç¨‹åºä¸webæœåŠ¡çš„ä¸­é—´ä»¶
&nbsp;&nbsp; å¦‚ä½•ç†è§£ CGI, WSGIï¼Ÿ <a href="https://www.zhihu.com/question/19998865">https://www.zhihu.com/question/19998865</a>
### ä¿®æ”¹é…ç½®æ–‡ä»¶


å¤‡ä»½é…ç½®æ–‡ä»¶
```python
[root@controller ~]# cp /etc/keystone/keystone.conf{,.bak}
```
ç²¾ç®€åŒ–é…ç½®æ–‡ä»¶
```python
[root@controller ~]# egrep -v '^#|^$' /etc/keystone/keystone.conf.bak  >/etc/keystone/keystone.conf
```
æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶
åœ¨``[DEFAULT]``éƒ¨åˆ†ï¼Œå®šä¹‰åˆå§‹ç®¡ç†ä»¤ç‰Œçš„å€¼
```python
[DEFAULT]
admin_token = ADMIN_TOKEN
```
åœ¨ [database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®&nbsp;
```python
[database]
connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone
```
åœ¨``[token]``éƒ¨åˆ†ï¼Œé…ç½®Fernet UUIDä»¤ç‰Œçš„æä¾›è€…
```python
[token]
provider = fernet&nbsp;å…³äºä»¤ç‰Œç±»å‹çš„è¯´æ˜ï¼š<a href="https://www.abcdocker.com/abcdocker/1797">https://www.abcdocker.com/abcdocker/1797</a>
```
**ã€è‡ªåŠ¨åŒ–ã€‘****è‡ªåŠ¨åŒ–é…ç½®-****é…ç½®æ–‡ä»¶**ï¼ˆæœ¬æ–‡å¤§é‡ä½¿ç”¨ï¼‰
å®‰è£…è‡ªåŠ¨é…ç½®è½¯ä»¶openstack-utils
```python
yum install openstack-utils.noarch -y
[root@controller ~]# rpm -ql openstack-utils
/usr/bin/openstack-config
```
è‡ªåŠ¨åŒ–é…ç½®å‘½ä»¤
```python
cp /etc/keystone/keystone.conf{,.bak}
grep '^[a-Z\[]' /etc/keystone/keystone.conf.bak > /etc/keystone/keystone.conf
openstack-config --set /etc/keystone/keystone.conf DEFAULT admin_token  ADMIN_TOKEN
openstack-config --set /etc/keystone/keystone.conf database connection  mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone
openstack-config --set /etc/keystone/keystone.conf token provider  fernet
```
### åˆå§‹åŒ–èº«ä»½è®¤è¯æœåŠ¡çš„æ•°æ®åº“(åŒæ­¥æ•°æ®åº“)


```python
[root@controller ~]# su -s /bin/sh -c "keystone-manage db_sync" keystone
```
éªŒè¯æ•°æ®åº“æ˜¯å¦åŒæ­¥æˆåŠŸ
```python
[root@controller ~]# mysql keystone -e 'show tables'
```
### åˆå§‹åŒ–Fernet keys


```python
[root@controller ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
```
å‘½ä»¤æ‰§è¡Œåä¼šåœ¨/etc/keystone/ç›®å½•ä¸‹ç”Ÿæˆfernet-keys&nbsp; æ–‡ä»¶ï¼š
```python
[root@controller ~]# ls /etc/keystone/
default_catalog.templates  keystone.conf.bak   policy.json
fernet-keys                keystone-paste.ini  sso_callback_template.html
keystone.conf              logging.conf
```
### é…ç½® Apache HTTP æœåŠ¡å™¨


ç¼–è¾‘``/etc/httpd/conf/httpd.conf`` æ–‡ä»¶ï¼Œé…ç½®``ServerName``ã€‚
```python
echo 'ServerName controller' >>/etc/httpd/conf/httpd.conf
```
åˆ›å»ºé…ç½®æ–‡ä»¶ /etc/httpd/conf.d/wsgi-keystone.conf
&nbsp;&nbsp; æ³¨ï¼škeystoneæœåŠ¡è¾ƒä¸ºç‰¹æ®Šï¼Œå…¶ä»–çš„æœåŠ¡å¯è‡ªè¡Œåˆ›å»ºé…ç½®æ–‡ä»¶ã€‚
```python
[root@controller ~]# cat /etc/httpd/conf.d/wsgi-keystone.conf
Listen 5000
Listen 35357

<VirtualHost *:5000>
    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
    WSGIProcessGroup keystone-public
    WSGIScriptAlias / /usr/bin/keystone-wsgi-public
    WSGIApplicationGroup %{GLOBAL}
    WSGIPassAuthorization On
    ErrorLogFormat "%{cu}t %M"
    ErrorLog /var/log/httpd/keystone-error.log
    CustomLog /var/log/httpd/keystone-access.log combined

    <Directory /usr/bin>
        Require all granted
    </Directory>
</VirtualHost>

<VirtualHost *:35357>
    WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
    WSGIProcessGroup keystone-admin
    WSGIScriptAlias / /usr/bin/keystone-wsgi-admin
    WSGIApplicationGroup %{GLOBAL}
    WSGIPassAuthorization On
    ErrorLogFormat "%{cu}t %M"
    ErrorLog /var/log/httpd/keystone-error.log
    CustomLog /var/log/httpd/keystone-access.log combined

    <Directory /usr/bin>
        Require all granted
    </Directory>
</VirtualHost>
```
### å¯åŠ¨ Apache HTTP æœåŠ¡å¹¶é…ç½®å…¶éšç³»ç»Ÿå¯åŠ¨


```python
systemctl enable httpd.service
systemctl start httpd.service&nbsp;
```
### åˆ›å»ºæœåŠ¡å®ä½“å’ŒAPIç«¯ç‚¹


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-services.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-services.html</a>
a.é…ç½®ç¯å¢ƒå˜é‡
é…ç½®è®¤è¯ä»¤ç‰Œ
```python
export OS_TOKEN=ADMIN_TOKEN
```
é…ç½®ç«¯ç‚¹URL
```python
export OS_URL=http://controller:35357/v3
```
é…ç½®è®¤è¯ API ç‰ˆæœ¬
```python
export OS_IDENTITY_API_VERSION=3
```
æŸ¥çœ‹ç¯å¢ƒå˜é‡
```python
[root@controller ~]# env |grep OS
```
å‘½ä»¤é›†ï¼š
```python
export OS_TOKEN=ADMIN_TOKEN
export OS_URL=http://controller:35357/v3
export OS_IDENTITY_API_VERSION=3
env |grep OS
```
b.åˆ›å»ºæœåŠ¡å®ä½“å’ŒAPIç«¯ç‚¹
åˆ›å»ºå‘½ä»¤
```python
openstack service create --name keystone --description "OpenStack Identity" identity
```
æ‰§è¡Œè¿‡ç¨‹
```python
[root@controller ~]#  openstack service create \
>   --name keystone --description "OpenStack Identity" identity
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Identity               |
| enabled     | True                             |
| id          | f08ec36b2b7340d6976fcb2bbd24e83b |
| name        | keystone                         |
| type        | identity                         |
+-------------+----------------------------------+
```
c.åˆ›å»ºè®¤è¯æœåŠ¡çš„ API ç«¯ç‚¹
&nbsp;&nbsp; å‘½ä»¤é›†
```python
openstack endpoint create --region RegionOne identity public http://controller:5000/v3
openstack endpoint create --region RegionOne identity internal http://controller:5000/v3
openstack endpoint create --region RegionOne identity admin http://controller:35357/v3
```
æ‰§è¡Œè¿‡ç¨‹
```python
[root@controller ~]# openstack endpoint create --region RegionOne \
>   identity public http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | e27dd713753f47b8a1062ac50ca33845 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f08ec36b2b7340d6976fcb2bbd24e83b |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+

[root@controller ~]# openstack endpoint create --region RegionOne \
>   identity internal http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 71b7435fa2df4c58bb6ca5cc38a434a7 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f08ec36b2b7340d6976fcb2bbd24e83b |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+

[root@controller ~]# openstack endpoint create --region RegionOne \
>   identity admin http://controller:35357/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | cf58eee084c04777a520d487adc1a88f |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f08ec36b2b7340d6976fcb2bbd24e83b |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:35357/v3       |
+--------------+----------------------------------+
```
### åˆ›å»ºåŸŸã€é¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²


å®˜æ–¹æ–‡æ¡£<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-users.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-users.html</a>
a.åˆ›å»ºåŸŸ``default``
```python
openstack domain create --description "Default Domain" default
```
b.åœ¨ä½ çš„ç¯å¢ƒä¸­ï¼Œä¸ºè¿›è¡Œç®¡ç†æ“ä½œï¼Œåˆ›å»ºç®¡ç†çš„é¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²
åˆ›å»º admin é¡¹ç›®
```python
openstack project create --domain default --description "Admin Project" admin
```
åˆ›å»º admin ç”¨æˆ·
```python
openstack user create --domain default --password-prompt admin
```
åˆ›å»º admin è§’è‰²
```python
openstack role create admin
```
æ·»åŠ ``admin`` è§’è‰²åˆ° admin é¡¹ç›®å’Œç”¨æˆ·ä¸Š
```python
openstack role add --project admin --user admin admin
```
å‘½ä»¤é›†ï¼š
```python
openstack domain create --description "Default Domain" default
openstack project create --domain default --description "Admin Project" admin
openstack user create --domain default --password ADMIN_PASS admin
openstack role create admin
openstack role add --project admin --user admin admin
```
c.åˆ›å»ºserversé¡¹ç›®
```python
[root@controller ~]#  openstack project create --domain default --description "Service Project" service
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Service Project                  |
| domain_id   | df6407ae93bb407d876f2ee4787ede79 |
| enabled     | True                             |
| id          | cd2107aa3a8f4066a871ca029641cfd7 |
| is_domain   | False                            |
| name        | service                          |
| parent_id   | df6407ae93bb407d876f2ee4787ede79 |
+-------------+----------------------------------+
```
éªŒè¯ä¹‹å‰çš„æ‰€æœ‰æ“ä½œ
å‘½ä»¤é›†ï¼š
```python
openstack service list 
openstack endpoint list | grep keystone |wc -l 
openstack domain list 
openstack project list 
openstack user list 
openstack role list 
```
&nbsp;&nbsp; æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
```python
[root@controller ~]# openstack service list 
+----------------------------------+----------+----------+
| ID                               | Name     | Type     |
+----------------------------------+----------+----------+
| f08ec36b2b7340d6976fcb2bbd24e83b | keystone | identity |
+----------------------------------+----------+----------+
```
&nbsp;&nbsp; æŸ¥çœ‹å½“å‰çš„åŸŸ
```python
[root@controller ~]# openstack domain list 
+----------------------------------+---------+---------+----------------+
| ID                               | Name    | Enabled | Description    |
+----------------------------------+---------+---------+----------------+
| df6407ae93bb407d876f2ee4787ede79 | default | True    | Default Domain |
+----------------------------------+---------+---------+----------------+
```
&nbsp;&nbsp; æŸ¥çœ‹é›†åˆ
```python
[root@controller ~]# openstack project list 
+----------------------------------+---------+
| ID                               | Name    |
+----------------------------------+---------+
| cd2107aa3a8f4066a871ca029641cfd7 | service |
| d0dfbdbc115b4a728c24d28bc1ce1e62 | admin   |
+----------------------------------+---------+
```
&nbsp;&nbsp; æŸ¥çœ‹å½“å‰çš„ç”¨æˆ·åˆ—è¡¨
```python
[root@controller ~]# openstack user list 
+----------------------------------+-------+
| ID                               | Name  |
+----------------------------------+-------+
| d8f4a1d74f52482d8ebe2184692d2c1c | admin |
+----------------------------------+-------+
```
&nbsp;&nbsp; æŸ¥çœ‹å½“å‰çš„è§’è‰²
```python
[root@controller ~]# openstack role list 
+----------------------------------+-------+
| ID                               | Name  |
+----------------------------------+-------+
| 4de514c418ee480d898773e4f543b79d | admin |
+----------------------------------+-------+
```
å…³äºåŸŸã€é¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²çš„è¯´æ˜ï¼š
<table style="width: 100%; border-collapse: collapse; border-style: none" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 16.22%; border-top: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" width="16%">
**ç±»å‹**
</td>
<td style="width: 83.78%; border-top: 1pt solid rgba(155, 187, 89, 1); border-right: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" width="83%">
**è¯´æ˜**
</td>
</tr>
<tr>
<td style="width: 16.22%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="16%">
**Domain**
</td>
<td style="width: 83.78%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="83%">
è¡¨ç¤º project å’Œ user çš„é›†åˆï¼Œåœ¨å…¬æœ‰äº‘æˆ–è€…ç§æœ‰äº‘ä¸­å¸¸å¸¸è¡¨ç¤ºä¸€ä¸ªå®¢æˆ·
</td>
</tr>
<tr>
<td style="width: 16.22%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="16%">
**Group**
</td>
<td style="width: 83.78%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="83%">
ä¸€ä¸ªdomain ä¸­çš„éƒ¨åˆ†ç”¨æˆ·çš„é›†åˆ
</td>
</tr>
<tr>
<td style="width: 16.22%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="16%">
**Project**
</td>
<td style="width: 83.78%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="83%">
é¡¹ç›®ã€ITåŸºç¡€è®¾æ–½èµ„æºçš„é›†åˆï¼Œæ¯”å¦‚è™šæœºï¼Œå·ï¼Œé•œåƒç­‰
</td>
</tr>
<tr>
<td style="width: 16.22%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" width="16%">
**Role**
</td>
<td style="width: 83.78%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" width="83%">
æˆæƒï¼Œè§’è‰²ï¼Œè¡¨ç¤ºä¸€ä¸ª user å¯¹ä¸€ä¸ª project resource çš„æƒé™
</td>
</tr>
<tr>
<td style="width: 16.22%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="16%">
**Token**
</td>
<td style="width: 83.78%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" width="83%">
ä¸€ä¸ª user å¯¹äºæŸä¸ªç›®æ ‡ï¼ˆproject æˆ–è€… domainï¼‰çš„ä¸€ä¸ªæœ‰é™æ—¶é—´æ®µå†…çš„èº«ä»½ä»¤ç‰Œ
</td>
</tr>
</tbody>
</table>
### åˆ›å»º OpenStack å®¢æˆ·ç«¯ç¯å¢ƒè„šæœ¬


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-openrc.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/keystone-openrc.html</a>
ç¼–è¾‘æ–‡ä»¶ admin-openrc å¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹
```python
[root@controller ~]# vi admin-openrc
export OS_PROJECT_DOMAIN_NAME=default
export OS_USER_DOMAIN_NAME=default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=ADMIN_PASS
export OS_AUTH_URL=http://controller:35357/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
```
&nbsp;&nbsp; ã€é‡è¦ã€‘åŠ¡å¿…ä½¿ç”¨ç¯å¢ƒå˜é‡è„šæœ¬
ä½¿ç”¨è„šæœ¬åˆ›å»ºç¯å¢ƒå˜é‡
```python
[root@controller ~]# source admin-openrc 
[root@controller ~]# env|grep OS
HOSTNAME=controller
OS_USER_DOMAIN_NAME=default
OS_IMAGE_API_VERSION=2
OS_PROJECT_NAME=admin
OS_IDENTITY_API_VERSION=3
OS_PASSWORD=ADMIN_PASS
OS_AUTH_URL=http://controller:35357/v3
OS_USERNAME=admin
OS_PROJECT_DOMAIN_NAME=default
```
## é•œåƒæœåŠ¡glanceéƒ¨ç½²


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html</a>
### åˆ›åº“æˆæƒ


å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance-install.html</a>
```python
# ç™»é™†mysqlæ•°æ®åº“
[root@controller ~]# mysql
```
åˆ›å»º glance æ•°æ®åº“ï¼š
```python
CREATE DATABASE glance;
```
å¯¹``glance``æ•°æ®åº“æˆäºˆæ°å½“çš„æƒé™ï¼š
```python
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'GLANCE_DBPASS';
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'GLANCE_DBPASS';
```
### åˆ›å»ºglanceç”¨æˆ·å’Œæˆæƒ


[**é‡è¦**]åŠ è½½ç¯å¢ƒå˜é‡
æ³¨ï¼šæ¯æ¬¡ä½¿ç”¨openstackç®¡ç†å‘½ä»¤æ—¶éƒ½ä¾èµ–ä¸ç¯å¢ƒå˜é‡
```python
[root@controller ~]# . admin-openrc
```
åˆ›å»º glance ç”¨æˆ·
```python
openstack user create --domain default --password GLANCE_PASS glance
```
æ·»åŠ  admin è§’è‰²åˆ° glance ç”¨æˆ·å’Œ service é¡¹ç›®ä¸Š
```python
openstack role add --project service --user glance admin
```
### åˆ›å»ºé•œåƒæœåŠ¡çš„ API ç«¯ç‚¹ï¼Œå¹¶æ³¨å†Œ


åˆ›å»º``glance``æœåŠ¡å®ä½“
```python
openstack service create --name glance --description "OpenStack Image" image
```
&nbsp;&nbsp; æ‰§è¡Œè¿‡ç¨‹
```python
[root@controller ~]# openstack service create --name glance --description "OpenStack Image" image
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Image                  |
| enabled     | True                             |
| id          | 30357ca18e5046b98dbc0dd4f1e7d69c |
| name        | glance                           |
| type        | image                            |
+-------------+----------------------------------+
```
åˆ›å»ºé•œåƒæœåŠ¡çš„ API ç«¯ç‚¹
å‘½ä»¤é›†
```python
openstack endpoint create --region RegionOne image public http://controller:9292
openstack endpoint create --region RegionOne image internal http://controller:9292
openstack endpoint create --region RegionOne image admin http://controller:9292
```
æ‰§è¡Œè¿‡ç¨‹&nbsp;
```python
[root@controller ~]# openstack endpoint create --region RegionOne image public http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 671486d2528448e9a4067ab04a15e015 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 30357ca18e5046b98dbc0dd4f1e7d69c |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+
[root@controller ~]# openstack endpoint create --region RegionOne image internal http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 8ff6131b7e1b4234bb4f34daecbbd615 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 30357ca18e5046b98dbc0dd4f1e7d69c |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+
[root@controller ~]# openstack endpoint create --region RegionOne image admin http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 4a1b3341a0604dbfb710eaa63aab626a |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 30357ca18e5046b98dbc0dd4f1e7d69c |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+
```
### å®‰è£…glanceè½¯ä»¶åŒ…


```python
yum install openstack-glance -y
```
æœåŠ¡è¯´æ˜ï¼š
<blockquote>
glance-api&nbsp;è´Ÿè´£é•œåƒçš„ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥çœ‹ã€åˆ é™¤
glance-registry&nbsp;ä¿®æ”¹é•œåƒçš„æºæ•°æ®ï¼šé•œåƒæ‰€éœ€çš„é…ç½®
</blockquote>
### ä¿®æ”¹glanceç›¸å…³é…ç½®æ–‡ä»¶


<blockquote>
/etc/glance/glance-api.conf&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;#&nbsp;æ¥æ”¶é•œåƒAPIçš„è°ƒç”¨ï¼Œè¯¸å¦‚é•œåƒå‘ç°ã€æ¢å¤ã€å­˜å‚¨ã€‚
/etc/glance/glance-registry.conf #å­˜å‚¨ã€å¤„ç†å’Œæ¢å¤é•œåƒçš„å…ƒæ•°æ®ï¼Œå…ƒæ•°æ®åŒ…æ‹¬é¡¹è¯¸å¦‚å¤§å°å’Œç±»å‹ã€‚
</blockquote>
1ã€ç¼–è¾‘æ–‡ä»¶ /etc/glance/glance-registry.conf
[database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®
```python
    [database]
    ...
    connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
```
[keystone_authtoken] å’Œ [paste_deploy] éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = glance
    password = GLANCE_PASS

    [paste_deploy]
    ...
    flavor = keystone
```
[glance_store] éƒ¨åˆ†ï¼Œé…ç½®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å’Œé•œåƒæ–‡ä»¶ä½ç½®
```python
    [glance_store]
    ...
    stores = file,http
    default_store = file
    filesystem_store_datadir = /var/lib/glance/images/
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
cp /etc/glance/glance-api.conf{,.bak}
grep '^[a-Z\[]' /etc/glance/glance-api.conf.bak >/etc/glance/glance-api.conf
openstack-config --set /etc/glance/glance-api.conf  database  connection  mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
openstack-config --set /etc/glance/glance-api.conf  glance_store stores  file,http
openstack-config --set /etc/glance/glance-api.conf  glance_store default_store  file
openstack-config --set /etc/glance/glance-api.conf  glance_store filesystem_store_datadir  /var/lib/glance/images/
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken project_name  service
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken username  glance
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken password  GLANCE_PASS
openstack-config --set /etc/glance/glance-api.conf  paste_deploy flavor  keystone
```
2ã€ç¼–è¾‘æ–‡ä»¶ ``/etc/glance/glance-registry.conf``
[database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®
```python
    [database]
    ...
    connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
```
[keystone_authtoken] å’Œ [paste_deploy] éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = glance
    password = GLANCE_PASS
 
    [paste_deploy]
    ...
    flavor = keystone
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
cp /etc/glance/glance-registry.conf{,.bak}
grep '^[a-Z\[]' /etc/glance/glance-registry.conf.bak > /etc/glance/glance-registry.conf
openstack-config --set /etc/glance/glance-registry.conf  database  connection  mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken project_name  service
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken username  glance
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken password  GLANCE_PASS
openstack-config --set /etc/glance/glance-registry.conf  paste_deploy flavor  keystone
```
### åŒæ­¥æ•°æ®åº“


```python
[root@controller ~]#  su -s /bin/sh -c "glance-manage db_sync" glance
```
æ³¨ï¼šå¿½ç•¥è¾“å‡ºä¸­ä»»ä½•ä¸æ¨èä½¿ç”¨çš„ä¿¡æ¯ã€‚
æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åŒæ­¥æˆåŠŸ
```python
[root@controller ~]# mysql glance -e "show tables" |wc -l 
21
```
### å¯åŠ¨glanceæœåŠ¡


å¯åŠ¨é•œåƒæœåŠ¡ã€é…ç½®ä»–ä»¬éšæœºå¯åŠ¨
```python
systemctl enable openstack-glance-api.service openstack-glance-registry.service
systemctl start  openstack-glance-api.service openstack-glance-registry.service
```
### éªŒè¯glanceæœåŠ¡æ“ä½œ


a.è®¾ç½®ç¯å¢ƒå˜é‡
```python
. admin-openrc
```
b.ä¸‹è½½æºé•œåƒ&nbsp; &nbsp;
```python
wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img
```
c.ä½¿ç”¨ QCOW2 ç£ç›˜æ ¼å¼ï¼Œ bare å®¹å™¨æ ¼å¼ä¸Šä¼ é•œåƒåˆ°é•œåƒæœåŠ¡å¹¶è®¾ç½®å…¬å…±å¯è§ï¼Œè¿™æ ·æ‰€æœ‰çš„é¡¹ç›®éƒ½å¯ä»¥è®¿é—®å®ƒ
```python
openstack image create "cirros" --file cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --public
```
æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹
```python
[root@controller ~]# openstack image create "cirros" --file cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --public
+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                     |
| container_format | bare                                                 |
| created_at       | 2018-01-23T10:20:19Z                                 |
| disk_format      | qcow2                                                |
| file             | /v2/images/9d92c601-0824-493a-bc6e-cecb10e9a4c6/file |
| id               | 9d92c601-0824-493a-bc6e-cecb10e9a4c6                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | cirros                                               |
| owner            | d0dfbdbc115b4a728c24d28bc1ce1e62                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 13287936                                             |
| status           | active                                               |
| tags             |                                                      |
| updated_at       | 2018-01-23T10:20:20Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+
```
æŸ¥çœ‹é•œåƒåˆ—è¡¨
```python
[root@controller ~]# openstack image list 
+--------------------------------------+--------+--------+
| ID                                   | Name   | Status |
+--------------------------------------+--------+--------+
| 9d92c601-0824-493a-bc6e-cecb10e9a4c6 | cirros | active |
+--------------------------------------+--------+--------+
```
é•œåƒä½ç½®ï¼Œé•œåƒä¸Šä¼ åä»¥idå‘½åã€‚
```python
[root@controller ~]# ll -h  /var/lib/glance/images/ 
total 13M
-rw-r----- 1 glance glance 13M Jan 23 18:20 9d92c601-0824-493a-bc6e-cecb10e9a4c6
```
è‡³æ­¤glanceæœåŠ¡é…ç½®å®Œæˆ
## è®¡ç®—æœåŠ¡(nova)éƒ¨ç½²


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova.html</a>
### åœ¨æ§åˆ¶èŠ‚ç‚¹å®‰è£…å¹¶é…ç½®


å‚è€ƒæ–‡çŒ®ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova-controller-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova-controller-install.html</a>
1ï¼‰åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ›åº“ï¼Œæˆæƒ
æ•°æ®åº“è¿æ¥å®¢æˆ·ç«¯ä»¥ root ç”¨æˆ·è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨
```python
mysql -u root -p
```
åˆ›å»º nova_api å’Œ nova æ•°æ®åº“ï¼š&nbsp;&nbsp;
```python
CREATE DATABASE nova_api;
CREATE DATABASE nova;
```
å¯¹æ•°æ®åº“è¿›è¡Œæ­£ç¡®çš„æˆæƒ&nbsp;&nbsp;
```python
GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
```
2ï¼‰åœ¨keystoneä¸­åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ
åŠ è½½ç¯å¢ƒå˜é‡
```python
[root@controller ~]#  . admin-openrc
```
åˆ›å»ºç”¨æˆ·
```python
openstack user create --domain default --password NOVA_PASS nova
```
å…³è”è§’è‰²
```python
openstack role add --project service --user nova admin
```
3ï¼‰åœ¨keystoneä¸­åˆ›å»ºæœåŠ¡å®ä½“ï¼Œå’Œæ³¨å†ŒAPIæ¥å£
åˆ›å»ºæœåŠ¡å®ä½“
```python
openstack service create --name nova --description "OpenStack Compute" compute
```
æ³¨å†ŒAPIæ¥å£
```python
openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1/%\(tenant_id\)s
openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1/%\(tenant_id\)s
openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1/%\(tenant_id\)s
```
4ï¼‰å®‰è£…è½¯ä»¶åŒ…
```python
yum -y install openstack-nova-api openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler   
```
è½¯ä»¶åŒ…è¯´æ˜
<blockquote>
nova-api&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;æä¾›apiæ¥å£
nova-scheduler&nbsp; #&nbsp;è°ƒåº¦
nova-conductor&nbsp; #&nbsp;æ›¿ä»£è®¡ç®—èŠ‚ç‚¹è¿›å…¥æ•°æ®åº“æ“ä½œ
nova-consoleauth&nbsp;&nbsp; #&nbsp;æä¾›webç•Œé¢ç‰ˆçš„vncç®¡ç†
nova-novncproxy&nbsp; #&nbsp;æä¾›webç•Œé¢ç‰ˆçš„vncç®¡ç†
nova-compute&nbsp;&nbsp; #&nbsp;è°ƒåº¦libvirtdè¿›è¡Œè™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†
</blockquote>
5ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘``/etc/nova/nova.conf``æ–‡ä»¶å¹¶å®Œæˆä¸‹é¢çš„æ“ä½œ:
åœ¨``[DEFAULT]``éƒ¨åˆ†ï¼Œåªå¯ç”¨è®¡ç®—å’Œå…ƒæ•°æ®APIï¼š
```python
    [DEFAULT]
    ...
    enabled_apis = osapi_compute,metadata
```
åœ¨``[api_database]``å’Œ``[database]``éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“çš„è¿æ¥ï¼š
```python
    [api_database]
    ...
    connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api

    [database]
    ...
    connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[oslo_messaging_rabbit]â€éƒ¨åˆ†ï¼Œé…ç½® â€œRabbitMQâ€ æ¶ˆæ¯é˜Ÿåˆ—è®¿é—®
```python
    [DEFAULT]
    ...
    rpc_backend = rabbit

    [oslo_messaging_rabbit]
    ...
    rabbit_host = controller
    rabbit_userid = openstack
    rabbit_password = RABBIT_PASS
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
    [DEFAULT]
    ...
    auth_strategy = keystone

    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = nova
    password = NOVA_PASS
```
åœ¨ [DEFAULT]éƒ¨åˆ†ï¼Œé…ç½®``my_ip`` æ¥ä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹çš„ç®¡ç†æ¥å£çš„IP åœ°å€ã€‚
```python
    [DEFAULT]
    ...
    my_ip = 10.0.0.11
```
åœ¨ [DEFAULT] éƒ¨åˆ†ï¼Œä½¿èƒ½ Networking æœåŠ¡ï¼š
```python
    [DEFAULT]
    ...
    use_neutron = True
    firewall_driver = nova.virt.firewall.NoopFirewallDriver
```
åœ¨``[vnc]``éƒ¨åˆ†ï¼Œé…ç½®VNCä»£ç†ä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹çš„ç®¡ç†æ¥å£IPåœ°å€ ï¼š
```python
    [vnc]
    ...
    vncserver_listen = $my_ip
    vncserver_proxyclient_address = $my_ip
```
åœ¨ [glance] åŒºåŸŸï¼Œé…ç½®é•œåƒæœåŠ¡ API çš„ä½ç½®ï¼š
```python
    [glance]
    ...
    api_servers = http://controller:9292
```
åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„ï¼š
```python
    [oslo_concurrency]
    ...
    lock_path = /var/lib/nova/tmp
```
å‘½ä»¤é›†
```python
cp /etc/nova/nova.conf{,.bak}
grep '^[a-Z\[]' /etc/nova/nova.conf.bak >/etc/nova/nova.conf
openstack-config --set /etc/nova/nova.conf  DEFAULT enabled_apis  osapi_compute,metadata
openstack-config --set /etc/nova/nova.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/nova/nova.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/nova/nova.conf  DEFAULT my_ip  10.0.0.11
openstack-config --set /etc/nova/nova.conf  DEFAULT use_neutron  True
openstack-config --set /etc/nova/nova.conf  DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver
openstack-config --set /etc/nova/nova.conf  api_database connection  mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api
openstack-config --set /etc/nova/nova.conf  database  connection  mysql+pymysql://nova:NOVA_DBPASS@controller/nova
openstack-config --set /etc/nova/nova.conf  glance api_servers  http://controller:9292
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_uri  http://controller:5000
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  memcached_servers  controller:11211
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_type  password
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  user_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_name  service
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  username  nova
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  password  NOVA_PASS
openstack-config --set /etc/nova/nova.conf  oslo_concurrency lock_path  /var/lib/nova/tmp
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_host  controller
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_userid  openstack
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_password  RABBIT_PASS
openstack-config --set /etc/nova/nova.conf  vnc vncserver_listen  '$my_ip'
openstack-config --set /etc/nova/nova.conf  vnc vncserver_proxyclient_address  '$my_ip'
```
6ï¼‰åŒæ­¥æ•°æ®åº“
```python
su -s /bin/sh -c "nova-manage api_db sync" nova
su -s /bin/sh -c "nova-manage db sync" nova
```
æ³¨æ„ï¼šå¿½ç•¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¾“å‡ºä¸­ä»»ä½•ä¸æ¨èä½¿ç”¨çš„ä¿¡æ¯&nbsp;
```python
[root@controller ~]# mysql nova_api -e 'show tables' |wc -l 
10
[root@controller ~]# mysql nova -e 'show tables' |wc -l 
110
```
7ï¼‰å¯åŠ¨æœåŠ¡
è®¾ç½®å¼€å¯è‡ªå¯åŠ¨
```python
systemctl enable openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service
```
å¯åŠ¨æœåŠ¡
```python
systemctl start openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service
```
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```python
[root@controller ~]# systemctl status openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service |grep 'active (running)' |wc -l

5
```
### åœ¨è®¡ç®—èŠ‚ç‚¹å®‰è£…å’Œé…ç½®


æŸ¥è€ƒæ–‡çŒ®ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova-compute-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/nova-compute-install.html</a>
1ï¼‰å®‰è£…è½¯ä»¶åŒ…
```python
yum -y install openstack-nova-compute
```
2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘``/etc/nova/nova.conf``æ–‡ä»¶å¹¶å®Œæˆä¸‹é¢çš„æ“ä½œ
åœ¨``[DEFAULT]`` å’Œ [oslo_messaging_rabbit]éƒ¨åˆ†ï¼Œé…ç½®``RabbitMQ``æ¶ˆæ¯é˜Ÿåˆ—çš„è¿æ¥ï¼š
```python
    [DEFAULT]
    ...
    rpc_backend = rabbit

    [oslo_messaging_rabbit]
    ...
    rabbit_host = controller
    rabbit_userid = openstack
    rabbit_password = RABBIT_PASS
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®ï¼š
```python
    [DEFAULT]
    ...
    auth_strategy = keystone

    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = nova
    password = NOVA_PASS
```
åœ¨ [DEFAULT] éƒ¨åˆ†ï¼Œé…ç½® my_ip é€‰é¡¹ï¼š
```python
    [DEFAULT]
    ...
    my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS
```
&nbsp;&nbsp; æ³¨æ„ï¼š å°†å…¶ä¸­çš„ MANAGEMENT_INTERFACE_IP_ADDRESS æ›¿æ¢ä¸ºè®¡ç®—èŠ‚ç‚¹ä¸Šçš„ç®¡ç†ç½‘ç»œæ¥å£çš„IP åœ°å€ï¼Œä¾‹å¦‚ :ref:`example architecture <overview-example-architectures>`ä¸­æ‰€ç¤ºçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ 10.0.0.31 
åœ¨ [DEFAULT] éƒ¨åˆ†ï¼Œä½¿èƒ½ Networking æœåŠ¡ï¼š
```python
    [DEFAULT]
    ...
    use_neutron = True
    firewall_driver = nova.virt.firewall.NoopFirewallDriver
```
&nbsp;åœ¨``[vnc]``éƒ¨åˆ†ï¼Œå¯ç”¨å¹¶é…ç½®è¿œç¨‹æ§åˆ¶å°è®¿é—®
```python
    [vnc]
    ...
    enabled = True
    vncserver_listen = 0.0.0.0
    vncserver_proxyclient_address = $my_ip
    novncproxy_base_url = http://controller:6080/vnc_auto.html
```
åœ¨ [glance] åŒºåŸŸï¼Œé…ç½®é•œåƒæœåŠ¡ API çš„ä½ç½®ï¼š
```python
    [glance]
    ...
    api_servers = http://controller:9292
```
åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„ï¼š
```python
    [oslo_concurrency]
    ...
    lock_path = /var/lib/nova/tmp
```
å‘½ä»¤é›†&nbsp;
```python
cp /etc/nova/nova.conf{,.bak}
grep '^[a-Z\[]' /etc/nova/nova.conf.bak >/etc/nova/nova.conf
openstack-config --set /etc/nova/nova.conf  DEFAULT enabled_apis  osapi_compute,metadata
openstack-config --set /etc/nova/nova.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/nova/nova.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/nova/nova.conf  DEFAULT my_ip  10.0.0.31
openstack-config --set /etc/nova/nova.conf  DEFAULT use_neutron  True
openstack-config --set /etc/nova/nova.conf  DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver
openstack-config --set /etc/nova/nova.conf  glance api_servers  http://controller:9292
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_uri  http://controller:5000
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  memcached_servers  controller:11211
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_type  password
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  user_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_name  service
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  username  nova
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  password  NOVA_PASS
openstack-config --set /etc/nova/nova.conf  oslo_concurrency lock_path  /var/lib/nova/tmp
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_host  controller
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_userid  openstack
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_password  RABBIT_PASS
openstack-config --set /etc/nova/nova.conf  vnc enabled  True
openstack-config --set /etc/nova/nova.conf  vnc vncserver_listen  0.0.0.0
openstack-config --set /etc/nova/nova.conf  vnc vncserver_proxyclient_address  '$my_ip'
openstack-config --set /etc/nova/nova.conf  vnc novncproxy_base_url  http://controller:6080/vnc_auto.html
```
3ï¼‰å¯åŠ¨æœåŠ¡
ç¡®å®šæ‚¨çš„è®¡ç®—èŠ‚ç‚¹æ˜¯å¦æ”¯æŒè™šæ‹Ÿæœºçš„ç¡¬ä»¶åŠ é€Ÿ
```python
[root@compute1 ~]#  egrep -c '(vmx|svm)' /proc/cpuinfo
1
```
è¯´æ˜ï¼šå¦‚æœè¿™ä¸ªå‘½ä»¤è¿”å›äº† 1 æˆ–æ›´å¤§çš„å€¼ï¼Œé‚£ä¹ˆä½ çš„è®¡ç®—èŠ‚ç‚¹æ”¯æŒç¡¬ä»¶åŠ é€Ÿä¸”ä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚
å¯åŠ¨ï¼Œå¼€æœºè‡ªå¯åŠ¨
```python
systemctl enable libvirtd.service openstack-nova-compute.service
systemctl start libvirtd.service openstack-nova-compute.service
# æŸ¥çœ‹çŠ¶æ€
systemctl status libvirtd.service openstack-nova-compute.service
```
åœ¨æ§åˆ¶èŠ‚ç‚¹æŸ¥çœ‹è®¡ç®—èŠ‚ç‚¹çŠ¶æ€
```python
[root@controller ~]# source admin-openrc 
[root@controller ~]# openstack compute service list 
+----+------------------+------------+----------+---------+-------+----------------------------+
| Id | Binary           | Host       | Zone     | Status  | State | Updated At                 |
+----+------------------+------------+----------+---------+-------+----------------------------+
|  1 | nova-scheduler   | controller | internal | enabled | up    | 2018-01-23T12:02:04.000000 |
|  2 | nova-conductor   | controller | internal | enabled | up    | 2018-01-23T12:02:03.000000 |
|  3 | nova-consoleauth | controller | internal | enabled | up    | 2018-01-23T12:02:05.000000 |
|  6 | nova-compute     | compute1   | nova     | enabled | up    | 2018-01-23T12:02:05.000000 |
+----+------------------+------------+----------+---------+-------+----------------------------+
```
### éªŒè¯æœåŠ¡


åœ¨è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œä¹‹å‰ï¼Œå…ˆéªŒè¯ä¹‹å‰éƒ¨ç½²çš„æœåŠ¡æ˜¯å¦æ­£å¸¸ã€‚
æ³¨æ„ï¼š æ‰§è¡Œå‘½ä»¤å‰éœ€å…ˆåŠ è½½ç¯å¢ƒå˜é‡è„šæœ¬
```python
# æ£€æŸ¥è®¤è¯æœåŠ¡
openstack user list 
# æ£€æŸ¥é•œåƒæœåŠ¡
openstack image list 
# æ£€æŸ¥è®¡ç®—æœåŠ¡
openstack compute service list
```
## Networking(neutron)æœåŠ¡


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron.html</a>
### å®‰è£…å¹¶é…ç½®æ§åˆ¶èŠ‚ç‚¹


ä»¥ä¸‹å…¨å‘½ä»¤å…¨åœ¨ controller ä¸»æœºä¸­æ‰§è¡Œ
&nbsp;&nbsp; å‚è€ƒæ–‡çŒ®ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install.html</a>
1ï¼‰åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ›åº“ï¼Œæˆæƒ
è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨
```python
mysql
```
åˆ›å»º``neutron`` æ•°æ®åº“
```python
CREATE DATABASE neutron;
```
å¯¹``neutron`` æ•°æ®åº“æˆäºˆåˆé€‚çš„è®¿é—®æƒé™
```python
GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'NEUTRON_DBPASS';
GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' IDENTIFIED BY 'NEUTRON_DBPASS';
```
2ï¼‰åœ¨keystoneä¸­åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ
åˆ›å»º``neutron``ç”¨æˆ·
```python
openstack user create --domain default --password NEUTRON_PASS neutron
```
æ·»åŠ ``admin`` è§’è‰²åˆ°``neutron`` ç”¨æˆ·
```python
openstack role add --project service --user neutron admin
```
3ï¼‰åœ¨keystoneä¸­åˆ›å»ºæœåŠ¡å®ä½“ï¼Œå’Œæ³¨å†ŒAPIæ¥å£
åˆ›å»º``neutron``æœåŠ¡å®ä½“
```python
openstack service create --name neutron --description "OpenStack Networking" network
```
åˆ›å»ºç½‘ç»œæœåŠ¡APIç«¯ç‚¹
```python
openstack endpoint create --region RegionOne network public http://controller:9696
openstack endpoint create --region RegionOne network internal http://controller:9696
openstack endpoint create --region RegionOne network admin http://controller:9696    
```
4ï¼‰å®‰è£…è½¯ä»¶åŒ…
&nbsp;&nbsp; è¿™è¿™é‡Œæˆ‘é€‰ç”¨çš„æ—¶ â€™ç½‘ç»œé€‰é¡¹  1  ï¼šå…¬å…±ç½‘ç»œâ€˜  è¯¥ç½‘ç»œæ¨¡å¼è¾ƒä¸ºç®€å•ã€‚
&nbsp;&nbsp; å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option1.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option1.html</a>
å®‰è£…è½¯ä»¶åŒ…
```python
yum -y install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables
```
5ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
â‘  ç¼–è¾‘``/etc/neutron/neutron.conf`` æ–‡ä»¶å¹¶å®Œæˆå¦‚ä¸‹æ“ä½œ
åœ¨ [database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®
```python
    [database]
    ...
    connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron
```
åœ¨``[DEFAULT]``éƒ¨åˆ†ï¼Œå¯ç”¨ML2æ’ä»¶å¹¶ç¦ç”¨å…¶ä»–æ’ä»¶
```python
    [DEFAULT]
    ...
    core_plugin = ml2
    service_plugins =
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[oslo_messaging_rabbit]â€éƒ¨åˆ†ï¼Œé…ç½® â€œRabbitMQâ€ æ¶ˆæ¯é˜Ÿåˆ—çš„è¿æ¥
```python
    [DEFAULT]
    ...
    rpc_backend = rabbit

    [oslo_messaging_rabbit]
    ...
    rabbit_host = controller
    rabbit_userid = openstack
    rabbit_password = RABBIT_PASS
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
    [DEFAULT]
    ...
    auth_strategy = keystone

    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = neutron
    password = NEUTRON_PASS
```
åœ¨``[DEFAULT]``å’Œ``[nova]``éƒ¨åˆ†ï¼Œé…ç½®ç½‘ç»œæœåŠ¡æ¥é€šçŸ¥è®¡ç®—èŠ‚ç‚¹çš„ç½‘ç»œæ‹“æ‰‘å˜åŒ–
```python
    [DEFAULT]
    ...
    notify_nova_on_port_status_changes = True
    notify_nova_on_port_data_changes = True

    [nova]
    ...
    auth_url = http://controller:35357
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    region_name = RegionOne
    project_name = service
    username = nova
    password = NOVA_PASS
```
åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„
```python
    [oslo_concurrency]
    ...
    lock_path = /var/lib/neutron/tmp
```
å‘½ä»¤é›†
```python
cp /etc/neutron/neutron.conf{,.bak}
grep '^[a-Z\[]' /etc/neutron/neutron.conf.bak >/etc/neutron/neutron.conf
openstack-config --set /etc/neutron/neutron.conf  DEFAULT core_plugin  ml2
openstack-config --set /etc/neutron/neutron.conf  DEFAULT service_plugins
openstack-config --set /etc/neutron/neutron.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/neutron/neutron.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/neutron/neutron.conf  DEFAULT notify_nova_on_port_status_changes  True
openstack-config --set /etc/neutron/neutron.conf  DEFAULT notify_nova_on_port_data_changes  True
openstack-config --set /etc/neutron/neutron.conf  database connection  mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_name  service
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken username  neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken password  NEUTRON_PASS
openstack-config --set /etc/neutron/neutron.conf  nova auth_url  http://controller:35357
openstack-config --set /etc/neutron/neutron.conf  nova auth_type  password 
openstack-config --set /etc/neutron/neutron.conf  nova project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  nova user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  nova region_name  RegionOne
openstack-config --set /etc/neutron/neutron.conf  nova project_name  service
openstack-config --set /etc/neutron/neutron.conf  nova username  nova
openstack-config --set /etc/neutron/neutron.conf  nova password  NOVA_PASS
openstack-config --set /etc/neutron/neutron.conf  oslo_concurrency lock_path  /var/lib/neutron/tmp
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_host  controller
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_userid  openstack
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_password  RABBIT_PASS
```
&nbsp;&nbsp; â‘¡ é…ç½® Modular Layer 2 (ML2) æ’ä»¶
ç¼–è¾‘``/etc/neutron/plugins/ml2/ml2_conf.ini``æ–‡ä»¶å¹¶å®Œæˆä»¥ä¸‹æ“ä½œ
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œå¯ç”¨flatå’ŒVLANç½‘ç»œ
```python
    [ml2]
    ...
    type_drivers = flat,vlan
```
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œç¦ç”¨ç§æœ‰ç½‘ç»œ
```python
    [ml2]
    ...
    tenant_network_types =
```
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œå¯ç”¨Linuxbridgeæœºåˆ¶
```python
    [ml2]
    ...
    mechanism_drivers = linuxbridge
```
åœ¨``[ml2]`` éƒ¨åˆ†ï¼Œå¯ç”¨ç«¯å£å®‰å…¨æ‰©å±•é©±åŠ¨
```python
    [ml2]
    ...
    extension_drivers = port_security    
```
åœ¨``[ml2_type_flat]``éƒ¨åˆ†ï¼Œé…ç½®å…¬å…±è™šæ‹Ÿç½‘ç»œä¸ºflatç½‘ç»œ
```python
    [ml2_type_flat]
    ...
    flat_networks = provider
```
åœ¨ ``[securitygroup]``éƒ¨åˆ†ï¼Œå¯ç”¨ ipset å¢åŠ å®‰å…¨ç»„è§„åˆ™çš„é«˜æ•ˆæ€§
```python
    [securitygroup]
    ...
    enable_ipset = True
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
cp /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/ml2_conf.ini.bak >/etc/neutron/plugins/ml2/ml2_conf.ini
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 type_drivers  flat,vlan
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 tenant_network_types 
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 mechanism_drivers  linuxbridge
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 extension_drivers  port_security
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2_type_flat flat_networks  provider
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  securitygroup enable_ipset  True
```
&nbsp;&nbsp; â‘¢ é…ç½®Linuxbridgeä»£ç†
ç¼–è¾‘``/etc/neutron/plugins/ml2/linuxbridge_agent.ini``æ–‡ä»¶å¹¶ä¸”å®Œæˆä»¥ä¸‹æ“ä½œ
åœ¨``[linux_bridge]``éƒ¨åˆ†ï¼Œå°†å…¬å…±è™šæ‹Ÿç½‘ç»œå’Œå…¬å…±ç‰©ç†ç½‘ç»œæ¥å£å¯¹åº”èµ·æ¥
```python
    [linux_bridge]
    physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME
```
&nbsp;&nbsp; æ³¨æ„ï¼šå°†``PUBLIC_INTERFACE_NAME`` æ›¿æ¢ä¸ºåº•å±‚çš„ç‰©ç†å…¬å…±ç½‘ç»œæ¥å£ï¼Œä¾‹å¦‚eth0ã€‚
åœ¨``[vxlan]``éƒ¨åˆ†ï¼Œç¦æ­¢VXLANè¦†ç›–ç½‘ç»œ&nbsp;
```python
    [vxlan]
    enable_vxlan = False
```
åœ¨ ``[securitygroup]``éƒ¨åˆ†ï¼Œå¯ç”¨å®‰å…¨ç»„å¹¶é…ç½®
```python
    [securitygroup]
    ...
    enable_security_group = True
    firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak >/etc/neutron/plugins/ml2/linuxbridge_agent.ini
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  linux_bridge physical_interface_mappings  provider:eth0
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup enable_security_group  True
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan enable_vxlan  False
```
&nbsp;&nbsp; â‘£ é…ç½®DHCPä»£ç†
ç¼–è¾‘``/etc/neutron/dhcp_agent.ini``æ–‡ä»¶å¹¶å®Œæˆä¸‹é¢çš„æ“ä½œ
åœ¨``[DEFAULT]``éƒ¨åˆ†ï¼Œé…ç½®Linuxbridgeé©±åŠ¨æ¥å£ï¼ŒDHCPé©±åŠ¨å¹¶å¯ç”¨éš”ç¦»å…ƒæ•°æ®ï¼Œè¿™æ ·åœ¨å…¬å…±ç½‘ç»œä¸Šçš„å®ä¾‹å°±å¯ä»¥é€šè¿‡ç½‘ç»œæ¥è®¿é—®å…ƒæ•°æ®
```python
    [DEFAULT]
    ...
    interface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver
    dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
    enable_isolated_metadata = True
```
å‘½ä»¤é›†
```python
neutron.agent.linux.interface.BridgeInterfaceDriver
openstack-config --set /etc/neutron/dhcp_agent.ini  DEFAULT dhcp_driver neutron.agent.linux.dhcp.Dnsmasq
openstack-config --set /etc/neutron/dhcp_agent.ini  DEFAULT enable_isolated_metadata true
```
â‘¤ é…ç½®å…ƒæ•°æ®ä»£ç†
ç¼–è¾‘``/etc/neutron/metadata_agent.ini``æ–‡ä»¶å¹¶å®Œæˆä»¥ä¸‹æ“ä½œ
åœ¨``[DEFAULT]`` éƒ¨åˆ†ï¼Œé…ç½®å…ƒæ•°æ®ä¸»æœºä»¥åŠå…±äº«å¯†ç 
```python
    [DEFAULT]
    ...
    nova_metadata_ip = controller
    metadata_proxy_shared_secret = METADATA_SECRET
```
å‘½ä»¤é›†
```python
openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_ip  controller
openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret  METADATA_SECRET
```
&nbsp;&nbsp; â‘¥ ä¸ºnoveé…ç½®ç½‘ç»œæœåŠ¡
å†æ¬¡ç¼–è¾‘``/etc/nova/nova.conf``æ–‡ä»¶å¹¶å®Œæˆä»¥ä¸‹æ“ä½œ
åœ¨``[neutron]``éƒ¨åˆ†ï¼Œé…ç½®è®¿é—®å‚æ•°ï¼Œå¯ç”¨å…ƒæ•°æ®ä»£ç†å¹¶è®¾ç½®å¯†ç 
```python
    [neutron]
    ...
    url = http://controller:9696
    auth_url = http://controller:35357
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    region_name = RegionOne
    project_name = service
    username = neutron
    password = NEUTRON_PASS

    service_metadata_proxy = True
    metadata_proxy_shared_secret = METADATA_SECRET
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
openstack-config --set /etc/nova/nova.conf  neutron url  http://controller:9696
openstack-config --set /etc/nova/nova.conf  neutron auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  neutron auth_type  password
openstack-config --set /etc/nova/nova.conf  neutron project_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron user_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron region_name  RegionOne
openstack-config --set /etc/nova/nova.conf  neutron project_name  service
openstack-config --set /etc/nova/nova.conf  neutron username  neutron
openstack-config --set /etc/nova/nova.conf  neutron password  NEUTRON_PASS
openstack-config --set /etc/nova/nova.conf  neutron service_metadata_proxy  True
openstack-config --set /etc/nova/nova.conf  neutron metadata_proxy_shared_secret  METADATA_SECRET
```
6ï¼‰åŒæ­¥æ•°æ®åº“
ç½‘ç»œæœåŠ¡åˆå§‹åŒ–è„šæœ¬éœ€è¦ä¸€ä¸ªè¶…é“¾æ¥ /etc/neutron/plugin.ini``æŒ‡å‘ML2æ’ä»¶é…ç½®æ–‡ä»¶/etc/neutron/plugins/ml2/ml2_conf.ini``ã€‚
å¦‚æœè¶…é“¾æ¥ä¸å­˜åœ¨ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºå®ƒ
```python
ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
```
åŒæ­¥æ•°æ®åº“
```python
su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron
```
7ï¼‰å¯åŠ¨æœåŠ¡
é‡å¯è®¡ç®—API æœåŠ¡
```python
systemctl restart openstack-nova-api.service
```
å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå¯åŠ¨ Networking æœåŠ¡å¹¶é…ç½®å®ƒå¯åŠ¨ã€‚
```python
systemctl enable neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service
systemctl start neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service
systemctl status neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service
```
### å®‰è£…å’Œé…ç½®è®¡ç®—èŠ‚ç‚¹


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-compute-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-compute-install.html</a>
1ï¼‰å®‰è£…ç»„ä»¶
```python
yum -y install openstack-neutron-linuxbridge ebtables ipset
```
2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
åœ¨è®¡ç®—èŠ‚ç‚¹é…ç½®é€‰æ‹© ç½‘ç»œé€‰é¡¹1ï¼šå…¬å…±ç½‘ç»œï¼Œä¸æ§åˆ¶èŠ‚ç‚¹ç›¸åŒ
â‘  ç¼–è¾‘``/etc/neutron/neutron.conf`` æ–‡ä»¶å¹¶å®Œæˆå¦‚ä¸‹æ“ä½œ
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[oslo_messaging_rabbit]â€éƒ¨åˆ†ï¼Œé…ç½® â€œRabbitMQâ€ æ¶ˆæ¯é˜Ÿåˆ—çš„è¿æ¥&nbsp;
```python
    [DEFAULT]
    ...
    rpc_backend = rabbit

    [oslo_messaging_rabbit]
    ...
    rabbit_host = controller
    rabbit_userid = openstack
    rabbit_password = RABBIT_PASS    
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
    [DEFAULT]
    ...
    auth_strategy = keystone

    [keystone_authtoken]
    ...
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = neutron
    password = NEUTRON_PASS    
```
&nbsp;&nbsp; åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„
```python
    [oslo_concurrency]
    ...
    lock_path = /var/lib/neutron/tmp
```
&nbsp;&nbsp; å‘½ä»¤é›†
```python
cp /etc/neutron/neutron.conf{,.bak}
grep -Ev '^$|#' /etc/neutron/neutron.conf.bak >/etc/neutron/neutron.conf
openstack-config --set /etc/neutron/neutron.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/neutron/neutron.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_name  service
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken username  neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken password  NEUTRON_PASS
openstack-config --set /etc/neutron/neutron.conf  oslo_concurrency lock_path  /var/lib/neutron/tmp
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_host  controller
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_userid  openstack
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_password  RABBIT_PASS
```
â‘¡ é…ç½®Linuxbridgeä»£ç†
ç¼–è¾‘``/etc/neutron/plugins/ml2/linuxbridge_agent.ini``æ–‡ä»¶å¹¶ä¸”å®Œæˆä»¥ä¸‹æ“ä½œ
åœ¨``[linux_bridge]``éƒ¨åˆ†ï¼Œå°†å…¬å…±è™šæ‹Ÿç½‘ç»œå’Œå…¬å…±ç‰©ç†ç½‘ç»œæ¥å£å¯¹åº”èµ·æ¥
```python
    [linux_bridge]
    physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME        
```
&nbsp;&nbsp; æ³¨æ„ï¼šå°†``PUBLIC_INTERFACE_NAME`` æ›¿æ¢ä¸ºåº•å±‚çš„ç‰©ç†å…¬å…±ç½‘ç»œæ¥å£ï¼Œä¾‹å¦‚eth0ã€‚&nbsp;&nbsp;&nbsp;&nbsp; åœ¨``[vxlan]``éƒ¨åˆ†ï¼Œç¦æ­¢VXLANè¦†ç›–ç½‘ç»œ&nbsp; &nbsp; &nbsp;&nbsp;
```python
    [vxlan]        
    enable_vxlan = False    
```
&nbsp;&nbsp; åœ¨ ``[securitygroup]``éƒ¨åˆ†ï¼Œå¯ç”¨å®‰å…¨ç»„å¹¶é…ç½®&nbsp; &nbsp;
```python
    [securitygroup]        
    ...        
    enable_security_group = True        
    firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
```
å‘½ä»¤é›†
```python
cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak >/etc/neutron/plugins/ml2/linuxbridge_agent.ini
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  linux_bridge physical_interface_mappings  provider:eth0
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup enable_security_group  True
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan enable_vxlan  False
```
&nbsp;&nbsp; â‘¢ ä¸ºè®¡ç®—èŠ‚ç‚¹é…ç½®ç½‘ç»œæœåŠ¡
ç¼–è¾‘``/etc/nova/nova.conf``æ–‡ä»¶å¹¶å®Œæˆä¸‹é¢çš„æ“ä½œ
åœ¨``[neutron]`` éƒ¨åˆ†ï¼Œé…ç½®è®¿é—®å‚æ•°
```python
    [neutron]
    ...
    url = http://controller:9696
    auth_url = http://controller:35357
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    region_name = RegionOne
    project_name = service
    username = neutron
    password = NEUTRON_PASS
```
å‘½ä»¤é›†
```python
openstack-config --set /etc/nova/nova.conf  neutron url  http://controller:9696
openstack-config --set /etc/nova/nova.conf  neutron auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  neutron auth_type  password
openstack-config --set /etc/nova/nova.conf  neutron project_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron user_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron region_name  RegionOne
openstack-config --set /etc/nova/nova.conf  neutron project_name  service
openstack-config --set /etc/nova/nova.conf  neutron username  neutron
openstack-config --set /etc/nova/nova.conf  neutron password  NEUTRON_PASS
```
3ï¼‰å¯åŠ¨æœåŠ¡
é‡å¯è®¡ç®—æœåŠ¡
```python
systemctl restart openstack-nova-compute.service
```
å¯åŠ¨Linuxbridgeä»£ç†å¹¶é…ç½®å®ƒå¼€æœºè‡ªå¯åŠ¨
```python
systemctl enable neutron-linuxbridge-agent.service
systemctl start neutron-linuxbridge-agent.service
```
### éªŒè¯æ“ä½œ


å®˜æ–¹éªŒè¯æ–¹æ³•
<blockquote>
&nbsp;https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-verify.html
&nbsp;https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-verify-option1.html
&nbsp;#&nbsp;åœ¨è¿™é‡Œï¼Œæˆ‘åªè¿›è¡ŒéªŒè¯ç½‘ç»œï¼Œç½‘ç»œæ­£å¸¸è¯´æ˜æœåŠ¡æ­£å¸¸
</blockquote>
```python
[root@controller ~]# neutron agent-list 
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| 3ab2f17f-737e-4c3f-86f0-2289c56a541b | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |
| 4f64caf6-a9b0-4742-b0d1-0d961063200a | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-agent |
| 630540de-d0a0-473b-96b5-757afc1057de | Linux bridge agent | compute1   |                   | :-)   | True           | neutron-linuxbridge-agent |
| 9989ddcb-6aba-4b7f-9bd7-7d61f774f2bb | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
```
## Dashboardï¼ˆhorizon-webç•Œé¢ï¼‰å®‰è£…


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon.html</a>
### å®‰å…¨å¹¶é…ç½®ç»„ä»¶ï¼ˆå•ç‹¬ä¸»æœºå®‰è£…ï¼‰


æŸ¥è€ƒæ–‡çŒ®ï¼šhttps://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon-install.html#install-and-configure-components
å®‰è£…è½¯ä»¶åŒ…
```python
[root@compute1 ~]# yum -y install openstack-dashboard
```
&nbsp;&nbsp; ç”±äºDashboardæœåŠ¡éœ€è¦ä½¿ç”¨åˆ°httpdæœåŠ¡ï¼Œå®‰è£…åœ¨æ§åˆ¶èŠ‚ç‚¹ï¼Œå¯èƒ½å›å½±å“åˆ°KeystoneæœåŠ¡çš„æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥é€‰æ‹©å•ç‹¬å®‰è£…ï¼Œä¸å®˜æ–¹æ–‡æ¡£ç•¥æœ‰ä¸åŒã€‚
### ä¿®æ”¹é…ç½®æ–‡ä»¶


ç¼–è¾‘æ–‡ä»¶ /etc/openstack-dashboard/local_settings å¹¶å®Œæˆå¦‚ä¸‹åŠ¨ä½œ
åœ¨ controller èŠ‚ç‚¹ä¸Šé…ç½®ä»ªè¡¨ç›˜ä»¥ä½¿ç”¨ OpenStack æœåŠ¡
```python
    OPENSTACK_HOST = "controller"
    # æŒ‡å‘è®¤è¯æœåŠ¡çš„åœ°å€=keystone
```
å…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®ä»ªè¡¨æ¿
```python
ALLOWED_HOSTS = ['*', ]
```
é…ç½® memcached ä¼šè¯å­˜å‚¨æœåŠ¡
```python
    SESSION_ENGINE = 'django.contrib.sessions.backends.cache'

    CACHES = {
        'default': {
             'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',
             'LOCATION': 'controller:11211',
        }
    }
```
å¯ç”¨ç¬¬3ç‰ˆè®¤è¯API:
```python
OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST
```
å¯ç”¨å¯¹åŸŸçš„æ”¯æŒ
```python
OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
```
é…ç½®APIç‰ˆæœ¬
```python
    OPENSTACK_API_VERSIONS = {
        "identity": 3,
        "image": 2,
        "volume": 2,
    }
```
é€šè¿‡ä»ªè¡¨ç›˜åˆ›å»ºç”¨æˆ·æ—¶çš„é»˜è®¤åŸŸé…ç½®ä¸º default :
```python
OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = "default"
```
é€šè¿‡ä»ªè¡¨ç›˜åˆ›å»ºçš„ç”¨æˆ·é»˜è®¤è§’è‰²é…ç½®ä¸º user
```python
OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"
```
å¦‚æœæ‚¨é€‰æ‹©ç½‘ç»œé€‰é¡¹1ï¼Œéœ€è¦ç¦ç”¨æ”¯æŒ3å±‚ç½‘ç»œæœåŠ¡
```python
    OPENSTACK_NEUTRON_NETWORK = {
        ...
        'enable_router': False,
        'enable_quotas': False,
        'enable_distributed_router': False,
        'enable_ha_router': False,
        'enable_lb': False,
        'enable_firewall': False,
        'enable_vpn': False,
        'enable_fip_topology_check': False,
    }
```
å¯ä»¥é€‰æ‹©æ€§åœ°é…ç½®æ—¶åŒº
```python
TIME_ZONE = "Asia/Shanghai"
```
&nbsp;&nbsp; æœ€ç»ˆé…ç½®æ–‡ä»¶
```python
wget https://files.cnblogs.com/files/clsn/local_settings.zip
```
ã€€ã€€æ–‡ä»¶è¯¦æƒ…ï¼š
```python<img id="code_img_closed_5f4a0c8d-9018-44f3-8d12-a671a525b950" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_5f4a0c8d-9018-44f3-8d12-a671a525b950" class="code_img_opened" style="display: none" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="">

  1 # -*- coding: utf-8 -*-
  2 
  3 import os
  4 
  5 from django.utils.translation import ugettext_lazy as _
  6 
  7 
  8 from openstack_dashboard import exceptions
  9 from openstack_dashboard.settings import HORIZON_CONFIG
 10 
 11 DEBUG = False
 12 TEMPLATE_DEBUG = DEBUG
 13 
 14 
 15 # WEBROOT is the location relative to Webserver root
 16 # should end with a slash.
 17 WEBROOT = '/dashboard/'
 18 #LOGIN_URL = WEBROOT + 'auth/login/'
 19 #LOGOUT_URL = WEBROOT + 'auth/logout/'
 20 #
 21 # LOGIN_REDIRECT_URL can be used as an alternative for
 22 # HORIZON_CONFIG.user_home, if user_home is not set.
 23 # Do not set it to '/home/', as this will cause circular redirect loop
 24 #LOGIN_REDIRECT_URL = WEBROOT
 25 
 26 # If horizon is running in production (DEBUG is False), set this
 27 # with the list of host/domain names that the application can serve.
 28 # For more information see:
 29 # https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts
 30 ALLOWED_HOSTS = ['*', ]
 31 
 32 # Set SSL proxy settings:
 33 # Pass this header from the proxy after terminating the SSL,
 34 # and don't forget to strip it from the client's request.
 35 # For more information see:
 36 # https://docs.djangoproject.com/en/1.8/ref/settings/#secure-proxy-ssl-header
 37 #SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
 38 
 39 # If Horizon is being served through SSL, then uncomment the following two
 40 # settings to better secure the cookies from security exploits
 41 #CSRF_COOKIE_SECURE = True
 42 #SESSION_COOKIE_SECURE = True
 43 
 44 # The absolute path to the directory where message files are collected.
 45 # The message file must have a .json file extension. When the user logins to
 46 # horizon, the message files collected are processed and displayed to the user.
 47 #MESSAGES_PATH=None
 48 
 49 # Overrides for OpenStack API versions. Use this setting to force the
 50 # OpenStack dashboard to use a specific API version for a given service API.
 51 # Versions specified here should be integers or floats, not strings.
 52 # NOTE: The version should be formatted as it appears in the URL for the
 53 # service API. For example, The identity service APIs have inconsistent
 54 # use of the decimal point, so valid options would be 2.0 or 3.
 55 OPENSTACK_API_VERSIONS = {
 56 #    "data-processing": 1.1,
 57     "identity": 3,
 58     "image": 2,
 59     "volume": 2,
 60     "compute": 2,
 61 }
 62 
 63 # Set this to True if running on multi-domain model. When this is enabled, it
 64 # will require user to enter the Domain name in addition to username for login.
 65 OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
 66 
 67 # Overrides the default domain used when running on single-domain model
 68 # with Keystone V3. All entities will be created in the default domain.
 69 # NOTE: This value must be the ID of the default domain, NOT the name.
 70 # Also, you will most likely have a value in the keystone policy file like this
 71 #    "cloud_admin": "rule:admin_required and domain_id:<your domain id>"
 72 # This value must match the domain id specified there.
 73 OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = 'default'
 74 
 75 # Set this to True to enable panels that provide the ability for users to
 76 # manage Identity Providers (IdPs) and establish a set of rules to map
 77 # federation protocol attributes to Identity API attributes.
 78 # This extension requires v3.0+ of the Identity API.
 79 #OPENSTACK_KEYSTONE_FEDERATION_MANAGEMENT = False
 80 
 81 # Set Console type:
 82 # valid options are "AUTO"(default), "VNC", "SPICE", "RDP", "SERIAL" or None
 83 # Set to None explicitly if you want to deactivate the console.
 84 #CONSOLE_TYPE = "AUTO"
 85 
 86 # If provided, a "Report Bug" link will be displayed in the site header
 87 # which links to the value of this setting (ideally a URL containing
 88 # information on how to report issues).
 89 #HORIZON_CONFIG["bug_url"] = "http://bug-report.example.com"
 90 
 91 # Show backdrop element outside the modal, do not close the modal
 92 # after clicking on backdrop.
 93 #HORIZON_CONFIG["modal_backdrop"] = "static"
 94 
 95 # Specify a regular expression to validate user passwords.
 96 #HORIZON_CONFIG["password_validator"] = {
 97 #    "regex": '.*',
 98 #    "help_text": _("Your password does not meet the requirements."),
 99 #}
100 
101 # Disable simplified floating IP address management for deployments with
102 # multiple floating IP pools or complex network requirements.
103 #HORIZON_CONFIG["simple_ip_management"] = False
104 
105 # Turn off browser autocompletion for forms including the login form and
106 # the database creation workflow if so desired.
107 #HORIZON_CONFIG["password_autocomplete"] = "off"
108 
109 # Setting this to True will disable the reveal button for password fields,
110 # including on the login form.
111 #HORIZON_CONFIG["disable_password_reveal"] = False
112 
113 LOCAL_PATH = '/tmp'
114 
115 # Set custom secret key:
116 # You can either set it to a specific value or you can let horizon generate a
117 # default secret key that is unique on this machine, e.i. regardless of the
118 # amount of Python WSGI workers (if used behind Apache+mod_wsgi): However,
119 # there may be situations where you would want to set this explicitly, e.g.
120 # when multiple dashboard instances are distributed on different machines
121 # (usually behind a load-balancer). Either you have to make sure that a session
122 # gets all requests routed to the same dashboard instance or you set the same
123 # SECRET_KEY for all of them.
124 SECRET_KEY='65941f1393ea1c265ad7'
125 
126 # We recommend you use memcached for development; otherwise after every reload
127 # of the django development server, you will have to login again. To use
128 # memcached set CACHES to something like
129 SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
130 CACHES = {
131     'default': {
132         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',
133         'LOCATION': 'controller:11211',
134     },
135 }
136 
137 #CACHES = {
138 #    'default': {
139 #        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
140 #    },
141 #}
142 
143 # Send email to the console by default
144 EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'
145 # Or send them to /dev/null
146 #EMAIL_BACKEND = 'django.core.mail.backends.dummy.EmailBackend'
147 
148 # Configure these for your outgoing email host
149 #EMAIL_HOST = 'smtp.my-company.com'
150 #EMAIL_PORT = 25
151 #EMAIL_HOST_USER = 'djangomail'
152 #EMAIL_HOST_PASSWORD = 'top-secret!'
153 
154 # For multiple regions uncomment this configuration, and add (endpoint, title).
155 #AVAILABLE_REGIONS = [
156 #    ('http://cluster1.example.com:5000/v2.0', 'cluster1'),
157 #    ('http://cluster2.example.com:5000/v2.0', 'cluster2'),
158 #]
159 
160 OPENSTACK_HOST = "controller"
161 OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST
162 OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"
163 
164 # Enables keystone web single-sign-on if set to True.
165 #WEBSSO_ENABLED = False
166 
167 # Determines which authentication choice to show as default.
168 #WEBSSO_INITIAL_CHOICE = "credentials"
169 
170 # The list of authentication mechanisms which include keystone
171 # federation protocols and identity provider/federation protocol
172 # mapping keys (WEBSSO_IDP_MAPPING). Current supported protocol
173 # IDs are 'saml2' and 'oidc'  which represent SAML 2.0, OpenID
174 # Connect respectively.
175 # Do not remove the mandatory credentials mechanism.
176 # Note: The last two tuples are sample mapping keys to a identity provider
177 # and federation protocol combination (WEBSSO_IDP_MAPPING).
178 #WEBSSO_CHOICES = (
179 #    ("credentials", _("Keystone Credentials")),
180 #    ("oidc", _("OpenID Connect")),
181 #    ("saml2", _("Security Assertion Markup Language")),
182 #    ("acme_oidc", "ACME - OpenID Connect"),
183 #    ("acme_saml2", "ACME - SAML2"),
184 #)
185 
186 # A dictionary of specific identity provider and federation protocol
187 # combinations. From the selected authentication mechanism, the value
188 # will be looked up as keys in the dictionary. If a match is found,
189 # it will redirect the user to a identity provider and federation protocol
190 # specific WebSSO endpoint in keystone, otherwise it will use the value
191 # as the protocol_id when redirecting to the WebSSO by protocol endpoint.
192 # NOTE: The value is expected to be a tuple formatted as: (<idp_id>, <protocol_id>).
193 #WEBSSO_IDP_MAPPING = {
194 #    "acme_oidc": ("acme", "oidc"),
195 #    "acme_saml2": ("acme", "saml2"),
196 #}
197 
198 # Disable SSL certificate checks (useful for self-signed certificates):
199 #OPENSTACK_SSL_NO_VERIFY = True
200 
201 # The CA certificate to use to verify SSL connections
202 #OPENSTACK_SSL_CACERT = '/path/to/cacert.pem'
203 
204 # The OPENSTACK_KEYSTONE_BACKEND settings can be used to identify the
205 # capabilities of the auth backend for Keystone.
206 # If Keystone has been configured to use LDAP as the auth backend then set
207 # can_edit_user to False and name to 'ldap'.
208 #
209 # TODO(tres): Remove these once Keystone has an API to identify auth backend.
210 OPENSTACK_KEYSTONE_BACKEND = {
211     'name': 'native',
212     'can_edit_user': True,
213     'can_edit_group': True,
214     'can_edit_project': True,
215     'can_edit_domain': True,
216     'can_edit_role': True,
217 }
218 
219 # Setting this to True, will add a new "Retrieve Password" action on instance,
220 # allowing Admin session password retrieval/decryption.
221 #OPENSTACK_ENABLE_PASSWORD_RETRIEVE = False
222 
223 # The Launch Instance user experience has been significantly enhanced.
224 # You can choose whether to enable the new launch instance experience,
225 # the legacy experience, or both. The legacy experience will be removed
226 # in a future release, but is available as a temporary backup setting to ensure
227 # compatibility with existing deployments. Further development will not be
228 # done on the legacy experience. Please report any problems with the new
229 # experience via the Launchpad tracking system.
230 #
231 # Toggle LAUNCH_INSTANCE_LEGACY_ENABLED and LAUNCH_INSTANCE_NG_ENABLED to
232 # determine the experience to enable.  Set them both to true to enable
233 # both.
234 #LAUNCH_INSTANCE_LEGACY_ENABLED = True
235 #LAUNCH_INSTANCE_NG_ENABLED = False
236 
237 # A dictionary of settings which can be used to provide the default values for
238 # properties found in the Launch Instance modal.
239 #LAUNCH_INSTANCE_DEFAULTS = {
240 #    'config_drive': False,
241 #}
242 
243 # The Xen Hypervisor has the ability to set the mount point for volumes
244 # attached to instances (other Hypervisors currently do not). Setting
245 # can_set_mount_point to True will add the option to set the mount point
246 # from the UI.
247 OPENSTACK_HYPERVISOR_FEATURES = {
248     'can_set_mount_point': False,
249     'can_set_password': False,
250     'requires_keypair': False,
251 }
252 
253 # The OPENSTACK_CINDER_FEATURES settings can be used to enable optional
254 # services provided by cinder that is not exposed by its extension API.
255 OPENSTACK_CINDER_FEATURES = {
256     'enable_backup': False,
257 }
258 
259 # The OPENSTACK_NEUTRON_NETWORK settings can be used to enable optional
260 # services provided by neutron. Options currently available are load
261 # balancer service, security groups, quotas, VPN service.
262 OPENSTACK_NEUTRON_NETWORK = {
263     'enable_router': False,
264     'enable_quotas': False,
265     'enable_ipv6': False,
266     'enable_distributed_router': False,
267     'enable_ha_router': False,
268     'enable_lb': False,
269     'enable_firewall': False,
270     'enable_vpn': False,
271     'enable_fip_topology_check': False,
272 
273     # Neutron can be configured with a default Subnet Pool to be used for IPv4
274     # subnet-allocation. Specify the label you wish to display in the Address
275     # pool selector on the create subnet step if you want to use this feature.
276     'default_ipv4_subnet_pool_label': None,
277 
278     # Neutron can be configured with a default Subnet Pool to be used for IPv6
279     # subnet-allocation. Specify the label you wish to display in the Address
280     # pool selector on the create subnet step if you want to use this feature.
281     # You must set this to enable IPv6 Prefix Delegation in a PD-capable
282     # environment.
283     'default_ipv6_subnet_pool_label': None,
284 
285     # The profile_support option is used to detect if an external router can be
286     # configured via the dashboard. When using specific plugins the
287     # profile_support can be turned on if needed.
288     'profile_support': None,
289     #'profile_support': 'cisco',
290 
291     # Set which provider network types are supported. Only the network types
292     # in this list will be available to choose from when creating a network.
293     # Network types include local, flat, vlan, gre, and vxlan.
294     'supported_provider_types': ['*'],
295 
296     # Set which VNIC types are supported for port binding. Only the VNIC
297     # types in this list will be available to choose from when creating a
298     # port.
299     # VNIC types include 'normal', 'macvtap' and 'direct'.
300     # Set to empty list or None to disable VNIC type selection.
301     'supported_vnic_types': ['*'],
302 }
303 
304 # The OPENSTACK_HEAT_STACK settings can be used to disable password
305 # field required while launching the stack.
306 OPENSTACK_HEAT_STACK = {
307     'enable_user_pass': True,
308 }
309 
310 # The OPENSTACK_IMAGE_BACKEND settings can be used to customize features
311 # in the OpenStack Dashboard related to the Image service, such as the list
312 # of supported image formats.
313 #OPENSTACK_IMAGE_BACKEND = {
314 #    'image_formats': [
315 #        ('', _('Select format')),
316 #        ('aki', _('AKI - Amazon Kernel Image')),
317 #        ('ami', _('AMI - Amazon Machine Image')),
318 #        ('ari', _('ARI - Amazon Ramdisk Image')),
319 #        ('docker', _('Docker')),
320 #        ('iso', _('ISO - Optical Disk Image')),
321 #        ('ova', _('OVA - Open Virtual Appliance')),
322 #        ('qcow2', _('QCOW2 - QEMU Emulator')),
323 #        ('raw', _('Raw')),
324 #        ('vdi', _('VDI - Virtual Disk Image')),
325 #        ('vhd', _('VHD - Virtual Hard Disk')),
326 #        ('vmdk', _('VMDK - Virtual Machine Disk')),
327 #    ],
328 #}
329 
330 # The IMAGE_CUSTOM_PROPERTY_TITLES settings is used to customize the titles for
331 # image custom property attributes that appear on image detail pages.
332 IMAGE_CUSTOM_PROPERTY_TITLES = {
333     "architecture": _("Architecture"),
334     "kernel_id": _("Kernel ID"),
335     "ramdisk_id": _("Ramdisk ID"),
336     "image_state": _("Euca2ools state"),
337     "project_id": _("Project ID"),
338     "image_type": _("Image Type"),
339 }
340 
341 # The IMAGE_RESERVED_CUSTOM_PROPERTIES setting is used to specify which image
342 # custom properties should not be displayed in the Image Custom Properties
343 # table.
344 IMAGE_RESERVED_CUSTOM_PROPERTIES = []
345 
346 # OPENSTACK_ENDPOINT_TYPE specifies the endpoint type to use for the endpoints
347 # in the Keystone service catalog. Use this setting when Horizon is running
348 # external to the OpenStack environment. The default is 'publicURL'.
349 #OPENSTACK_ENDPOINT_TYPE = "publicURL"
350 
351 # SECONDARY_ENDPOINT_TYPE specifies the fallback endpoint type to use in the
352 # case that OPENSTACK_ENDPOINT_TYPE is not present in the endpoints
353 # in the Keystone service catalog. Use this setting when Horizon is running
354 # external to the OpenStack environment. The default is None.  This
355 # value should differ from OPENSTACK_ENDPOINT_TYPE if used.
356 #SECONDARY_ENDPOINT_TYPE = "publicURL"
357 
358 # The number of objects (Swift containers/objects or images) to display
359 # on a single page before providing a paging element (a "more" link)
360 # to paginate results.
361 API_RESULT_LIMIT = 1000
362 API_RESULT_PAGE_SIZE = 20
363 
364 # The size of chunk in bytes for downloading objects from Swift
365 SWIFT_FILE_TRANSFER_CHUNK_SIZE = 512 * 1024
366 
367 # Specify a maximum number of items to display in a dropdown.
368 DROPDOWN_MAX_ITEMS = 30
369 
370 # The timezone of the server. This should correspond with the timezone
371 # of your entire OpenStack installation, and hopefully be in UTC.
372 TIME_ZONE = "Asia/Shanghai"
373 
374 # When launching an instance, the menu of available flavors is
375 # sorted by RAM usage, ascending. If you would like a different sort order,
376 # you can provide another flavor attribute as sorting key. Alternatively, you
377 # can provide a custom callback method to use for sorting. You can also provide
378 # a flag for reverse sort. For more info, see
379 # http://docs.python.org/2/library/functions.html#sorted
380 #CREATE_INSTANCE_FLAVOR_SORT = {
381 #    'key': 'name',
382 #     # or
383 #    'key': my_awesome_callback_method,
384 #    'reverse': False,
385 #}
386 
387 # Set this to True to display an 'Admin Password' field on the Change Password
388 # form to verify that it is indeed the admin logged-in who wants to change
389 # the password.
390 #ENFORCE_PASSWORD_CHECK = False
391 
392 # Modules that provide /auth routes that can be used to handle different types
393 # of user authentication. Add auth plugins that require extra route handling to
394 # this list.
395 #AUTHENTICATION_URLS = [
396 #    'openstack_auth.urls',
397 #]
398 
399 # The Horizon Policy Enforcement engine uses these values to load per service
400 # policy rule files. The content of these files should match the files the
401 # OpenStack services are using to determine role based access control in the
402 # target installation.
403 
404 # Path to directory containing policy.json files
405 POLICY_FILES_PATH = '/etc/openstack-dashboard'
406 
407 # Map of local copy of service policy files.
408 # Please insure that your identity policy file matches the one being used on
409 # your keystone servers. There is an alternate policy file that may be used
410 # in the Keystone v3 multi-domain case, policy.v3cloudsample.json.
411 # This file is not included in the Horizon repository by default but can be
412 # found at
413 # http://git.openstack.org/cgit/openstack/keystone/tree/etc/ \
414 # policy.v3cloudsample.json
415 # Having matching policy files on the Horizon and Keystone servers is essential
416 # for normal operation. This holds true for all services and their policy files.
417 #POLICY_FILES = {
418 #    'identity': 'keystone_policy.json',
419 #    'compute': 'nova_policy.json',
420 #    'volume': 'cinder_policy.json',
421 #    'image': 'glance_policy.json',
422 #    'orchestration': 'heat_policy.json',
423 #    'network': 'neutron_policy.json',
424 #    'telemetry': 'ceilometer_policy.json',
425 #}
426 
427 # TODO: (david-lyle) remove when plugins support adding settings.
428 # Note: Only used when trove-dashboard plugin is configured to be used by
429 # Horizon.
430 # Trove user and database extension support. By default support for
431 # creating users and databases on database instances is turned on.
432 # To disable these extensions set the permission here to something
433 # unusable such as ["!"].
434 #TROVE_ADD_USER_PERMS = []
435 #TROVE_ADD_DATABASE_PERMS = []
436 
437 # Change this patch to the appropriate list of tuples containing
438 # a key, label and static directory containing two files:
439 # _variables.scss and _styles.scss
440 #AVAILABLE_THEMES = [
441 #    ('default', 'Default', 'themes/default'),
442 #    ('material', 'Material', 'themes/material'),
443 #]
444 
445 LOGGING = {
446     'version': 1,
447     # When set to True this will disable all logging except
448     # for loggers specified in this configuration dictionary. Note that
449     # if nothing is specified here and disable_existing_loggers is True,
450     # django.db.backends will still log unless it is disabled explicitly.
451     'disable_existing_loggers': False,
452     'handlers': {
453         'null': {
454             'level': 'DEBUG',
455             'class': 'logging.NullHandler',
456         },
457         'console': {
458             # Set the level to "DEBUG" for verbose output logging.
459             'level': 'INFO',
460             'class': 'logging.StreamHandler',
461         },
462     },
463     'loggers': {
464         # Logging from django.db.backends is VERY verbose, send to null
465         # by default.
466         'django.db.backends': {
467             'handlers': ['null'],
468             'propagate': False,
469         },
470         'requests': {
471             'handlers': ['null'],
472             'propagate': False,
473         },
474         'horizon': {
475             'handlers': ['console'],
476             'level': 'DEBUG',
477             'propagate': False,
478         },
479         'openstack_dashboard': {
480             'handlers': ['console'],
481             'level': 'DEBUG',
482             'propagate': False,
483         },
484         'novaclient': {
485             'handlers': ['console'],
486             'level': 'DEBUG',
487             'propagate': False,
488         },
489         'cinderclient': {
490             'handlers': ['console'],
491             'level': 'DEBUG',
492             'propagate': False,
493         },
494         'keystoneclient': {
495             'handlers': ['console'],
496             'level': 'DEBUG',
497             'propagate': False,
498         },
499         'glanceclient': {
500             'handlers': ['console'],
501             'level': 'DEBUG',
502             'propagate': False,
503         },
504         'neutronclient': {
505             'handlers': ['console'],
506             'level': 'DEBUG',
507             'propagate': False,
508         },
509         'heatclient': {
510             'handlers': ['console'],
511             'level': 'DEBUG',
512             'propagate': False,
513         },
514         'ceilometerclient': {
515             'handlers': ['console'],
516             'level': 'DEBUG',
517             'propagate': False,
518         },
519         'swiftclient': {
520             'handlers': ['console'],
521             'level': 'DEBUG',
522             'propagate': False,
523         },
524         'openstack_auth': {
525             'handlers': ['console'],
526             'level': 'DEBUG',
527             'propagate': False,
528         },
529         'nose.plugins.manager': {
530             'handlers': ['console'],
531             'level': 'DEBUG',
532             'propagate': False,
533         },
534         'django': {
535             'handlers': ['console'],
536             'level': 'DEBUG',
537             'propagate': False,
538         },
539         'iso8601': {
540             'handlers': ['null'],
541             'propagate': False,
542         },
543         'scss': {
544             'handlers': ['null'],
545             'propagate': False,
546         },
547     },
548 }
549 
550 # 'direction' should not be specified for all_tcp/udp/icmp.
551 # It is specified in the form.
552 SECURITY_GROUP_RULES = {
553     'all_tcp': {
554         'name': _('All TCP'),
555         'ip_protocol': 'tcp',
556         'from_port': '1',
557         'to_port': '65535',
558     },
559     'all_udp': {
560         'name': _('All UDP'),
561         'ip_protocol': 'udp',
562         'from_port': '1',
563         'to_port': '65535',
564     },
565     'all_icmp': {
566         'name': _('All ICMP'),
567         'ip_protocol': 'icmp',
568         'from_port': '-1',
569         'to_port': '-1',
570     },
571     'ssh': {
572         'name': 'SSH',
573         'ip_protocol': 'tcp',
574         'from_port': '22',
575         'to_port': '22',
576     },
577     'smtp': {
578         'name': 'SMTP',
579         'ip_protocol': 'tcp',
580         'from_port': '25',
581         'to_port': '25',
582     },
583     'dns': {
584         'name': 'DNS',
585         'ip_protocol': 'tcp',
586         'from_port': '53',
587         'to_port': '53',
588     },
589     'http': {
590         'name': 'HTTP',
591         'ip_protocol': 'tcp',
592         'from_port': '80',
593         'to_port': '80',
594     },
595     'pop3': {
596         'name': 'POP3',
597         'ip_protocol': 'tcp',
598         'from_port': '110',
599         'to_port': '110',
600     },
601     'imap': {
602         'name': 'IMAP',
603         'ip_protocol': 'tcp',
604         'from_port': '143',
605         'to_port': '143',
606     },
607     'ldap': {
608         'name': 'LDAP',
609         'ip_protocol': 'tcp',
610         'from_port': '389',
611         'to_port': '389',
612     },
613     'https': {
614         'name': 'HTTPS',
615         'ip_protocol': 'tcp',
616         'from_port': '443',
617         'to_port': '443',
618     },
619     'smtps': {
620         'name': 'SMTPS',
621         'ip_protocol': 'tcp',
622         'from_port': '465',
623         'to_port': '465',
624     },
625     'imaps': {
626         'name': 'IMAPS',
627         'ip_protocol': 'tcp',
628         'from_port': '993',
629         'to_port': '993',
630     },
631     'pop3s': {
632         'name': 'POP3S',
633         'ip_protocol': 'tcp',
634         'from_port': '995',
635         'to_port': '995',
636     },
637     'ms_sql': {
638         'name': 'MS SQL',
639         'ip_protocol': 'tcp',
640         'from_port': '1433',
641         'to_port': '1433',
642     },
643     'mysql': {
644         'name': 'MYSQL',
645         'ip_protocol': 'tcp',
646         'from_port': '3306',
647         'to_port': '3306',
648     },
649     'rdp': {
650         'name': 'RDP',
651         'ip_protocol': 'tcp',
652         'from_port': '3389',
653         'to_port': '3389',
654     },
655 }
656 
657 # Deprecation Notice:
658 #
659 # The setting FLAVOR_EXTRA_KEYS has been deprecated.
660 # Please load extra spec metadata into the Glance Metadata Definition Catalog.
661 #
662 # The sample quota definitions can be found in:
663 # <glance_source>/etc/metadefs/compute-quota.json
664 #
665 # The metadata definition catalog supports CLI and API:
666 #  $glance --os-image-api-version 2 help md-namespace-import
667 #  $glance-manage db_load_metadefs <directory_with_definition_files>
668 #
669 # See Metadata Definitions on: http://docs.openstack.org/developer/glance/
670 
671 # TODO: (david-lyle) remove when plugins support settings natively
672 # Note: This is only used when the Sahara plugin is configured and enabled
673 # for use in Horizon.
674 # Indicate to the Sahara data processing service whether or not
675 # automatic floating IP allocation is in effect.  If it is not
676 # in effect, the user will be prompted to choose a floating IP
677 # pool for use in their cluster.  False by default.  You would want
678 # to set this to True if you were running Nova Networking with
679 # auto_assign_floating_ip = True.
680 #SAHARA_AUTO_IP_ALLOCATION_ENABLED = False
681 
682 # The hash algorithm to use for authentication tokens. This must
683 # match the hash algorithm that the identity server and the
684 # auth_token middleware are using. Allowed values are the
685 # algorithms supported by Python's hashlib library.
686 #OPENSTACK_TOKEN_HASH_ALGORITHM = 'md5'
687 
688 # Hashing tokens from Keystone keeps the Horizon session data smaller, but it
689 # doesn't work in some cases when using PKI tokens.  Uncomment this value and
690 # set it to False if using PKI tokens and there are 401 errors due to token
691 # hashing.
692 #OPENSTACK_TOKEN_HASH_ENABLED = True
693 
694 # AngularJS requires some settings to be made available to
695 # the client side. Some settings are required by in-tree / built-in horizon
696 # features. These settings must be added to REST_API_REQUIRED_SETTINGS in the
697 # form of ['SETTING_1','SETTING_2'], etc.
698 #
699 # You may remove settings from this list for security purposes, but do so at
700 # the risk of breaking a built-in horizon feature. These settings are required
701 # for horizon to function properly. Only remove them if you know what you
702 # are doing. These settings may in the future be moved to be defined within
703 # the enabled panel configuration.
704 # You should not add settings to this list for out of tree extensions.
705 # See: https://wiki.openstack.org/wiki/Horizon/RESTAPI
706 REST_API_REQUIRED_SETTINGS = ['OPENSTACK_HYPERVISOR_FEATURES',
707                               'LAUNCH_INSTANCE_DEFAULTS']
708 
709 # Additional settings can be made available to the client side for
710 # extensibility by specifying them in REST_API_ADDITIONAL_SETTINGS
711 # !! Please use extreme caution as the settings are transferred via HTTP/S
712 # and are not encrypted on the browser. This is an experimental API and
713 # may be deprecated in the future without notice.
714 #REST_API_ADDITIONAL_SETTINGS = []
715 
716 # DISALLOW_IFRAME_EMBED can be used to prevent Horizon from being embedded
717 # within an iframe. Legacy browsers are still vulnerable to a Cross-Frame
718 # Scripting (XFS) vulnerability, so this option allows extra security hardening
719 # where iframes are not used in deployment. Default setting is True.
720 # For more information see:
721 # http://tinyurl.com/anticlickjack
722 #DISALLOW_IFRAME_EMBED = True
```
View Code ä¿®æ”¹æ–‡ä»¶å…¨æ–‡&nbsp;&nbsp;```
æ³¨:ä¸Šä¼ é…ç½®æ–‡ä»¶æ—¶éœ€è¦æ³¨æ„é…ç½®æ–‡ä»¶æƒé™é—®é¢˜
```python
[root@compute1 ~]# ll /etc/openstack-dashboard/local_settings 
-rw-r----- 1 root apache 26505 Jan 24 11:10 /etc/openstack-dashboard/local_settings
```
### å¯åŠ¨æœåŠ¡


```python
systemctl restart httpd.service
systemctl enable  httpd.service
```
### éªŒè¯æ“ä½œ


&nbsp;&nbsp;&nbsp;&nbsp; ä½¿ç”¨æµè§ˆå™¨è®¿é—® <a href="http://10.0.0.31/dashboard">http://10.0.0.31/dashboard</a> ï¼Œæ¨èä½¿ç”¨ç«ç‹æµè§ˆå™¨ã€‚
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127190305053-754129241.png" alt="">&nbsp;
ä¿¡æ¯è¯´æ˜ï¼šç¬¬ä¸€æ¬¡è¿æ¥æ—¶é€Ÿåº¦è¾ƒæ…¢ï¼Œè€å¿ƒç­‰å¾…ã€‚
<blockquote>
åŸŸï¼šdefault
ç”¨æˆ·å:admin
å¯†ç :ADMIN_PASS
</blockquote>
è‡³æ­¤ horizon å®‰è£…å®Œæˆ
## å¯åŠ¨ç¬¬ä¸€å°å®ä¾‹


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance.html</a>
### åˆ›å»ºè™šæ‹Ÿç½‘ç»œ


å…¬æœ‰ç½‘ç»œå‚è€ƒ:https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance-networks-provider.html
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127190334350-236795628.png" alt="">
å›¾ - å…¬å…±ç½‘ç»œæ‹“æ‰‘å›¾-æ¦‚è¿°
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127190529865-1235963103.png" alt="">
å›¾ - è¿æ¥æ€§
åŠ è½½ç¯å¢ƒå˜é‡
```python
. admin-openrc
```
åˆ›å»ºç½‘ç»œ
```python
neutron net-create --shared --provider:physical_network provider --provider:network_type flat provider  
```
åœ¨ç½‘ç»œä¸Šåˆ›å»ºå‡ºä¸€ä¸ªå­ç½‘
è¯­æ³•è¯´æ˜ï¼š
```python
neutron subnet-create --name provider --allocation-pool start=START_IP_ADDRESS,end=END_IP_ADDRESS --dns-nameserver DNS_RESOLVER --gateway PROVIDER_NETWORK_GATEWAY provider PROVIDER_NETWORK_CIDR
```
&nbsp;&nbsp; å‚æ•°è¯´æ˜
```python
# ä½¿ç”¨æä¾›è€…ç‰©ç†ç½‘ç»œçš„å­ç½‘CIDRæ ‡è®°æ›¿æ¢``PROVIDER_NETWORK_CIDR``ã€‚
# å°†``START_IP_ADDRESS``å’Œ``END_IP_ADDRESS``ä½¿ç”¨ä½ æƒ³åˆ†é…ç»™å®ä¾‹çš„å­ç½‘ç½‘æ®µçš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªIPåœ°å€ã€‚è¿™ä¸ªèŒƒå›´ä¸èƒ½åŒ…æ‹¬ä»»ä½•å·²ç»ä½¿ç”¨çš„IPåœ°å€ã€‚
# å°† DNS_RESOLVER æ›¿æ¢ä¸ºDNSè§£ææœåŠ¡çš„IPåœ°å€ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä»ä¸»æœº``/etc/resolv.conf`` æ–‡ä»¶é€‰æ‹©ä¸€ä¸ªä½¿ç”¨ã€‚
# å°†``PUBLIC_NETWORK_GATEWAY`` æ›¿æ¢ä¸ºå…¬å…±ç½‘ç»œçš„ç½‘å…³ï¼Œä¸€èˆ¬çš„ç½‘å…³IPåœ°å€ä»¥ â€.1â€ ç»“å°¾ã€‚
```
**é…ç½®ç¤ºä¾‹ï¼š**
```python
neutron subnet-create --name provider --allocation-pool start=10.0.0.101,end=10.0.0.250 --dns-nameserver 223.5.5.5 --gateway 10.0.0.254 provider 10.0.0.0/24
```
é…ç½®è¿‡ç¨‹
```python
[root@controller ~]# neutron subnet-create --name provider \
>   --allocation-pool start=10.0.0.101,end=10.0.0.250 \
>   --dns-nameserver 223.5.5.5 --gateway 10.0.0.254 \
>   provider 10.0.0.0/24
Created a new subnet:
+-------------------+----------------------------------------------+
| Field             | Value                                        |
+-------------------+----------------------------------------------+
| allocation_pools  | {"start": "10.0.0.101", "end": "10.0.0.250"} |
| cidr              | 10.0.0.0/24                                  |
| created_at        | 2018-01-24T03:41:27                          |
| description       |                                              |
| dns_nameservers   | 223.5.5.5                                    |
| enable_dhcp       | True                                         |
| gateway_ip        | 10.0.0.254                                   |
| host_routes       |                                              |
| id                | d507bf57-28e6-4af5-b54b-d969e76f4fd6         |
| ip_version        | 4                                            |
| ipv6_address_mode |                                              |
| ipv6_ra_mode      |                                              |
| name              | provider                                     |
| network_id        | 54f942f7-cc28-4292-a4d6-e37b8833e35f         |
| subnetpool_id     |                                              |
| tenant_id         | d0dfbdbc115b4a728c24d28bc1ce1e62             |
| updated_at        | 2018-01-24T03:41:27                          |
+-------------------+----------------------------------------------+
```
### åˆ›å»ºm1.nanoè§„æ ¼çš„ä¸»æœº


å®˜æ–¹æ–‡æ¡£ï¼š&nbsp;&nbsp; <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance.html#create-m1-nano-flavor">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance.html#create-m1-nano-flavor</a>
é»˜è®¤çš„æœ€å°è§„æ ¼çš„ä¸»æœºéœ€è¦512 MBå†…å­˜ã€‚å¯¹äºç¯å¢ƒä¸­è®¡ç®—èŠ‚ç‚¹å†…å­˜ä¸è¶³4 GBçš„ï¼Œæˆ‘ä»¬æ¨èåˆ›å»ºåªéœ€è¦64 MBçš„``m1.nano``è§„æ ¼çš„ä¸»æœºã€‚
è‹¥å•çº¯ä¸ºäº†æµ‹è¯•çš„ç›®çš„ï¼Œè¯·ä½¿ç”¨``m1.nano``è§„æ ¼çš„ä¸»æœºæ¥åŠ è½½CirrOSé•œåƒ
é…ç½®å‘½ä»¤
```python
[root@controller ~]# openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano
+----------------------------+---------+
| Field                      | Value   |
+----------------------------+---------+
| OS-FLV-DISABLED:disabled   | False   |
| OS-FLV-EXT-DATA:ephemeral  | 0       |
| disk                       | 1       |
| id                         | 0       |
| name                       | m1.nano |
| os-flavor-access:is_public | True    |
| ram                        | 64      |
| rxtx_factor                | 1.0     |
| swap                       |         |
| vcpus                      | 1       |
+----------------------------+---------+
```
### ç”Ÿæˆä¸€ä¸ªé”®å€¼å¯¹ï¼Œåˆ›å»ºå¯†é’¥å¯¹


ç”Ÿæˆå¯†é’¥ï¼Œå¹¶ä½¿ç”¨
```python
ssh-keygen -q -N "" -f ~/.ssh/id_rsa
openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey
```
&nbsp;&nbsp; åˆ†é…å¯†é’¥
```python
[root@controller ~]# openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey
+-------------+-------------------------------------------------+
| Field       | Value                                           |
+-------------+-------------------------------------------------+
| fingerprint | 4f:77:29:9d:4c:96:5c:45:e3:7c:5d:fa:0f:b0:bc:59 |
| name        | mykey                                           |
| user_id     | d8f4a1d74f52482d8ebe2184692d2c1c                |
+-------------+-------------------------------------------------+
```
æ£€æŸ¥å¯†é’¥å¯¹
```python
[root@controller ~]# openstack keypair list 
+-------+-------------------------------------------------+
| Name  | Fingerprint                                     |
+-------+-------------------------------------------------+
| mykey | 4f:77:29:9d:4c:96:5c:45:e3:7c:5d:fa:0f:b0:bc:59 |
+-------+-------------------------------------------------+
```
### å¢åŠ å®‰å…¨ç»„è§„åˆ™


å…è®¸ ICMP (ping)
```python
openstack security group rule create --proto icmp default
```
å…è®¸å®‰å…¨ shell (SSH) çš„è®¿é—®
```python
openstack security group rule create --proto tcp --dst-port 22 default
```
### å¯åŠ¨ç¬¬ä¸€å°äº‘ä¸»æœº


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance-provider.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/launch-instance-provider.html</a>
**å¯åŠ¨ä¹‹å‰å…ˆè¿›è¡ŒåŸºç¡€ç¯å¢ƒçš„æ£€æŸ¥**
ä¸€ä¸ªå®ä¾‹æŒ‡å®šäº†è™šæ‹Ÿæœºèµ„æºçš„å¤§è‡´åˆ†é…ï¼ŒåŒ…æ‹¬å¤„ç†å™¨ã€å†…å­˜å’Œå­˜å‚¨ã€‚
```python
openstack flavor list 
```
åˆ—å‡ºå¯ç”¨é•œåƒ
```python
openstack image list
```
åˆ—å‡ºå¯ç”¨ç½‘ç»œ
```python
openstack network list
```
åˆ—å‡ºå¯ç”¨çš„å®‰å…¨ç»„
```python
openstack security group list
```
è·å–ç½‘ç»œid
```python
[root@controller ~]# openstack network list 
+--------------------------------------+----------+--------------------------------------+
| ID                                   | Name     | Subnets                              |
+--------------------------------------+----------+--------------------------------------+
| 54f942f7-cc28-4292-a4d6-e37b8833e35f | provider | d507bf57-28e6-4af5-b54b-d969e76f4fd6 |
+--------------------------------------+----------+--------------------------------------+
```
å¯åŠ¨äº‘ä¸»æœºï¼Œæ³¨æ„net-idä¸ºåˆ›å»ºçš„network ID
```python
openstack server create --flavor m1.nano  --image cirros \
  --nic net-id=54f942f7-cc28-4292-a4d6-e37b8833e35f  --security-group default \
  --key-name mykey clsn
```
æ£€æŸ¥äº‘ä¸»æœºçš„çŠ¶å†µ
```python
[root@controller ~]# nova list 
+--------------------------------------+---------------+--------+------------+-------------+---------------------+
| ID                                   | Name          | Status | Task State | Power State | Networks            |
+--------------------------------------+---------------+--------+------------+-------------+---------------------+
| aa5bcbb8-64a7-44c8-b302-6e1ccd1af6ef | www.nmtui.com | ACTIVE | -          | Running     | provider=10.0.0.102 |
+--------------------------------------+---------------+--------+------------+-------------+---------------------+
```
### åœ¨WEBç«¯è¿›è¡ŒæŸ¥çœ‹


æµè§ˆå™¨è®¿é—®ï¼š<a href="http://10.0.0.31/dashboard/">http://10.0.0.31/dashboard/</a>
æŸ¥çœ‹äº‘ä¸»æœºçŠ¶æ€
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191337256-1557463903.png" alt="">&nbsp;
ä½¿ç”¨æ§åˆ¶å°ç™»é™†
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191348084-1324124193.png" alt="">&nbsp;
ä½¿ç”¨æ§åˆ¶å°ç™»é™†
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191356303-339045606.png" alt="">&nbsp;
&nbsp; ç”¨æˆ·åä¸ºï¼šcirrosï¼Œå¯†ç ä¸ºï¼šcubswin:)&nbsp;
### ä½¿ç”¨webç•Œé¢åˆ›å»ºä¸€ä¸ªå®ä¾‹


1ã€é€‰æ‹©å¯åŠ¨å®ä¾‹
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191417475-2084115194.png" alt="">
2ã€è®¾ç½®ä¸»æœºåç§°ï¼Œç‚¹ä¸‹ä¸€é¡¹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191423865-173896962.png" alt="">&nbsp;
3ã€é€‰æ‹©ä¸€ä¸ªé•œåƒ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191432100-836865877.png" alt="">&nbsp;
4ã€é€‰æ‹©ä¸€ä¸ªé…ç½®
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191439428-509951799.png" alt="">&nbsp;
5ã€ç½‘ç»œ
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191447615-1293695864.png" alt="">
6ã€å®‰å…¨ç»„
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191454428-1387530772.png" alt="">&nbsp;
7ã€å¯†é’¥å¯¹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191502162-659650532.png" alt="">&nbsp;
8ã€å¯åŠ¨å®ä¾‹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191509100-736324206.png" alt="">&nbsp;
9ã€åˆ›å»ºå®Œæˆ
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127191516272-2034031397.png" alt="">
10ã€æŸ¥çœ‹ä¸»æœºåˆ—è¡¨
```python
[root@controller ~]# nova list 
+--------------------------------------+----------------+--------+------------+-------------+---------------------+
| ID                                   | Name           | Status | Task State | Power State | Networks            |
+--------------------------------------+----------------+--------+------------+-------------+---------------------+
| ff46e8a7-9085-4afb-b7b7-193f37efb86d | clsn           | ACTIVE | -          | Running     | provider=10.0.0.103 |
| d275ceac-535a-4c05-92ab-3040ed9fb9d8 | clsn-openstack | ACTIVE | -          | Running     | provider=10.0.0.104 |
| aa5bcbb8-64a7-44c8-b302-6e1ccd1af6ef | www.nmtui.com  | ACTIVE | -          | Running     | provider=10.0.0.102 |
+--------------------------------------+----------------+--------+------------+-------------+---------------------+
```
11ã€å¯†é’¥è¿æ¥æµ‹è¯•
```python
[root@controller ~]# ssh cirros@10.0.0.104
The authenticity of host '10.0.0.104 (10.0.0.104)' can't be established.
RSA key fingerprint is 9d:ca:25:cd:23:c9:f8:73:c6:26:84:53:46:56:67:63.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '10.0.0.104' (RSA) to the list of known hosts.
$ hostname
clsn-openstack
```
&nbsp;&nbsp; **è‡³æ­¤äº‘ä¸»æœºåˆ›å»ºå®Œæˆã€‚**
## cinderå—å­˜å‚¨æœåŠ¡


å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/cinder.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/cinder.html</a>
### ç¯å¢ƒå‡†å¤‡


ä¸ºcompute1è®¡ç®—èŠ‚ç‚¹æ·»åŠ ä¸¤å—ç¡¬ç›˜ï¼Œåˆ†åˆ«ä¸ºï¼š
```python
    sdb      8:16   0  30G  0 disk 
    sdc      8:32   0  20G  0 disk
```
### å®‰è£…å¹¶é…ç½®æ§åˆ¶èŠ‚ç‚¹


1ï¼‰åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ›åº“ï¼Œæˆæƒ
åˆ›å»º cinder æ•°æ®åº“
```python
CREATE DATABASE cinder;
```
å…è®¸ cinder æ•°æ®åº“åˆé€‚çš„è®¿é—®æƒé™
```python
GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'CINDER_DBPASS';
GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'CINDER_DBPASS';
```
2ï¼‰åœ¨keystoneä¸­åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ
åˆ›å»ºä¸€ä¸ª cinder ç”¨
```python
openstack user create --domain default --password  CINDER_PASS cinder
```
æ·»åŠ  admin è§’è‰²åˆ° cinder ç”¨æˆ·ä¸Šã€‚
```python
openstack role add --project service --user cinder admin
```
3ï¼‰åœ¨keystoneä¸­åˆ›å»ºæœåŠ¡å®ä½“ï¼Œå’Œæ³¨å†ŒAPIæ¥å£
åˆ›å»º cinder å’Œ cinderv2 æœåŠ¡å®ä½“
```python
openstack service create --name cinder --description "OpenStack Block Storage" volume
openstack service create --name cinderv2 --description "OpenStack Block Storage" volumev2
```
åˆ›å»ºå—è®¾å¤‡å­˜å‚¨æœåŠ¡çš„ API å…¥å£ç‚¹ã€‚æ³¨æ„ï¼šéœ€è¦æ³¨å†Œä¸¤ä¸ªç‰ˆæœ¬
# v1ç‰ˆæœ¬æ³¨å†Œ
```python
openstack endpoint create --region RegionOne volume public http://controller:8776/v1/%\(tenant_id\)s
openstack endpoint create --region RegionOne volume internal http://controller:8776/v1/%\(tenant_id\)s
openstack endpoint create --region RegionOne volume admin http://controller:8776/v1/%\(tenant_id\)s
```
&nbsp;# v2ç‰ˆæœ¬æ³¨å†Œ
```python
 openstack endpoint create --region RegionOne volumev2 public http://controller:8776/v2/%\(tenant_id\)s
 openstack endpoint create --region RegionOne volumev2 internal http://controller:8776/v2/%\(tenant_id\)s
openstack endpoint create --region RegionOne volumev2 admin http://controller:8776/v2/%\(tenant_id\)s
```
4ï¼‰å®‰è£…è½¯ä»¶åŒ…
```python
yum -y install openstack-cinder
```
5ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘ /etc/cinder/cinder.confï¼ŒåŒæ—¶å®Œæˆå¦‚ä¸‹åŠ¨ä½œ
åœ¨ [database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®
```python
[database]
...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[oslo_messaging_rabbit]â€éƒ¨åˆ†ï¼Œé…ç½® â€œRabbitMQâ€ æ¶ˆæ¯é˜Ÿåˆ—è®¿é—®
```python
[DEFAULT]
...
rpc_backend = rabbit

[oslo_messaging_rabbit]
...
rabbit_host = controller
rabbit_userid = openstack
rabbit_password = RABBIT_PASS
```
&nbsp;&nbsp; åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
[DEFAULT]
...
auth_strategy = keystone

[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = CINDER_PASS
```
åœ¨ [DEFAULT éƒ¨åˆ†ï¼Œé…ç½®``my_ip`` æ¥ä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹çš„ç®¡ç†æ¥å£çš„IP åœ°å€
```python
[DEFAULT]
...
my_ip = 10.0.0.11
```
åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„
```python
[oslo_concurrency]
...
lock_path = /var/lib/cinder/tmp
```
**é…ç½®è®¡ç®—æœåŠ¡ä½¿ç”¨å—è®¾å¤‡å­˜å‚¨**
ç¼–è¾‘æ–‡ä»¶ /etc/nova/nova.conf å¹¶æ·»åŠ å¦‚ä¸‹åˆ°å…¶ä¸­
```python
vim /etc/nova/nova.conf
[cinder]
os_region_name = RegionOne
```
6ï¼‰åŒæ­¥æ•°æ®åº“
```python
su -s /bin/sh -c "cinder-manage db sync" cinder
# å¿½ç•¥è¾“å‡ºä¸­ä»»ä½•ä¸æ¨èä½¿ç”¨çš„ä¿¡æ¯ã€‚
```
7ï¼‰å¯åŠ¨æœåŠ¡
é‡å¯è®¡ç®—API æœåŠ¡
```python
systemctl restart openstack-nova-api.service
systemctl status openstack-nova-api.service
```
å¯åŠ¨å—è®¾å¤‡å­˜å‚¨æœåŠ¡ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºå¼€æœºè‡ªå¯
```python
systemctl enable openstack-cinder-api.service openstack-cinder-scheduler.service
systemctl start openstack-cinder-api.service openstack-cinder-scheduler.service
systemctl status openstack-cinder-api.service openstack-cinder-scheduler.service
```
### å®‰è£…å¹¶é…ç½®ä¸€ä¸ªå­˜å‚¨èŠ‚ç‚¹


å‚è€ƒï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/cinder-storage-install.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/cinder-storage-install.html</a>
1ï¼‰å®‰è£…lvmè½¯ä»¶
å®‰è£…æ”¯æŒçš„å·¥å…·åŒ…
```python
yum -y install lvm2
```
å¯åŠ¨LVMçš„metadataæœåŠ¡å¹¶ä¸”è®¾ç½®è¯¥æœåŠ¡éšç³»ç»Ÿå¯åŠ¨
```python
systemctl enable lvm2-lvmetad.service
systemctl start lvm2-lvmetad.service
systemctl status lvm2-lvmetad.service
```
2ï¼‰åˆ›å»ºç‰©ç†å·
&nbsp;&nbsp; å°†ä¹‹å‰æ·»åŠ çš„ä¸¤å—ç¡¬ç›˜åˆ›å»ºç‰©ç†å·
```python
pvcreate /dev/sdb
pvcreate /dev/sdc
```
&nbsp;&nbsp; æ‰§è¡Œè¿‡ç¨‹
```python
[root@compute1 ~]#  pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[root@compute1 ~]#  pvcreate /dev/sdc
  Physical volume "/dev/sdc" successfully created.
```
3ï¼‰åˆ›å»º LVM å·ç»„&nbsp;
```python
vgcreate cinder-volumes-sata /dev/sdb 
vgcreate cinder-volumes-ssd /dev/sdc
```
æŸ¥çœ‹åˆ›å»ºå‡ºæ¥çš„å·ç»„
```python
[root@compute1 ~]# vgs
  VG                  #PV #LV #SN Attr   VSize  VFree 
  cinder-volumes-sata   1   0   0 wz--n- 30.00g 30.00g
  cinder-volumes-ssd    1   0   0 wz--n- 20.00g 20.00g
```
åˆ é™¤å·ç»„æ–¹æ³•
```python
# vgremove vg-name
```
4ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
åªæœ‰å®ä¾‹å¯ä»¥è®¿é—®å—å­˜å‚¨å·ç»„ã€‚ä¸è¿‡ï¼Œåº•å±‚çš„æ“ä½œç³»ç»Ÿç®¡ç†è¿™äº›è®¾å¤‡å¹¶å°†å…¶ä¸å·å…³è”ã€‚
&nbsp;&nbsp; é»˜è®¤æƒ…å†µä¸‹ï¼ŒLVMå·æ‰«æå·¥å…·ä¼šæ‰«æ``/dev`` ç›®å½•ï¼ŒæŸ¥æ‰¾åŒ…å«å·çš„å—å­˜å‚¨è®¾å¤‡ã€‚
&nbsp;&nbsp; å¦‚æœé¡¹ç›®åœ¨ä»–ä»¬çš„å·ä¸Šä½¿ç”¨LVMï¼Œæ‰«æå·¥å…·æ£€æµ‹åˆ°è¿™äº›å·æ—¶ä¼šå°è¯•ç¼“å­˜å®ƒä»¬ï¼Œå¯èƒ½ä¼šåœ¨åº•å±‚æ“ä½œç³»ç»Ÿå’Œé¡¹ç›®å·ä¸Šäº§ç”Ÿå„ç§é—®é¢˜ã€‚
 ç¼–è¾‘``/etc/lvm/lvm.conf``  æ–‡ä»¶å¹¶å®Œæˆä¸‹é¢çš„æ“ä½œ 
```python
devices {
...
# åœ¨130è¡Œä¸‹å¢åŠ å¦‚ä¸‹è¡Œ
filter = [ "a/sdb/", "a/sdc/", "r/.*/"]
```
5ï¼‰å®‰è£…è½¯ä»¶å¹¶é…ç½®ç»„ä»¶
```python
yum -y install openstack-cinder targetcli python-keystone
```
6ï¼‰é…ç½®æ–‡ä»¶ä¿®æ”¹
ç¼–è¾‘ /etc/cinder/cinder.confï¼ŒåŒæ—¶å®Œæˆå¦‚ä¸‹åŠ¨ä½œ
åœ¨ [database] éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®
```python
[database]
...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[oslo_messaging_rabbit]â€éƒ¨åˆ†ï¼Œé…ç½® â€œRabbitMQâ€ æ¶ˆæ¯é˜Ÿåˆ—è®¿é—®
```python
[DEFAULT]
...
rpc_backend = rabbit

[oslo_messaging_rabbit]
...
rabbit_host = controller
rabbit_userid = openstack
rabbit_password = RABBIT_PASS
```
åœ¨ â€œ[DEFAULT]â€ å’Œ â€œ[keystone_authtoken]â€ éƒ¨åˆ†ï¼Œé…ç½®è®¤è¯æœåŠ¡è®¿é—®
```python
[DEFAULT]
...
auth_strategy = keystone

[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = CINDER_PASS
```
åœ¨ [DEFAULT] éƒ¨åˆ†ï¼Œé…ç½® my_ip é€‰é¡¹
```python
[DEFAULT]
...
my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS
```
æ³¨æ„ï¼šå°†å…¶ä¸­çš„``MANAGEMENT_INTERFACE_IP_ADDRESS``æ›¿æ¢ä¸ºå­˜å‚¨èŠ‚ç‚¹ä¸Šçš„ç®¡ç†ç½‘ç»œæ¥å£çš„IP åœ°å€
åœ¨``[lvm]``éƒ¨åˆ†ï¼Œé…ç½®LVMåç«¯ä»¥LVMé©±åŠ¨ç»“æŸï¼Œå·ç»„``cinder-volumes`` ï¼ŒiSCSI åè®®å’Œæ­£ç¡®çš„ iSCSIæœåŠ¡
```python
[lvm]
...
volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group = cinder-volumes
iscsi_protocol = iscsi
iscsi_helper = lioadm
```
åœ¨ [DEFAULT] éƒ¨åˆ†ï¼Œå¯ç”¨ LVM åç«¯
```python
[DEFAULT]
...
enabled_backends = lvm
```
åœ¨ [DEFAULT] åŒºåŸŸï¼Œé…ç½®é•œåƒæœåŠ¡ API çš„ä½ç½®
```python
[DEFAULT]
...
glance_api_servers = http://controller:9292
```
åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„
```python
[oslo_concurrency]
...
lock_path = /var/lib/cinder/tmp
```
**é…ç½®æ–‡ä»¶æœ€ç»ˆå†…å®¹**
```python<img id="code_img_closed_12b768c5-f2f8-4e18-aef5-0e5fc6f3e44d" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_12b768c5-f2f8-4e18-aef5-0e5fc6f3e44d" class="code_img_opened" style="display: none" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="">

 1 [root@compute1 ~]# cat /etc/cinder/cinder.conf
 2 [DEFAULT]
 3 glance_api_servers = http://10.0.0.32:9292
 4 enabled_backends = lvm
 5 rpc_backend = rabbit
 6 auth_strategy = keystone
 7 my_ip = 10.0.0.31
 8 [BACKEND]
 9 [BRCD_FABRIC_EXAMPLE]
10 [CISCO_FABRIC_EXAMPLE]
11 [COORDINATION]
12 [FC-ZONE-MANAGER]
13 [KEYMGR]
14 [cors]
15 [cors.subdomain]
16 [database]
17 connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder
18 [keystone_authtoken]
19 auth_uri = http://controller:5000
20 auth_url = http://controller:35357
21 memcached_servers = controller:11211
22 auth_type = password
23 project_domain_name = default
24 user_domain_name = default
25 project_name = service
26 username = cinder
27 password = CINDER_PASS
28 [matchmaker_redis]
29 [oslo_concurrency]
30 lock_path = /var/lib/cinder/tmp
31 [oslo_messaging_amqp]
32 [oslo_messaging_notifications]
33 [oslo_messaging_rabbit]
34 rabbit_host = controller
35 rabbit_userid = openstack
36 rabbit_password = RABBIT_PASS
37 [oslo_middleware]
38 [oslo_policy]
39 [oslo_reports]
40 [oslo_versionedobjects]
41 [ssl]
42 [lvm]
43 volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
44 volume_group = cinder-volumes-sata
45 iscsi_protocol = iscsi
46 iscsi_helper = lioadm
```
View Code&nbsp;**é…ç½®æ–‡ä»¶æœ€ç»ˆå†…å®¹**```
7ï¼‰å¯åŠ¨æœåŠ¡
```python
systemctl enable openstack-cinder-volume.service target.service
systemctl start openstack-cinder-volume.service target.service
systemctl status openstack-cinder-volume.service target.service
```
8ï¼‰éªŒè¯æ£€æŸ¥çŠ¶æ€
```python
[root@controller ~]#  cinder service-list
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
|      Binary      |     Host     | Zone |  Status | State |         Updated_at         | Disabled Reason |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
| cinder-scheduler |  controller  | nova | enabled |   up  | 2018-01-25T11:01:41.000000 |        -        |
|  cinder-volume   | compute1@lvm | nova | enabled |   up  | 2018-01-25T11:01:40.000000 |        -        |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
```
### æ·»åŠ ssdç›˜é…ç½®ä¿¡æ¯


ä¿®æ”¹é…ç½®æ–‡ä»¶
```python
[root@compute1 ~]#  vim /etc/cinder/cinder.conf
# ä¿®æ”¹å†…å®¹å¦‚ä¸‹
[DEFAULT]
Â·Â·Â·
enabled_backends = lvm,ssd

[lvm]
Â·Â·Â·
volume_backend_name = sata

[ssd]
volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group = cinder-volumes-ssd
iscsi_protocol = iscsi
iscsi_helper = lioadm
volume_backend_name = ssd
```
é‡å¯æœåŠ¡
```python
[root@compute1 ~]# systemctl restart openstack-cinder-volume.service
```
æ£€æŸ¥cinderæœåŠ¡çŠ¶æ€
```python
[root@controller ~]#  cinder service-list
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
|      Binary      |     Host     | Zone |  Status | State |         Updated_at         | Disabled Reason |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
| cinder-scheduler |  controller  | nova | enabled |   up  | 2018-01-25T11:45:42.000000 |        -        |
|  cinder-volume   | compute1@lvm | nova | enabled |   up  | 2018-01-25T11:45:21.000000 |        -        |
|  cinder-volume   | compute1@ssd | nova | enabled |   up  | 2018-01-25T11:45:42.000000 |        -        |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
```
### åœ¨Dashboardä¸­å¦‚ä½•åˆ›å»ºç¡¬ç›˜


1ã€ç™»é™†æµè§ˆå™¨dashboardï¼Œhttp://10.0.0.31/dashboard
&nbsp;&nbsp; é€‰æ‹©åˆ›å»ºå·
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192331131-237454478.png" alt="">&nbsp;
2ï¼‰åˆ›å»ºä¸€ä¸ªsataç±»å‹çš„å·
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192344678-1797523691.png" alt="">&nbsp;
3ï¼‰åˆ›å»ºè¿‡ç¨‹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192416865-555769969.png" alt="">&nbsp;
&nbsp;&nbsp; åˆ›å»ºå®Œæˆ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192422944-1896724939.png" alt="">&nbsp;
4ï¼‰åºŠå•Šè¿›ssdç±»å‹å·
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192434272-1913396240.png" alt="">
5ï¼‰åœ¨æŸ¥çœ‹åˆ›å»ºçš„ç¡¬ç›˜
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192442006-2113467402.png" alt="">&nbsp;
åœ¨å‘½ä»¤è¡Œä¸­æŸ¥çœ‹æ·»åŠ çš„å—å­˜å‚¨
```python
[root@compute1 ~]# lvs
  LV                                          VG                  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  volume-0ea47012-c0fb-4dc4-90e7-89427fe9e675 cinder-volumes-sata -wi-a----- 1.00g                                                    
  volume-288efecb-6bf0-4409-9564-81b0a6edc9b8 cinder-volumes-sata -wi-a----- 1.00g                                                    
  volume-ab347594-6402-486d-87a1-19358aa92a08 cinder-volumes-sata -wi-a----- 1.00g                                                    
  volume-33ccbb43-8bd3-4006-849d-73fe6176ea90 cinder-volumes-ssd  -wi-a----- 1.00g                                                    
  volume-cfd0ac03-f03f-4fe2-b369-76dba946934d cinder-volumes-ssd  -wi-a----- 1.00g     
```
### æ·»åŠ ç¡¬ç›˜åˆ°è™šæ‹Ÿæœº


&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192514459-1388267652.png" alt="">&nbsp;
è¿æ¥åˆ°ä¸€ä¸ªå®ä¾‹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127192526490-776538225.png" alt="">&nbsp;
ç™»é™†è™šæ‹Ÿæœº
```python
[root@controller ~]# ssh cirros@172.16.1.101
$ lsblk 
NAME   MAJ:MIN RM    SIZE RO TYPE MOUNTPOINT
vda    253:0    0      1G  0 disk 
`-vda1 253:1    0 1011.9M  0 part /
vdb    253:16   0      1G  0 disk
```
æ ¼å¼åŒ–ç£ç›˜
```python
$ sudo mkfs.ext3  /dev/vdb  
$ sudo mount /dev/vdb  /mnt/
```
&nbsp;&nbsp; åˆ›å»ºæ–‡ä»¶æµ‹è¯•
```python
$ cd /mnt/
$ sudo touch clsn
$ ls
clsn        lost+found
```
## æ·»åŠ ä¸€å°æ–°çš„è®¡ç®—èŠ‚ç‚¹


### ä¸»æœºåŸºç¡€ç¯å¢ƒé…ç½®


è¦æ±‚ï¼šä¸»æœºçš„é…ç½®ä¸ä¹‹å‰çš„ç³»ç»Ÿç›¸åŒé…ç½®ç›¸åŒï¼Œæ¨è4Gä»¥ä¸Šå†…å­˜ã€‚
1ï¼‰é…ç½®æœ¬åœ°yumä»“åº“ï¼ˆæé«˜å®‰è£…é€Ÿåº¦ï¼‰
```python
cd /opt/ &amp;&amp; wget http://10.0.0.1:8080/openstack/openstack_rpm.tar.gz
tar xf openstack_rpm.tar.gz
echo  'mount /dev/cdrom /mnt'  >>/etc/rc.d/rc.local
mount /dev/cdrom /mnt
chmod +x /etc/rc.d/rc.local
cat >/etc/yum.repos.d/local.repo<<-'EOF'
[local]
name=local
baseurl=file:///mnt
gpgcheck=0

[openstack]
name=openstack-mitaka
baseurl=file:///opt/repo
gpgcheck=0
EOF
```
2ï¼‰é…ç½®NTPæ—¶é—´æœåŠ¡
```python
# å®‰è£…è½¯ä»¶
yum install chrony -y 
# ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼ŒåŒæ­¥chronyæœåŠ¡
sed -ri.bak '/server/s/^/#/g;2a server 10.0.0.11 iburst' /etc/chrony.conf
# å¯åŠ¨ï¼Œè®¾ç½®è‡ªå¯åŠ¨
systemctl enable chronyd.service
systemctl start chronyd.service
```
3ï¼‰å®‰è£…OpenStackçš„åŒ…æ“ä½œ
```python
#å®‰è£… OpenStack å®¢æˆ·ç«¯ï¼š
yum -y install python-openstackclient
#å®‰è£… openstack-selinux è½¯ä»¶åŒ…
yum -y install openstack-selinux    
```
### å®‰è£…é…ç½®è®¡ç®—æœåŠ¡


å®‰è£…novaè½¯ä»¶åŒ…
```python
yum -y install openstack-nova-compute
```
å‘½ä»¤é›†ä¿®æ”¹é…ç½®æ–‡ä»¶
```python
yum install openstack-utils -y
cp /etc/nova/nova.conf{,.bak}
grep '^[a-Z\[]' /etc/nova/nova.conf.bak >/etc/nova/nova.conf
openstack-config --set /etc/nova/nova.conf  DEFAULT enabled_apis  osapi_compute,metadata
openstack-config --set /etc/nova/nova.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/nova/nova.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/nova/nova.conf  DEFAULT my_ip  10.0.0.32
openstack-config --set /etc/nova/nova.conf  DEFAULT use_neutron  True
openstack-config --set /etc/nova/nova.conf  DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver
openstack-config --set /etc/nova/nova.conf  glance api_servers  http://controller:9292
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_uri  http://controller:5000
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  memcached_servers  controller:11211
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  auth_type  password
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  user_domain_name  default
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  project_name  service
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  username  nova
openstack-config --set /etc/nova/nova.conf  keystone_authtoken  password  NOVA_PASS
openstack-config --set /etc/nova/nova.conf  oslo_concurrency lock_path  /var/lib/nova/tmp
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_host  controller
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_userid  openstack
openstack-config --set /etc/nova/nova.conf  oslo_messaging_rabbit   rabbit_password  RABBIT_PASS
openstack-config --set /etc/nova/nova.conf  vnc enabled  True
openstack-config --set /etc/nova/nova.conf  vnc vncserver_listen  0.0.0.0
openstack-config --set /etc/nova/nova.conf  vnc vncserver_proxyclient_address  '$my_ip'
openstack-config --set /etc/nova/nova.conf  vnc novncproxy_base_url  http://controller:6080/vnc_auto.html
```
### é…ç½®neutronç½‘ç»œ


å®‰è£…neutronç›¸å…³ç»„ä»¶
```python
yum -y install openstack-neutron-linuxbridge ebtables ipset
```
ä¿®æ”¹neutroné…ç½®
```python
cp /etc/neutron/neutron.conf{,.bak}
grep -Ev '^$|#' /etc/neutron/neutron.conf.bak >/etc/neutron/neutron.conf
openstack-config --set /etc/neutron/neutron.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/neutron/neutron.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_name  service
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken username  neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken password  NEUTRON_PASS
openstack-config --set /etc/neutron/neutron.conf  oslo_concurrency lock_path  /var/lib/neutron/tmp
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_host  controller
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_userid  openstack
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_password  RABBIT_PASS
```
é…ç½®Linuxbridgeä»£ç†
```python
cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak >/etc/neutron/plugins/ml2/linuxbridge_agent.ini
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  linux_bridge physical_interface_mappings  provider:eth0
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup enable_security_group  True
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan enable_vxlan  False
```
å†æ¬¡é…ç½® nova æœåŠ¡
```python
openstack-config --set /etc/nova/nova.conf  neutron url  http://controller:9696
openstack-config --set /etc/nova/nova.conf  neutron auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  neutron auth_type  password
openstack-config --set /etc/nova/nova.conf  neutron project_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron user_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron region_name  RegionOne
openstack-config --set /etc/nova/nova.conf  neutron project_name  service
openstack-config --set /etc/nova/nova.conf  neutron username  neutron
openstack-config --set /etc/nova/nova.conf  neutron password  NEUTRON_PASS
```
### å¯åŠ¨è®¡ç®—èŠ‚ç‚¹


#å¯åŠ¨novaæœåŠ¡ï¼Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨
```python
systemctl enable libvirtd.service openstack-nova-compute.service
systemctl start libvirtd.service openstack-nova-compute.service
```
# å¯åŠ¨Linuxbridgeä»£ç†å¹¶é…ç½®å®ƒå¼€æœºè‡ªå¯åŠ¨
```python
systemctl enable neutron-linuxbridge-agent.service
systemctl start neutron-linuxbridge-agent.service
```
# æŸ¥çœ‹çŠ¶æ€
```python
systemctl status libvirtd.service openstack-nova-compute.service
systemctl stauts neutron-linuxbridge-agent.service
```
### éªŒè¯ä¹‹å‰çš„æ“ä½œ


åœ¨æ§åˆ¶èŠ‚ç‚¹éªŒè¯é…ç½®
```python
neutron agent-list
```
&nbsp;éªŒè¯ç½‘ç»œé…ç½®
```python
[root@controller ~]# neutron agent-list 
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| id                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                  |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| 3ab2f17f-737e-4c3f-  | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent      |
| 86f0-2289c56a541b    |                    |            |                   |       |                |                         |
| 4f64caf6-a9b0-4742-b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-    |
| 0d1-0d961063200a     |                    |            |                   |       |                | agent                   |
| 630540de-d0a0-473b-  | Linux bridge agent | compute1   |                   | :-)   | True           | neutron-linuxbridge-    |
| 96b5-757afc1057de    |                    |            |                   |       |                | agent                   |
| 9989ddcb-6aba-4b7f-  | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent  |
| 9bd7-7d61f774f2bb    |                    |            |                   |       |                |                         |
| af40d1db-ff24-4201-b | Linux bridge agent | compute2   |                   | :-)   | True           | neutron-linuxbridge-    |
| 0f2-175fc1542f26     |                    |            |                   |       |                | agent                   |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
```
&nbsp;&nbsp; éªŒè¯è®¡ç®—èŠ‚ç‚¹
```python
[root@controller ~]# openstack compute service list 
+----+------------------+------------+----------+---------+-------+----------------------------+
| Id | Binary           | Host       | Zone     | Status  | State | Updated At                 |
+----+------------------+------------+----------+---------+-------+----------------------------+
|  1 | nova-scheduler   | controller | internal | enabled | up    | 2018-01-24T06:06:02.000000 |
|  2 | nova-conductor   | controller | internal | enabled | up    | 2018-01-24T06:06:04.000000 |
|  3 | nova-consoleauth | controller | internal | enabled | up    | 2018-01-24T06:06:03.000000 |
|  6 | nova-compute     | compute1   | nova     | enabled | up    | 2018-01-24T06:06:05.000000 |
|  7 | nova-compute     | compute2   | nova     | enabled | up    | 2018-01-24T06:06:00.000000 |
+----+------------------+------------+----------+---------+-------+----------------------------+
```
## Glanceé•œåƒæœåŠ¡è¿ç§»


å°†glanceæœåŠ¡è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œå‡è½»æ§åˆ¶èŠ‚ç‚¹å‹åŠ›ï¼Œæé«˜æ€§èƒ½ã€‚
### æ•°æ®åº“è¿ç§»


æœ¬æ¬¡glanceè¿ç§»åˆ°compute2èŠ‚ç‚¹ä¸Š
å®‰è£…æ•°æ®åº“
```python
yum -y install mariadb mariadb-server python2-PyMySQL
```
ä¿®æ”¹æ•°æ®åº“é…ç½®æ–‡ä»¶
```python
[root@compute2 ~]# vim /etc/my.cnf.d/openstack.cnf
[mysqld]
bind-address = 10.0.0.32
default-storage-engine = innodb
innodb_file_per_table
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8
```
å¯åŠ¨æ•°æ®åº“ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
```python
systemctl enable mariadb.service
systemctl start mariadb.service
```
**ã€é‡è¦ã€‘**ä¸ºäº†ä¿è¯æ•°æ®åº“æœåŠ¡çš„å®‰å…¨æ€§ï¼Œè¿è¡Œ``mysql_secure_installation``è„šæœ¬
```python
mysql_secure_installation
```
### é•œåƒglance æ•°æ®åº“è¿ç§»


åœ¨æ§åˆ¶èŠ‚ç‚¹çš„æ•°æ®åº“å°†glanceåº“å¯¼å‡ºï¼Œæ–‡ä»¶ä¼ åˆ°è®¡ç®—èŠ‚ç‚¹
```python
[root@controller ~]# mysqldump -B glance  > glance.sql
[root@controller ~]# rsync -avz  glance.sql  10.0.0.32:/opt/
```
ä»¥ä¸‹æ“ä½œåœ¨compute2èŠ‚ç‚¹ä¸Šè¿›è¡Œæ“ä½œ
å¯¼å…¥æ•°æ®åº“ï¼š
```python
[root@compute2  ~]# mysql 
MariaDB [(none)]> source /opt/glance.sql
```
&nbsp;&nbsp; é‡æ–°åˆ›å»ºglanceæˆæƒç”¨æˆ·
```python
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'GLANCE_DBPASS';
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%'  IDENTIFIED BY 'GLANCE_DBPASS';
```
### å®‰è£…glanceæœåŠ¡


å‚è€ƒæ–‡æ¡£<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/glance.html</a>
å®‰è£…glanceç›¸å…³è½¯ä»¶åŒ…
```python
yum -y install openstack-glance
```
ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/glance/glance-api.conf
æ³¨æ„ï¼šä¿®æ”¹å…¶ä¸­çš„æ•°æ®åº“æŒ‡å‘åœ°å€ï¼Œä¿®æ”¹ä¸ºcopmute2ä¸Šçš„æ•°æ®åº“ã€‚
&nbsp;&nbsp; æ‰¹é‡ä¿®æ”¹å‘½ä»¤é›†ï¼š
```python
yum install openstack-utils -y
cp /etc/glance/glance-api.conf{,.bak}
grep '^[a-Z\[]' /etc/glance/glance-api.conf.bak >/etc/glance/glance-api.conf
openstack-config --set /etc/glance/glance-api.conf  database  connection  mysql+pymysql://glance:GLANCE_DBPASS@10.0.0.32/glance
openstack-config --set /etc/glance/glance-api.conf  glance_store stores  file,http
openstack-config --set /etc/glance/glance-api.conf  glance_store default_store  file
openstack-config --set /etc/glance/glance-api.conf  glance_store filesystem_store_datadir  /var/lib/glance/images/
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken project_name  service
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken username  glance
openstack-config --set /etc/glance/glance-api.conf  keystone_authtoken password  GLANCE_PASS
openstack-config --set /etc/glance/glance-api.conf  paste_deploy flavor  keystone
```
&nbsp;&nbsp; ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/glance/glance-registry.conf
æ³¨æ„ï¼šä¿®æ”¹å…¶ä¸­çš„æ•°æ®åº“æŒ‡å‘åœ°å€ï¼Œä¿®æ”¹ä¸ºcopmute2ä¸Šçš„æ•°æ®åº“ã€‚
&nbsp;&nbsp; æ‰¹é‡ä¿®æ”¹å‘½ä»¤é›†ï¼š
```python
yum install openstack-utils -y
cp /etc/glance/glance-registry.conf{,.bak}
grep '^[a-Z\[]' /etc/glance/glance-registry.conf.bak > /etc/glance/glance-registry.conf
openstack-config --set /etc/glance/glance-registry.conf  database  connection  mysql+pymysql://glance:GLANCE_DBPASS@10.0.0.32/glance
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_uri  http://controller:5000
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_url  http://controller:35357
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken project_name  service
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken username  glance
openstack-config --set /etc/glance/glance-registry.conf  keystone_authtoken password  GLANCE_PASS
openstack-config --set /etc/glance/glance-registry.conf  paste_deploy flavor  keystone
```
### è¿ç§»åŸæœ‰é•œåƒæ–‡ä»¶


å°†åŸglanceä¸Šçš„é•œåƒæ–‡ä»¶ï¼Œä¼ è¾“åˆ°compute2ã€‚
```python
[root@controller ~]# cd  /var/lib/glance/images/
[root@controller ~]# rsync -avz `pwd`/ 10.0.0.32:`pwd`/ 
```
ã€æ³¨æ„æƒé™ã€‘ä¼ è¾“è¿‡åï¼Œåœ¨compute2ä¸ŠæŸ¥çœ‹æƒé™
```python
[root@compute2 ~]# cd  /var/lib/glance/images/
[root@compute2 ~]# chown glance:glance *
```
### ä¿®æ”¹ç°æœ‰keystoneä¸­ glanceæœåŠ¡æ³¨å†Œä¿¡æ¯


å¤‡ä»½æ•°æ®åº“endpointè¡¨æ•°æ®
```python
[root@controller ~]# mysqldump keystone endpoint > endpoint.sql
```
ä¿®æ”¹keystoneæ³¨å†Œä¿¡æ¯
```python
cp endpoint.sql{,.bak}
sed -i 's#http://controller:9292#http://10.0.0.32:9292#g' endpoint.sql
```
é‡æ–°å°†ä¿®æ”¹åçš„sqlæ–‡ä»¶å¯¼å…¥æ•°æ®åº“
```python
[root@controller ~]# mysql keystone < endpoint.sql
```
### ä¿®æ”¹novaèŠ‚ç‚¹é…ç½®æ–‡ä»¶


å°†æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šçš„é…ç½®æ–‡ä»¶éƒ½è¿›è¡Œä¿®æ”¹
```python
sed -i 's#api_servers = http://controller:9292#api_servers = http://10.0.0.32:9292#g' /etc/nova/nova.conf
```
æ§åˆ¶èŠ‚ç‚¹é‡å¯
```python
systemctl restart openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service
```
&nbsp;&nbsp; è®¡ç®—èŠ‚ç‚¹é‡å¯
```python
systemctl restart   openstack-nova-compute.service
```
&nbsp;&nbsp; åœæ‰glanceåŸèŠ‚ç‚¹çš„æœåŠ¡
```python
systemctl stop openstack-glance-api.service  openstack-glance-registry.service
```
### éªŒè¯æ“ä½œ


åœ¨copmute2èŠ‚ç‚¹å¯åŠ¨glanceæœåŠ¡
```python
systemctl start openstack-glance-api.service  openstack-glance-registry.service
```
æŸ¥çœ‹é•œåƒåˆ—è¡¨
```python
[root@controller ~]# openstack image list 
+--------------------------------------+----------+--------+
| ID                                   | Name     | Status |
+--------------------------------------+----------+--------+
| 68222030-a808-4d05-978f-1d4a6f85f7dd | clsn-img | active |
| 9d92c601-0824-493a-bc6e-cecb10e9a4c6 | cirros   | active |
+--------------------------------------+----------+--------+
```
æŸ¥çœ‹webç•Œé¢ä¸­çš„é•œåƒä¿¡æ¯
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193456365-946295776.png" alt="">&nbsp;
## æ·»åŠ ä¸€ä¸ªæ–°çš„ç½‘æ®µå¹¶è®©å®ƒèƒ½å¤Ÿä¸Šç½‘


### ç¯å¢ƒå‡†å¤‡


1ï¼‰ä¸ºopenstackæœåŠ¡æœºå™¨æœºå™¨æ·»åŠ ä¸€å—æ–°çš„ç½‘å¡ï¼ˆæ‰€æœ‰æœºå™¨æ“ä½œï¼‰ã€‚
ç½‘å¡é€‰æ‹©LANåŒºæ®µï¼Œå¹¶ä¿è¯æ‰€æœ‰çš„æœºå™¨åœ¨åŒä¸€ä¸ªLANåŒºæ®µå½“ä¸­ã€‚
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193510194-1815801421.png" alt="">
&nbsp;&nbsp; 2ï¼‰ä¸»æœºä¿®æ”¹é…ç½®ï¼Œå¯åŠ¨eth1ç½‘å¡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹æ“ä½œï¼‰
&nbsp;&nbsp; æŸ¥çœ‹ç½‘å¡è®¾å¤‡
```python
[root@compute1 ~]# ls /proc/sys/net/ipv4/conf/
all  brq2563bcef-c6  brq54f942f7-cc  default  eth0  eth1  lo
[root@compute1 ~]# cp /etc/sysconfig/network-scripts/ifcfg-eth{0,1}
```
&nbsp;&nbsp; ä¿®æ”¹ç½‘å¡é…ç½®
```python
[root@compute1 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth1
TYPE=Ethernet
BOOTPROTO=none
NAME=eth1
DEVICE=eth1
ONBOOT=yes
IPADDR=172.16.1.31
NETMASK=255.255.255.0
```
&nbsp;&nbsp; å¯åŠ¨ç½‘å¡
```python
[root@compute1 ~]# ifup eth0
```
### é…ç½®neutronæœåŠ¡


å†å¢åŠ ä¸€ä¸ªfaulteç½‘ç»œï¼Œè¿™é‡Œæ·»åŠ çš„åä¸ºnet172
```python
[root@controller ~]# vim /etc/neutron/plugin.ini 
[DEFAULT]
[ml2]
type_drivers = flat,vlan
tenant_network_types =
mechanism_drivers = linuxbridge
extension_drivers = port_security
[ml2_type_flat]
flat_networks = provider,net172
[ml2_type_geneve]
[ml2_type_gre]
[ml2_type_vlan]
[ml2_type_vxlan]
[securitygroup]
enable_ipset = True
```
&nbsp;&nbsp; ä¿®æ”¹æ¡¥æ¥é…ç½®ï¼Œæ·»åŠ eth1ä¿¡æ¯
```python
[root@controller ~]# vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini
[DEFAULT]
[agent]
[linux_bridge]
physical_interface_mappings = provider:eth0,net172:eth1
[securitygroup]
enable_security_group = True
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
[vxlan]
enable_vxlan = False
```
&nbsp;&nbsp; å°†æ¡¥æ¥é…ç½®æ–‡ä»¶å‘å¾€å„ä¸ªèŠ‚ç‚¹
```python
[root@controller ~]# rsync -avz /etc/neutron/plugins/ml2/linuxbridge_agent.ini 10.0.0.31:/etc/neutron/plugins/ml2/linuxbridge_agent.ini
Â·Â·Â·Â·
```
### é‡å¯æœåŠ¡


åœ¨**æ§åˆ¶èŠ‚ç‚¹**é‡å¯ç½‘ç»œæœåŠ¡
```python
[root@controller ~]# systemctl restart  neutron-server.service  neutron-linuxbridge-agent.service
```
åœ¨å…¶ä»–**è®¡ç®—èŠ‚ç‚¹**é‡å¯ç½‘ç»œæœåŠ¡
```python
[root@compute1 ~]# systemctl restart neutron-linuxbridge-agent.service 
```
æŸ¥çœ‹å½“å‰ç½‘ç»œçŠ¶æ€
```python
[root@controller ~]# neutron agent-list
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| id                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                  |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| 3ab2f17f-737e-4c3f-  | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent      |
| 86f0-2289c56a541b    |                    |            |                   |       |                |                         |
| 4f64caf6-a9b0-4742-b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-    |
| 0d1-0d961063200a     |                    |            |                   |       |                | agent                   |
| 630540de-d0a0-473b-  | Linux bridge agent | compute1   |                   | :-)   | True           | neutron-linuxbridge-    |
| 96b5-757afc1057de    |                    |            |                   |       |                | agent                   |
| 9989ddcb-6aba-4b7f-  | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent  |
| 9bd7-7d61f774f2bb    |                    |            |                   |       |                |                         |
| af40d1db-ff24-4201-b | Linux bridge agent | compute2   |                   | :-)   | True           | neutron-linuxbridge-    |
| 0f2-175fc1542f26     |                    |            |                   |       |                | agent                   |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
```
### é…ç½®iptablesæœåŠ¡å™¨ä½œå­ç½‘ç½‘å…³


ä¸»æœºä¿¡æ¯
```python
[root@route ~]# uname -r 
3.10.0-327.el7.x86_64
[root@route ~]# hostname -I 
10.0.0.2 172.16.1.2
```
&nbsp;&nbsp; é…ç½®å†…æ ¸è½¬å‘
```python
[root@route ~]# echo 'net.ipv4.ip_forward=1' >>/etc/sysctl.conf
[root@route ~]# sysctl -p 
net.ipv4.ip_forward = 1
```
&nbsp;&nbsp; é…ç½®iptablesè½¬å‘è§„åˆ™
```python
iptables -t nat -A POSTROUTING -s 172.16.1.0/24 -o eth0 -j MASQUERADE
```
### webç•Œé¢åˆ›å»ºå­ç½‘


1ï¼‰é€‰æ‹©åˆ›å»ºç½‘ç»œ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193727006-2061774592.png" alt="">&nbsp;
&nbsp;&nbsp; 2ï¼‰é…ç½®åœ¨å­ç½‘
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ç½‘å…³é€‰æ‹©æ­å»ºçš„iptablesæœåŠ¡å™¨ï¼Œç»ç”±iptablesæœåŠ¡å™¨è¿›è¡Œä»£ç†ä¸Šç½‘
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193737553-1341473394.png" alt="">&nbsp;
&nbsp;&nbsp; 3ï¼‰é…ç½®å­ç½‘IPåœ°èŒƒå›´ï¼Œé…ç½®å®Œæˆå­ç½‘åˆ›å»ºæˆåŠŸ
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193747209-838095327.png" alt="">
&nbsp;&nbsp; 4ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹æµ‹è¯•å­ç½‘
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æ³¨æ„ï¼šåœ¨åˆ›å»ºæ—¶ï¼Œç½‘ç»œé€‰æ‹©åˆšåˆšåˆ›å»ºçš„net172ç½‘ç»œ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193754537-1288439442.png" alt="">
&nbsp;&nbsp; å®ä¾‹åˆ›å»ºå®Œæˆ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193801928-976672424.png" alt="">&nbsp;
&nbsp;&nbsp; 5ï¼‰ç™»é™†æ§åˆ¶å°
&nbsp;&nbsp; æŸ¥çœ‹ç½‘å…³ä¿¡æ¯
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193810162-2005435871.png" alt="">
&nbsp;&nbsp; æ£€æµ‹ç½‘ç»œè¿é€šæ€§
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127193817772-2116885693.png" alt="">&nbsp;
&nbsp;&nbsp; **è‡³æ­¤ä¸€ä¸ªæ–°çš„å­ç½‘åˆ›å»ºæˆåŠŸ**
## CinderæœåŠ¡å¯¹æ¥NFSé…ç½®


NFSæœåŠ¡ä»‹ç»å‚è€ƒæ–‡æ¡£ï¼š<a href="http://www.cnblogs.com/clsn/p/7694456.html">http://www.cnblogs.com/clsn/p/7694456.html</a>
### NFSæœåŠ¡éƒ¨ç½²


æ³¨æ„ï¼šå®éªŒç¯å¢ƒä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹åšnfsæœåŠ¡å™¨ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€é…ç½®é«˜æ€§èƒ½å­˜å‚¨æœåŠ¡å™¨ã€‚
å®‰è£…nfsç›¸å…³è½¯ä»¶åŒ…
```python
yum install nfs-utils rpcbind -y
```
é…ç½®nfsæœåŠ¡
```python
[root@controller ~]# cat /etc/exports
/data 10.0.0.0/24(rw,async,no_root_squash,no_all_squash)
# åˆ›å»ºç›®å½•
[root@controller ~]# mkdir /data
```
å¯åŠ¨nfsæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
```python
systemctl restart rpcbind 
systemctl restart nfs
systemctl enable rpcbind  nfs
systemctl status rpcbind  nfs
```
### æµ‹è¯•NFSçš„å¯ç”¨æ€§


åœ¨è®¡ç®—èŠ‚ç‚¹æŸ¥çœ‹nfsä¿¡æ¯
```python
[root@compute1 ~]# showmount -e 10.0.0.11
Export list for 10.0.0.11:
/data 10.0.0.0/24
```
&nbsp;&nbsp; è¿›è¡ŒæŒ‚è½½æµ‹è¯•
```python
[root@compute1 ~]# mount 10.0.0.11:/data /srv
```
&nbsp;&nbsp; å†™å…¥æ–‡ä»¶
```python
[root@compute1 ~]# cd /srv/
[root@compute1 srv]# touch clsn 
```
&nbsp;&nbsp; åœ¨æœåŠ¡ç«¯æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å†™å…¥æˆåŠŸã€‚
```python
[root@controller data]# ll
total 0
-rw-r--r-- 1 root root 0 Jan 26 15:35 clsn
```
### ä¿®æ”¹CinderèŠ‚ç‚¹é…ç½®æ–‡ä»¶


&nbsp;&nbsp; é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œcinderæ˜¯é€šè¿‡åœ¨cinder.confé…ç½®æ–‡ä»¶æ¥é…ç½®é©±åŠ¨ä»è€Œä½¿ç”¨ä¸åŒçš„å­˜å‚¨ä»‹è´¨çš„ï¼Œ&nbsp;æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ä»‹è´¨ï¼Œé‚£ä¹ˆå°±éœ€è¦é…ç½®æˆNFSçš„é©±åŠ¨ï¼Œ
&nbsp;&nbsp; é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ‰¾åˆ°NFSçš„é©±åŠ¨å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢æŸ¥æ‰¾æ­¥éª¤ï¼š
```python
[root@controller ~]# cd /usr/lib/python2.7/site-packages/cinder   # åˆ‡æ¢åˆ°cinderçš„æ¨¡å—åŒ…é‡Œ
[root@controller cinder]# cd volume/drivers/   # æ‰¾åˆ°å·çš„é©±åŠ¨
[root@controller drivers]# grep Nfs nfs.py   # è¿‡æ»¤ä¸‹Nfså°±èƒ½æ‰¾åˆ°
class NfsDriver(driver.ExtendVD, remotefs.RemoteFSDriver):  # è¿™ä¸ªclasså®šä¹‰çš„ç±»å°±æ˜¯Nfsçš„é©±åŠ¨åå­—äº†
```
é©±åŠ¨æ‰¾åˆ°äº†ï¼Œç°åœ¨ä¿®æ”¹cinderé…ç½®æ·»åŠ nfsæœåŠ¡å™¨ä¿¡æ¯
```python
[root@compute1 ~]# vim /etc/cinder/cinder.conf
[DEFAULT]
Â·Â·Â·
enabled_backends = lvm,ssd,nfs

[nfs]
volume_driver = cinder.volume.drivers.nfs.NfsDriver
nfs_shares_config = /etc/cinder/nfs_shares
volume_backend_name = nfs
```
&nbsp;&nbsp; å†™nfsä¿¡æ¯æ–‡ä»¶
```python
[root@compute1 ~]# cat /etc/cinder/nfs_shares
10.0.0.11:/data
# ä¿®æ”¹æƒé™
chown root:cinder /etc/cinder/nfs_shares
chmod 640 /etc/cinder/nfs_shares
```
### é‡å¯æœåŠ¡


é‡å¯cinder-volumeæœåŠ¡
```python
[root@compute1 ~]# systemctl restart openstack-cinder-volume
```
&nbsp;&nbsp; æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯
```python
[root@compute1 ~]# df -h
Filesystem       Size  Used Avail Use% Mounted on
/dev/sda2         48G  4.0G   45G   9% /
devtmpfs         480M     0  480M   0% /dev
tmpfs            489M     0  489M   0% /dev/shm
tmpfs            489M   13M  477M   3% /run
tmpfs            489M     0  489M   0% /sys/fs/cgroup
/dev/sr0         4.1G  4.1G     0 100% /mnt
tmpfs             98M     0   98M   0% /run/user/0
10.0.0.11:/data   48G  2.9G   46G   6% /var/lib/cinder/mnt/490717a467bd12d34ec324c86a4f35b3
```
åœ¨æ§åˆ¶èŠ‚ç‚¹éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸
```python
[root@controller ~]#  cinder service-list
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
|      Binary      |     Host     | Zone |  Status | State |         Updated_at         | Disabled Reason |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
| cinder-scheduler |  controller  | nova | enabled |   up  | 2018-01-26T13:18:45.000000 |        -        |
|  cinder-volume   | compute1@lvm | nova | enabled |   up  | 2018-01-26T13:18:42.000000 |        -        |
|  cinder-volume   | compute1@nfs | nova | enabled |   up  | 2018-01-26T13:18:42.000000 |        -        |
|  cinder-volume   | compute1@ssd | nova | enabled |   up  | 2018-01-26T13:18:42.000000 |        -        |
|  cinder-volume   | compute2@lvm | nova | enabled |   up  | 2018-01-26T13:18:50.000000 |        -        |
+------------------+--------------+------+---------+-------+----------------------------+-----------------+
```
### æ·»åŠ NFSå­˜å‚¨å·


1ï¼‰åˆ›å»ºnfsç±»å‹å·
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194058553-836722711.png" alt="">
&nbsp;&nbsp; 2ï¼‰åˆ›å»ºæˆåŠŸ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194107006-409148844.png" alt="">
&nbsp;&nbsp; 3ï¼‰æŸ¥çœ‹å·çš„è¯¦ç»†ä¿¡æ¯
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194115459-593792341.png" alt="">
&nbsp;&nbsp; åœ¨nfsæœåŠ¡ç«¯ï¼ŒæŸ¥æ‰¾åˆ°æ ‡è¯†ä¸€è‡´çš„æ–‡ä»¶
```python
[root@controller ~]# ll /data/
total 0
-rw-r--r-- 1 root root          0 Jan 26 15:35 clsn
-rw-rw-rw- 1 root root 1073741824 Jan 26 21:23 volume-8c55c9bf-6ab2-4828-a14e-76bd525ba4ad
```
&nbsp;&nbsp; **è‡³æ­¤Cinder****å¯¹æ¥NFS****å°±å®Œæˆäº†**
## OpenStackä¸­çš„VXLANç½‘ç»œ


æœ¬æ¬¡çš„é…ç½®æ—¶åŸºäº" <a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option1.html">ç½‘ç»œé€‰é¡¹1ï¼šå…¬å…±ç½‘ç»œ</a>" è¿›è¡Œé…ç½®ã€‚é…ç½®å‚è€ƒ "<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option2.html">ç½‘ç»œé€‰é¡¹2ï¼šç§æœ‰ç½‘ç»œ</a>"ã€‚
### å‰æœŸå‡†å¤‡


1ï¼‰æ·»åŠ ç½‘å¡eth2 (æ‰€æœ‰èŠ‚ç‚¹æ“ä½œ)
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194134194-554487846.png" alt="">&nbsp;
2ï¼‰é…ç½®ç½‘å¡ï¼Œé…ç½®ç½‘æ®µ172.16.0.xã€‚
```python
cp /etc/sysconfig/network-scripts/ifcfg-eth{1,2}
vim  /etc/sysconfig/network-scripts/ifcfg-eth2
TYPE=Ethernet
BOOTPROTO=none
NAME=eth2
DEVICE=eth2
ONBOOT=yes
IPADDR=172.16.0.X
NETMASK=255.255.255.0
```
3ï¼‰å¯åŠ¨ç½‘å¡
```python
ifup eth2
```
### ä¿®æ”¹æ§åˆ¶èŠ‚ç‚¹é…ç½®


å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option2.html">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/neutron-controller-install-option2.html</a>
1ï¼‰å®‰è£…ç»„ä»¶
```python
yum -y install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables
```
&nbsp;&nbsp; 2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶
ä¿®æ”¹** /etc/neutron/neutron.conf**
```python
[DEFAULT]
...
core_plugin = ml2
service_plugins = router
allow_overlapping_ips = True
```
é…ç½® Modular Layer 2 (ML2) æ’ä»¶ï¼Œä¿®æ”¹**/etc/neutron/plugins/ml2/ml2_conf.ini**
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œå¯ç”¨flatï¼ŒVLANä»¥åŠVXLANç½‘ç»œ
```python
[ml2]
...
type_drivers = flat,vlan,vxlan        
```
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œå¯ç”¨VXLANç§æœ‰ç½‘ç»œ
```python
[ml2]
...
tenant_network_types = vxlan
```
åœ¨``[ml2]``éƒ¨åˆ†ï¼Œå¯ç”¨Linuxbridgeå’Œlayerï¼2æœºåˆ¶ï¼š
```python
[ml2]
...
mechanism_drivers = linuxbridge,l2population
```
åœ¨``[ml2_type_vxlan]``éƒ¨åˆ†ï¼Œä¸ºç§æœ‰ç½‘ç»œé…ç½®VXLANç½‘ç»œè¯†åˆ«çš„ç½‘ç»œèŒƒå›´
```python
[ml2_type_vxlan]
...
vni_ranges = 1:1000
```
é…ç½®Linuxbridgeä»£ç†ï¼Œä¿®æ”¹** /etc/neutron/plugins/ml2/linuxbridge_agent.ini**
```python
[vxlan]
enable_vxlan = True
local_ip = 172.16.0.11
l2_population = True
```
é…ç½®layerï¼3ä»£ç†ï¼Œç¼–è¾‘``/etc/neutron/l3_agent.ini``æ–‡ä»¶å¹¶å®Œæˆä»¥ä¸‹æ“ä½œï¼š
åœ¨``[DEFAULT]``éƒ¨åˆ†ï¼Œé…ç½®Linuxbridgeæ¥å£é©±åŠ¨å’Œå¤–éƒ¨ç½‘ç»œç½‘æ¡¥
```python
[DEFAULT]
...
interface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver
external_network_bridge =
```
**åŒæ­¥æ•°æ®åº“**
```python
su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \
  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron
```
**å¯åŠ¨æœåŠ¡**
```python
systemctl restart neutron-server.service \
neutron-linuxbridge-agent.service neutron-dhcp-agent.service \
neutron-metadata-agent.service
# å¯åŠ¨l3ç½‘ç»œ
systemctl enable neutron-l3-agent.service
systemctl start neutron-l3-agent.service
```
&nbsp;&nbsp; æ£€æŸ¥ç½‘ç»œçŠ¶æ€
```python
[root@controller ~]# neutron agent-list
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| id                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                  |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| 3ab2f17f-737e-4c3f-  | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent      |
| 86f0-2289c56a541b    |                    |            |                   |       |                |                         |
| 4f64caf6-a9b0-4742-b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-    |
| 0d1-0d961063200a     |                    |            |                   |       |                | agent                   |
| 630540de-d0a0-473b-  | Linux bridge agent | compute1   |                   | :-)   | True           | neutron-linuxbridge-    |
| 96b5-757afc1057de    |                    |            |                   |       |                | agent                   |
| 9989ddcb-6aba-4b7f-  | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent  |
| 9bd7-7d61f774f2bb    |                    |            |                   |       |                |                         |
| af40d1db-ff24-4201-b | Linux bridge agent | compute2   |                   | :-)   | True           | neutron-linuxbridge-    |
| 0f2-175fc1542f26     |                    |            |                   |       |                | agent                   |
| b08be87c-4abe-48ce-  | L3 agent           | controller | nova              | :-)   | True           | neutron-l3-agent        |
| 983f-0bb08208f6de    |                    |            |                   |       |                |                         |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
```
### ä¿®æ”¹é…ç½®è®¡ç®—èŠ‚ç‚¹æ–‡ä»¶


é…ç½®Linuxbridgeä»£ç†ï¼Œæ·»åŠ é…ç½®
```python
vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini
[vxlan]
enable_vxlan = True
local_ip = OVERLAY_INTERFACE_IP_ADDRESS
l2_population = True
```
é‡å¯æœåŠ¡
```python
systemctl restart neutron-linuxbridge-agent.service
```
&nbsp;&nbsp; å†æ¬¡æ£€æŸ¥ç½‘ç»œçŠ¶æ€
```python
[root@controller ~]# neutron agent-list
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| id                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                  |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
| 3ab2f17f-737e-4c3f-  | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent      |
| 86f0-2289c56a541b    |                    |            |                   |       |                |                         |
| 4f64caf6-a9b0-4742-b | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-    |
| 0d1-0d961063200a     |                    |            |                   |       |                | agent                   |
| 630540de-d0a0-473b-  | Linux bridge agent | compute1   |                   | :-)   | True           | neutron-linuxbridge-    |
| 96b5-757afc1057de    |                    |            |                   |       |                | agent                   |
| 9989ddcb-6aba-4b7f-  | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent  |
| 9bd7-7d61f774f2bb    |                    |            |                   |       |                |                         |
| af40d1db-ff24-4201-b | Linux bridge agent | compute2   |                   | :-)   | True           | neutron-linuxbridge-    |
| 0f2-175fc1542f26     |                    |            |                   |       |                | agent                   |
| b08be87c-4abe-48ce-  | L3 agent           | controller | nova              | :-)   | True           | neutron-l3-agent        |
| 983f-0bb08208f6de    |                    |            |                   |       |                |                         |
+----------------------+--------------------+------------+-------------------+-------+----------------+-------------------------+
```
### ä¿®æ”¹dashboardå¼€å¯è·¯ç”±ç•Œé¢æ˜¾ç¤º


è¯¥æ“ä½œæ˜¯åœ¨webç•Œé¢å¼€å¯routeåŠŸèƒ½
```python
vim /etc/openstack-dashboard/local_settings
OPENSTACK_NEUTRON_NETWORK = {
    'enable_router': True,
Â·Â·Â·Â·
```
é‡å¯dashboardæœåŠ¡
```python
systemctl restart httpd.service
```
### é…ç½®VXLANç½‘ç»œ


1ï¼‰æŸ¥çœ‹ç°åœ¨ç½‘ç»œæ‹“æ‰‘
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194445490-98320466.png" alt="">&nbsp;
&nbsp;&nbsp; 2ï¼‰ç¼–è¾‘ç½‘ç»œé…ç½®ï¼Œå¼€å¯å¤–éƒ¨ç½‘ç»œ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194457397-40298296.png" alt="">&nbsp;
&nbsp;&nbsp; 3ï¼‰é…ç½®ç½‘ç»œ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194505397-744089759.png" alt="">&nbsp;
&nbsp;&nbsp; 4ï¼‰é…ç½®å­ç½‘
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194514428-2079928145.png" alt="">
&nbsp;&nbsp; 5ï¼‰åˆ›å»ºè·¯ç”±å™¨
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; åˆ›å»ºè·¯ç”±æ—¶ï¼Œæ³¨æ„é…ç½®å¤–éƒ¨ç½‘ç»œè¿æ¥.
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194523319-1433152884.png" alt="">
**è·¯ç”±å™¨å®è´¨ä¸ºåˆ›å»ºå‘½åç©ºé—´**
æŸ¥çœ‹å‘½åç©ºé—´åˆ—è¡¨
```python
[root@controller ~]# ip netns
qdhcp-ac1f482b-5c37-4da2-8922-c8d02e3ad27b
qrouter-546678a3-7277-42a6-9ddd-a060e3d3198d
qdhcp-2563bcef-c6b0-43f1-9b17-1eca15472893
qdhcp-54f942f7-cc28-4292-a4d6-e37b8833e35f
```
&nbsp;
&nbsp;&nbsp;&nbsp; è¿›å…¥å‘½åç©ºé—´
&nbsp;
```python
[root@controller ~]# ip netns exec qrouter-546678a3-7277-42a6-9ddd-a060e3d3198d /bin/bash
```
6ï¼‰ä¸ºè·¯ç”±å™¨æ·»åŠ æ¥å£è¿æ¥å­ç½‘
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194549506-1106040010.png" alt="">&nbsp;
&nbsp;&nbsp; 7ï¼‰åˆ›å»ºä¸€å°å®ä¾‹ï¼Œä½¿ç”¨é…ç½®çš„VXLANç½‘ç»œ
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æ³¨æ„é€‰æ‹©é…ç½®vxlançš„ç½‘ç»œé…ç½®
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194557162-464684758.png" alt="">&nbsp;
&nbsp;&nbsp; 8ï¼‰ä¸ºåˆ›å»ºçš„å®ä¾‹é…ç½®æµ®åŠ¨IP
&nbsp;<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194604334-1474928604.png" alt="">
&nbsp;&nbsp; é…ç½®æµ®åŠ¨IPåçš„å®ä¾‹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194611865-1955137906.png" alt="">&nbsp;
### è¿æ¥æµ®åŠ¨IPæµ‹è¯•


ä½¿ç”¨sshè¿æ¥ä¸»æœºï¼Œç”±äºä¹‹å‰å®šåˆ¶çš„è¿›è¡Œrootå¯†ç è¿›è¡Œä¿®æ”¹å¯ä»¥ä½¿ç”¨rootç”¨æˆ·ç›´æ¥è¿›è¡Œ è¿æ¥ã€‚
```python
[root@compute2 ~]# ssh root@10.0.0.115
root@10.0.0.115's password: 
# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast qlen 1000
    link/ether fa:16:3e:fc:70:31 brd ff:ff:ff:ff:ff:ff
    inet 1.1.1.101/24 brd 1.1.1.255 scope global eth0
    inet6 fe80::f816:3eff:fefc:7031/64 scope link 
       valid_lft forever preferred_lft forever
# ping baidu.com -c1
PING baidu.com (111.13.101.208): 56 data bytes
64 bytes from 111.13.101.208: seq=0 ttl=127 time=5.687 ms

--- baidu.com ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 5.687/5.687/5.687 ms
```
&nbsp;&nbsp; æŸ¥çœ‹å½“å‰ç½‘ç»œæ‹“æ‰‘
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194649959-324856902.png" alt="">&nbsp;
&nbsp;&nbsp; **åˆ°æ­¤VXLAN****ç½‘ç»œå·²å®ç°**
## openstack APIåº”ç”¨ç”¨


&nbsp;&nbsp; å®˜æ–¹APIåˆ—è¡¨ï¼šhttps://docs.openstack.org/pike/api/
&nbsp;&nbsp; å®˜æ–¹æä¾›äº†ä¸°å¯Œçš„APIæ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·çš„ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨curlå‘½ä»¤è°ƒç”¨API
curlå‘½ä»¤æ˜¯Linuxä¸‹ä¸€ä¸ªå¯ä»¥ä½¿ç”¨å¤šç§åè®®æ”¶å‘æ•°æ®çš„å·¥å…·ï¼ŒåŒ…æ‹¬httpåè®®ã€‚openstackçš„APIæ¥å£éƒ½æ˜¯URLåœ°å€ï¼šhttp://controller:35357/v3å¯ä»¥ä½¿ç”¨curlå‘½ä»¤è¿›è¡Œè°ƒç”¨ã€‚
### è·å–tokenæ–¹æ³•


è·å–token
```python
[root@controller ~]# openstack token issue |awk '/ id /{print $4}' 
gAAAAABaa0MpXNGCHgaytnvyPMbIF3IecIu9jA4WeMaL1kLWueNYs_Q1APXwdXDU7K34wdLg0I1spUIzDhAkst-Qdrizn_L3N5YBlApUrkY7gSw96MkKpTTDjUhIgm0eAD85Ayi6TL_1HmJJQIhm5ERY91zcKi9dvl73jj0dFNDWRqD9Cc9_oPA
```
å°†è·å–tokenç»™å˜é‡å¤åˆ¶
```python
token=` token=`openstack token issue |awk '/ id /{print $4}'`
```
### å¸¸ç”¨è·å–å‘½ä»¤


å‚è€ƒï¼šhttp://www.qstack.com.cn/archives/168.html
ä½¿ç”¨apiç«¯å£æŸ¥çœ‹é•œåƒåˆ—è¡¨
```python
curl -H "X-Auth-Token:$token"  -H "Content-Type: application/json"  http://10.0.0.32:9292/v2/images
```
è·å–rolesåˆ—è¡¨
```python
curl -H "X-Auth-Token:$token" -H "Content-Type: application/json" http://10.0.0.11:35357/v3/roles
```
è·å–ä¸»æœºåˆ—è¡¨
```python
curl -H "X-Auth-Token:$token" -H "Content-Type: application/json" http://10.0.0.11:8774/v2.1/servers
```
è·å–ç½‘ç»œåˆ—è¡¨
```python
curl -H "X-Auth-Token:$token" -H "Content-Type: application/json" http://10.0.0.11:9696/v2.0/networks
```
è·å–å­ç½‘åˆ—è¡¨
```python
curl -H "X-Auth-Token:$token" -H "Content-Type: application/json" http://10.0.0.11:9696/v2.0/subnets
```
ä¸‹è½½ä¸€ä¸ªé•œåƒ
```python
curl -o clsn.qcow2 -H "X-Auth-Token:$token" -H "Content-Type: application/json" http://10.0.0.11:9292/v2/images/eb9e7015-d5ef-48c7-bd65-88a144c59115/file
```
## é™„å½•


### é™„å½•-å¸¸è§é”™è¯¯


1ã€é…ç½®ç”¨æˆ·æ—¶çš„é”™è¯¯

ã€é”™è¯¯ã€‘Multiple service matches found for 'identity', use an ID to be more specific.
è§£å†³åŠæ³•ï¼š
openstack endpoint list # æŸ¥çœ‹åˆ—è¡¨
&nbsp;&nbsp;&nbsp; openstack endpoint delete&nbsp; 'id'&nbsp; # åˆ©ç”¨IDåˆ é™¤API ç«¯ç‚¹
&nbsp;&nbsp;&nbsp; openstack service list&nbsp; # æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
```
2ã€ç”¨æˆ·ç®¡ç†æ—¶é”™è¯¯

HTTP 503é”™è¯¯ï¼š
&nbsp;&nbsp;&nbsp; glanceæ—¥å¿—ä½ç½®ï¼š /var/log/glance/
&nbsp;&nbsp;&nbsp; ç”¨æˆ·åˆ é™¤åï¼Œé‡æ–°é‡å»ºç”¨æˆ·åï¼Œå†å…³è”æ¬¡è§’è‰²
&nbsp;&nbsp;&nbsp; openstack role add --project service --user glance admin
```
3ã€æœªåŠ è½½ç¯å¢ƒå˜é‡æ—¶å‡ºé”™

[root@controller ~]# openstack user list
Missing parameter(s):
Set a username with --os-username, OS_USERNAME, or auth.username
Set an authentication URL, with --os-auth-url, OS_AUTH_URL or auth.auth_url
Set a scope, such as a project or domain, set a project scope with --os-project-name, OS_PROJECT_NAME or auth.project_name, set a domain scope with --os-domain-name, OS_DOMAIN_NAME or auth.domain_name
```
### é™„å½•-OpenStackç»„ä»¶ä½¿ç”¨çš„é»˜è®¤ç«¯å£å·


<table style="width: 100%; border-collapse: collapse; border-style: none" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr style="height: 1.15pt">
<td style="width: 52.84%; border-top: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt; height: 1.15pt" valign="top" width="52%">
**OpenStack service**
</td>
<td style="width: 17.62%; border-top: 1pt solid rgba(155, 187, 89, 1); border-left: none; border-bottom: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt; height: 1.15pt" valign="top" width="17%">
**Default ports**
</td>
<td style="width: 29.54%; border-top: 1pt solid rgba(155, 187, 89, 1); border-right: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt; height: 1.15pt" valign="top" width="29%">
**Port type**
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Block Storage (****cinder****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
8776
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Compute (****nova****) endpoints**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
8774
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Compute API (****nova-api****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
8773, 8775
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Compute ports for access to virtual machine consoles**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
5900-5999
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Compute VNC proxy for browsers (&nbsp;****openstack-nova-novncproxy****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
6080
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Compute VNC proxy for traditional VNC clients (****openstack-nova-xvpvncproxy****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
6081
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Proxy port for HTML5 console used by Compute service**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
6082
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Data processing service (****sahara****) endpoint**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
8386
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Identity service (****keystone****) administrative endpoint**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
35357
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">
adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Identity service public endpoint**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
5000
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Image service (****glance****) API**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
9292
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Image service registry**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
9191
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Networking (****neutron****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
9696
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Object Storage (****swift****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
6000, 6001, 6002
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Orchestration (****heat****) endpoint**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
8004
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Orchestration AWS CloudFormation-compatible API (****openstack-heat-api-cfn****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
8000
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="52%">
**Orchestration AWS CloudWatch-compatible API (****openstack-heat-api-cloudwatch****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="17%">
8003
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="29%">&nbsp;</td>
</tr>
<tr>
<td style="width: 52.84%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="52%">
**Telemetry (****ceilometer****)**
</td>
<td style="width: 17.62%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="17%">
8777
</td>
<td style="width: 29.54%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="29%">
publicurl and adminurl
</td>
</tr>
</tbody>
</table>
### é™„å½•-openstackç»„ä»¶ä½¿ç”¨çš„é»˜è®¤ç«¯å£å·


<table style="width: 100%; border-collapse: collapse; border-style: none" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 25.02%; border-top: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" valign="top" width="25%">
Service
</td>
<td style="width: 15.6%; border-top: 1pt solid rgba(155, 187, 89, 1); border-left: none; border-bottom: 1pt solid rgba(155, 187, 89, 1); border-right: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" valign="top" width="15%">
Default port
</td>
<td style="width: 59.38%; border-top: 1pt solid rgba(155, 187, 89, 1); border-right: 1pt solid rgba(155, 187, 89, 1); border-bottom: 1pt solid rgba(155, 187, 89, 1); border-left: none; background: rgba(155, 187, 89, 1); padding: 0 5.4pt" valign="top" width="59%">
Used by
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="25%">
**HTTP**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="15%">
80
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="59%">
OpenStack dashboard (Horizon) when it is not configured to use secure access.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="25%">
**HTTP alternate**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="15%">
8080
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="59%">
OpenStack Object Storage (swift) service.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="25%">
**HTTPS**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="15%">
443
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="59%">
Any OpenStack service that is enabled for SSL, especially secure-access dashboard.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="25%">
**rsync**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="15%">
873
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="59%">
OpenStack Object Storage. Required.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="25%">
**iSCSI target**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="15%">
3260
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="59%">
OpenStack Block Storage. Required.
</td>
</tr>
<tr style="height: 35.15pt">
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt; height: 35.15pt" valign="top" width="25%">
**MySQL database service**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt; height: 35.15pt" valign="top" width="15%">
3306
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt; height: 35.15pt" valign="top" width="59%">
Most OpenStack components.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="25%">
**Message Broker (AMQP traffic)**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="15%">
5672
25672
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="59%">
OpenStack Block Storage, Networking, Orchestration, and Compute.
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; padding: 0 5.4pt" valign="top" width="25%">
**NTP(chrony)**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="15%">
123,323
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); padding: 0 5.4pt" valign="top" width="59%">
æ—¶é—´åŒæ­¥
</td>
</tr>
<tr>
<td style="width: 25.02%; border-right: 1pt solid rgba(194, 214, 155, 1); border-bottom: 1pt solid rgba(194, 214, 155, 1); border-left: 1pt solid rgba(194, 214, 155, 1); border-top: none; background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="25%">
**memcached**
</td>
<td style="width: 15.6%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="15%">
11211
</td>
<td style="width: 59.38%; border-top: none; border-left: none; border-bottom: 1pt solid rgba(194, 214, 155, 1); border-right: 1pt solid rgba(194, 214, 155, 1); background: rgba(234, 241, 221, 1); padding: 0 5.4pt" valign="top" width="59%">
ç¼“å­˜æœåŠ¡å™¨
</td>
</tr>
</tbody>
</table>
### é™„å½•-openstackæ–°å»ºäº‘ä¸»æœºæµç¨‹å›¾


<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127194843240-1945202755.png" alt="">
è™šæ‹Ÿæœºå¯åŠ¨è¿‡ç¨‹æ–‡å­—è¡¨è¿°å¦‚ä¸‹ï¼š

```brush:Perl;gutter:true;">1.	ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘keystoneè·å–è®¤è¯ä¿¡æ¯ã€‚
2.	keystoneé€šè¿‡ç”¨æˆ·è¯·æ±‚è®¤è¯ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆauth-tokenè¿”å›ç»™å¯¹åº”çš„è®¤è¯è¯·æ±‚ã€‚
3.	ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘nova-apiå‘é€ä¸€ä¸ªboot instanceçš„è¯·æ±‚ï¼ˆæºå¸¦auth-tokenï¼‰ã€‚
4.	nova-apiæ¥å—è¯·æ±‚åå‘keystoneå‘é€è®¤è¯è¯·æ±‚ï¼ŒæŸ¥çœ‹tokenæ˜¯å¦ä¸ºæœ‰æ•ˆç”¨æˆ·å’Œtokenã€‚
5.	keystoneéªŒè¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœ‰æ•ˆåˆ™è¿”å›æœ‰æ•ˆçš„è®¤è¯å’Œå¯¹åº”çš„è§’è‰²ï¼ˆæ³¨ï¼šæœ‰äº›æ“ä½œéœ€è¦æœ‰è§’è‰²æƒé™æ‰èƒ½æ“ä½œï¼‰ã€‚
6.	é€šè¿‡è®¤è¯ånova-apiå’Œæ•°æ®åº“é€šè®¯ã€‚
7.	åˆå§‹åŒ–æ–°å»ºè™šæ‹Ÿæœºçš„æ•°æ®åº“è®°å½•ã€‚
8.	nova-apié€šè¿‡rpc.callå‘nova-schedulerè¯·æ±‚æ˜¯å¦æœ‰åˆ›å»ºè™šæ‹Ÿæœºçš„èµ„æº(Host ID)ã€‚
9.	nova-schedulerè¿›ç¨‹ä¾¦å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–nova-apiçš„è¯·æ±‚ã€‚
10.	nova-scheduleré€šè¿‡æŸ¥è¯¢novaæ•°æ®åº“ä¸­è®¡ç®—èµ„æºçš„æƒ…å†µï¼Œå¹¶é€šè¿‡è°ƒåº¦ç®—æ³•è®¡ç®—ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºéœ€è¦çš„ä¸»æœºã€‚
11.	å¯¹äºæœ‰ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºçš„ä¸»æœºï¼Œnova-scheduleræ›´æ–°æ•°æ®åº“ä¸­è™šæ‹Ÿæœºå¯¹åº”çš„ç‰©ç†ä¸»æœºä¿¡æ¯ã€‚
12.	nova-scheduleré€šè¿‡rpc.castå‘nova-computeå‘é€å¯¹åº”çš„åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚
13.	nova-computeä¼šä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚
14.	nova-computeé€šè¿‡rpc.callå‘nova-conductorè¯·æ±‚è·å–è™šæ‹Ÿæœºæ¶ˆæ¯ã€‚ï¼ˆFlavorï¼‰
15.	nova-conductorä»æ¶ˆæ¯é˜Ÿé˜Ÿåˆ—ä¸­æ‹¿åˆ°nova-computeè¯·æ±‚æ¶ˆæ¯ã€‚
16.	nova-conductoræ ¹æ®æ¶ˆæ¯æŸ¥è¯¢è™šæ‹Ÿæœºå¯¹åº”çš„ä¿¡æ¯ã€‚
17.	nova-conductorä»æ•°æ®åº“ä¸­è·å¾—è™šæ‹Ÿæœºå¯¹åº”ä¿¡æ¯ã€‚
18.	nova-conductoræŠŠè™šæ‹Ÿæœºä¿¡æ¯é€šè¿‡æ¶ˆæ¯çš„æ–¹å¼å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚
19.	nova-computeä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–è™šæ‹Ÿæœºä¿¡æ¯æ¶ˆæ¯ã€‚
20.	nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚glance-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦é•œåƒã€‚
21.	glance-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚
22.	tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºé•œåƒä¿¡æ¯(URL)ã€‚
23.	nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯kçš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚neutron-serverè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„ç½‘ç»œä¿¡æ¯ã€‚
24.	neutron-serverå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚
25.	tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºç½‘ç»œä¿¡æ¯ã€‚
26.	nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚cinder-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„æŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚
27.	cinder-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚
28.	tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹ŸæœºæŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚
29.	nova-computeæ ¹æ®instanceçš„ä¿¡æ¯è°ƒç”¨é…ç½®çš„è™šæ‹ŸåŒ–é©±åŠ¨æ¥åˆ›å»ºè™šæ‹Ÿæœºã€‚
```
### é™„å½•-MetaData IP 169.254.169.254è¯´æ˜


æŸ¥è€ƒæ–‡çŒ®ï¼š<a href="http://server.51cto.com/sVirtual-516706.htm">http://server.51cto.com/sVirtual-516706.htm</a>
**OpenStack metadata**
è¦ç†è§£å¦‚ä½•å®ç°çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£OpenStackçš„metadataã€‚metadataå­—é¢ä¸Šæ˜¯å…ƒæ•°æ®ï¼Œä¸»è¦ç”¨æ¥ç»™å®¢æˆ·æä¾›ä¸€ä¸ªå¯ä»¥ä¿®æ”¹è®¾ç½®OpenStack instence(äº‘ä¸»æœº)çš„æœºåˆ¶ï¼Œå°±åƒæˆ‘ä»¬æƒ³åœ¨è™šæ‹Ÿæœºæ”¾ç½®ä¸€ä¸ªå…¬é’¥è¿™æ ·çš„éœ€æ±‚ï¼Œæˆ–è€…è®¾ç½®ä¸»æœºåç­‰éƒ½å¯ä»¥é€šè¿‡metadataæ¥å®ç°ã€‚è®©æˆ‘æ¥æ¢³ç†ä¸€ä¸‹æ€è·¯ï¼š
<blockquote>
&nbsp;1.OpenStackæœ‰ä¸€ä¸ªå«åšMetadataçš„ä¸œä¸œã€‚
&nbsp;2.æˆ‘ä»¬åˆ›å»ºè™šæ‹Ÿæœºæ—¶å€™è®¾ç½®çš„ä¸»æœºåã€å¯†é’¥å¯¹ï¼Œéƒ½ä¿å­˜åœ¨Metadataä¸­ã€‚
&nbsp;3.è™šæ‹Ÿæœºåˆ›å»ºåï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™è·å–Metadataï¼Œå¹¶è¿›è¡Œç³»ç»Ÿé…ç½®ã€‚
</blockquote>
è™šæ‹Ÿæœºå¦‚ä½•å–åˆ°Metadata?
é‚£ä¹ˆè™šæ‹Ÿæœºåˆ°åº•æ˜¯æ€ä¹ˆå–åˆ°è¿™ä¸ªmetadataå‘¢?è®©æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºè¯•è¯•è¿™ä¸ªã€‚
```python
$ curl http://169.254.169.254
1.0
2007-01-19
2007-03-01
2007-08-29
2007-10-10
2007-12-15
2008-02-01
2008-09-01
2009-04-04
latest
```
**ä¸ºå•¥æ˜¯169.254.169.254?**
æˆ–è®¸ä½ å’Œæˆ‘æœ‰ä¸€æ ·çš„ç–‘é—®ï¼Œä¸ºå•¥è¿™ä¸ªmeatadataçš„ipåœ°å€æ˜¯169.254.169.254å‘¢?
è¿™ä¸ªå°±è¦æåˆ°Amazonäº†ã€‚å› ä¸ºmetadataæ˜¯äºšé©¬é€Šæå‡ºæ¥çš„ã€‚ç„¶åå¤§å®¶å†ç»™äºšé©¬é€Šå®šåˆ¶å„ç§æ“ä½œç³»ç»Ÿé•œåƒçš„æ—¶å€™è·å–metadataçš„apiåœ°å€å°±å†™çš„æ˜¯169.254.169.254ã€‚
ä¸ºäº†è¿™äº›é•œåƒä¹Ÿèƒ½åœ¨OpenStackä¸Šè¿è¡Œï¼Œä¸ºäº†å…¼å®¹å®ƒã€‚OpenStackå°±ä¿ç•™äº†è¿™ä¸ªåœ°å€ã€‚å…¶å®æ—©æœŸçš„OpenStackç‰ˆæœ¬æ˜¯é€šè¿‡iptables NATæ¥æ˜ å°„169.254.169.254åˆ°çœŸå®APIçš„IPåœ°å€ä¸Šã€‚
ä¸è¿‡ç°åœ¨æ›´çµæ´»äº†ï¼Œç›´æ¥åœ¨è™šæ‹Ÿæœºé‡Œé¢å¢åŠ äº†ä¸€æ¡è·¯ç”±æ¡ç›®æ¥å®ç°ï¼Œè®©è™šæ‹Ÿæœºé¡ºåˆ©çš„è®¿é—®åˆ°è¿™ä¸ªIPåœ°å€ã€‚å…³äºè¿™ä¸ªIPçš„äº§ç”Ÿéœ€è¦äº†è§£åˆ°**â€˜å‘½åç©ºé—´â€™**çš„æ¦‚å¿µ,å…³äºå‘½åç©ºé—´å¯ä»¥å‚è€ƒè¿™ç¯‡åšæ–‡: <a href="http://blog.csdn.net/preterhuman_peak/article/details/40857117">http://blog.csdn.net/preterhuman_peak/article/details/40857117</a>
è¿›å…¥å‘½åç©ºé—´
```python
[root@controller ~]# ip  netns  exec qdhcp-54f942f7-cc28-4292-a4d6-e37b8833e35f  /bin/bash 
[root@controller ~]# 
[root@controller ~]# ifconfig 
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 0  (Local Loopback)
        RX packets 3  bytes 1728 (1.6 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3  bytes 1728 (1.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ns-432508f9-da: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.0.101  netmask 255.255.255.0  broadcast 10.0.0.255
        inet6 fe80::f816:3eff:fedb:5a54  prefixlen 64  scopeid 0x20<link>
        ether fa:16:3e:db:5a:54  txqueuelen 1000  (Ethernet)
        RX packets 3609  bytes 429341 (419.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 777  bytes 89302 (87.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```
å‘½åç©ºé—´ä¸­çš„è¿›ç¨‹
```python
[root@controller ~]# netstat  -lntup 
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      31094/python2       
tcp        0      0 10.0.0.101:53           0.0.0.0:*               LISTEN      41418/dnsmasq       
tcp        0      0 169.254.169.254:53      0.0.0.0:*               LISTEN      41418/dnsmasq       
tcp6       0      0 fe80::f816:3eff:fedb:53 :::*                    LISTEN      41418/dnsmasq       
udp        0      0 10.0.0.101:53           0.0.0.0:*                           41418/dnsmasq       
udp        0      0 169.254.169.254:53      0.0.0.0:*                           41418/dnsmasq       
udp        0      0 0.0.0.0:67              0.0.0.0:*                           41418/dnsmasq       
udp6       0      0 fe80::f816:3eff:fedb:53 :::*                                41418/dnsmasq      
```
### é™„å½•-å°†æ§åˆ¶èŠ‚ç‚¹ç§’å˜è®¡ç®—èŠ‚ç‚¹


1ï¼‰åœ¨æ§åˆ¶èŠ‚ç‚¹æ“ä½œ
```python
yum -y install openstack-nova-compute
```
2ï¼‰ä¿®æ”¹novaé…ç½®æ–‡ä»¶
```python
[root@controller ~]# vim /etc/nova/nova.conf
[vnc]
...
enabled = True
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = $my_ip
novncproxy_base_url = http://controller:6080/vnc_auto.html
```
3ï¼‰å¯åŠ¨è®¡ç®—èŠ‚ç‚¹æœåŠ¡
```python
systemctl enable libvirtd.service openstack-nova-compute.service
systemctl start libvirtd.service openstack-nova-compute.service
```
### é™„å½•-å¦‚ä½•æŠŠå®ä¾‹è½¬æ¢ä¸ºé•œåƒ


**éœ€æ±‚è¯´æ˜ï¼š**å°†ä¸€å°é…ç½®å¥½çš„æœåŠ¡å™¨ï¼Œåšæˆé•œåƒï¼Œåˆ©ç”¨è¯¥é•œåƒåˆ›å»ºæ–°çš„å®ä¾‹
1ï¼‰å¯¹å®ä¾‹è¿›è¡Œæ‹æ‘„å¿«ç…§
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195044334-1678216576.png" alt="">&nbsp;
&nbsp;&nbsp; è®¾ç½®å¿«ç…§åç§°
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195053772-680697591.png" alt="">&nbsp;
&nbsp;&nbsp; å¿«ç…§åˆ›å»ºæ–‡ä»¶
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195101428-582997936.png" alt="">&nbsp;
&nbsp;&nbsp; ä½†æ˜¯è¿™é‡Œæ˜¾ç¤ºçš„**å¿«ç…§**åå­—è®©äººå¾ˆä¸çˆ½ï¼Œä¸‹é¢å°±å°†ä»–**æ”¹ä¸ºæ˜ åƒ**ã€‚
2ï¼‰æŸ¥çœ‹è¿›è¡Œä¸Šçš„æ ‡è¯†ä¿¡æ¯
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195108600-1487839964.png" alt="">&nbsp;
&nbsp;&nbsp; 3ï¼‰åœ¨glaceæœåŠ¡ç«¯æŸ¥çœ‹é•œåƒæ–‡ä»¶
```python
[root@compute2 ~]# ll /var/lib/glance/images/ -h 
total 1.9G
-rw-r----- 1 glance glance 1.1G Jan 26 16:27 1473524b-df75-45f5-afc2-83ab3e6915cc
-rw-r----- 1 glance glance  22M Jan 26 21:33 1885a4c7-d400-4d97-964c-eddcbeb245a3
-rw-r----- 1 glance glance 857M Jan 26 09:37 199bae53-fc7b-4eeb-a02a-83e17ae73e20
-rw-r----- 1 glance glance  13M Jan 25 11:31 68222030-a808-4d05-978f-1d4a6f85f7dd
-rw-r----- 1 glance glance  13M Jan 23 18:20 9d92c601-0824-493a-bc6e-cecb10e9a4c6
```
&nbsp;&nbsp;&nbsp; å°†ç”Ÿæˆçš„é•œåƒæ–‡ä»¶ç§»åŠ¨åˆ°å…¶ä»–ç›®å½•
```python
[root@compute2 ~]# mv /var/lib/glance/images/1885a4c7-d400-4d97-964c-eddcbeb245a3  /root
```
&nbsp;&nbsp; 4ï¼‰åœ¨webç•Œé¢åˆ é™¤åˆšåˆšç”Ÿæˆçš„å¿«ç…§
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195134162-240660782.png" alt="">&nbsp;
&nbsp;&nbsp; 5ï¼‰å°†é•œåƒæ–‡ä»¶é‡æ–°ä¸Šä¼ 
```python
[root@compute2 ~]# . admin-openrc 
[root@compute2 ~]# openstack image create "clsn-image-upload"   --file 1885a4c7-d400-4d97-964c-eddcbeb245a3   --disk-format qcow2 --container-format bare   --public
+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | 45fdc3a04021042855890712f31de1f9                     |
| container_format | bare                                                 |
| created_at       | 2018-01-26T13:46:15Z                                 |
| disk_format      | qcow2                                                |
| file             | /v2/images/ab30d820-94e5-4567-8110-605759745112/file |
| id               | ab30d820-94e5-4567-8110-605759745112                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | clsn-image-upload                                    |
| owner            | d0dfbdbc115b4a728c24d28bc1ce1e62                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 22085632                                             |
| status           | active                                               |
| tags             |                                                      |
| updated_at       | 2018-01-26T13:46:40Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+
```
&nbsp;&nbsp; 6ï¼‰åœ¨æŸ¥çœ‹åˆšæ‰åˆ›å»ºçš„é•œåƒ
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195200225-869466180.png" alt="">
&nbsp;&nbsp; 7ï¼‰ä½¿ç”¨æ–°é•œåƒåˆ›å»ºä¸€å°å®ä¾‹
<img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180127195204850-898378338.png" alt="">&nbsp;
&nbsp;&nbsp; **è‡³æ­¤å®ä¾‹è½¬æ¢ä¸ºé•œåƒå®Œæˆ**
## å‚è€ƒæ–‡çŒ®


<blockquote>
[1]&nbsp;[openstackå®˜æ–¹å‚è€ƒæ–‡æ¡£]&nbsp;<a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/">https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/</a>
[2]&nbsp;<a href="https://zh.wikipedia.org/wiki/%e9%9b%b2%e7%ab%af%e9%81%8b%e7%ae%97">https://zh.wikipedia.org/wiki/%e9%9b%b2%e7%ab%af%e9%81%8b%e7%ae%97</a>
[3]&nbsp;<a href="http://www.ruanyifeng.com/blog/2017/07/iaas-paas-saas.html">http://www.ruanyifeng.com/blog/2017/07/iaas-paas-saas.html</a>
[4]&nbsp;<a href="https://wiki.openstack.org/wiki/Main_Page">https://wiki.openstack.org/wiki/Main_Page</a>
[5]&nbsp;<a href="https://zh.wikipedia.org/wiki/OpenStack">https://zh.wikipedia.org/wiki/OpenStack</a>
[6]&nbsp;<a href="https://www.cnblogs.com/pythonxiaohu/p/5861409.html">https://www.cnblogs.com/pythonxiaohu/p/5861409.html</a>
[7]&nbsp;<a href="https://linux.cn/article-5019-1.html">https://linux.cn/article-5019-1.html</a>
[8]&nbsp;<a href="https://www.cnblogs.com/endoresu/p/5018688.html">https://www.cnblogs.com/endoresu/p/5018688.html</a>
[9]&nbsp;<a href="https://developer.openstack.org/api-ref/compute/">https://developer.openstack.org/api-ref/compute/</a>
</blockquote>